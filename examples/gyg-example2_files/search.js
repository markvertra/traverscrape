require=function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a="function"==typeof require&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++)s(r[o]);return s}({1:[function(require,module,exports){!function(root,factory){"function"==typeof define&&define.amd?define(["underscore","backbone"],function(_,Backbone){return factory(_||root._,Backbone||root.Backbone)}):"object"==typeof exports?module.exports=factory(require("underscore"),require("backbone")):factory(_,Backbone)}(this,function(_,Backbone){function toQueryString(val,namePrefix){function encodeSplit(val){return String(val).replace(splitChar,encodeURIComponent(splitChar))}var splitChar=Backbone.Router.arrayValueSplit;if(!val)return"";namePrefix=namePrefix||"";var rtn=[];return _.each(val,function(_val,name){if(name=namePrefix+name,_.isString(_val)||_.isNumber(_val)||_.isBoolean(_val)||_.isDate(_val))null!=_val&&rtn.push(name+"="+encodeSplit(encodeURIComponent(_val)));else if(_.isArray(_val)){for(var str="",i=0;i<_val.length;i++){var param=_val[i];null!=param&&(str+=splitChar+encodeSplit(param))}str&&rtn.push(name+"="+str)}else{var result=toQueryString(_val,name+".");result&&rtn.push(result)}}),rtn.join("&")}function parseParams(value){try{return decodeURIComponent(value.replace(/\+/g," "))}catch(err){return value}}function iterateQueryString(queryString,callback){var keyValues=queryString.split("&");_.each(keyValues,function(keyValue){var arr=keyValue.split("=");callback(arr.shift(),arr.join("="))})}var namedParam=/(\(\?)?:\w+/g,splatParam=/\*\w+/g;Backbone.Router.arrayValueSplit="|",_.extend(Backbone.History.prototype,{getFragment:function(fragment,forcePushState){if(null==fragment)if(this._hasPushState||!this._wantsHashChange||forcePushState){fragment=this.location.pathname;var root=this.root.replace(/\/$/,""),search=this.location.search;fragment.indexOf(root)||(fragment=fragment.substr(root.length)),search&&this._hasPushState&&(fragment+=search)}else fragment=this.getHash();return fragment.replace(/^[#\/]|\s+$/g,"")},getQueryParameters:function(fragment,forcePushState){fragment=this.getFragment(fragment,forcePushState);var queryString=fragment.replace(/^([^\?]*)/,""),match=queryString.match(/^\?(.*)/);if(match){queryString=match[1];var rtn={};return iterateQueryString(queryString,function(name,value){value=parseParams(value),rtn[name]?_.isString(rtn[name])?rtn[name]=[rtn[name],value]:rtn[name].push(value):rtn[name]=value}),rtn}return{}}}),_.extend(Backbone.Router.prototype,{initialize:function(options){this.encodedSplatParts=options&&options.encodedSplatParts},_routeToRegExp:function(route){var splatMatch=splatParam.exec(route)||{index:-1},namedMatch=namedParam.exec(route)||{index:-1},paramNames=route.match(/[\:\*]([^\:\?\/]+)/g)||[];route=route.replace(/[\-{}\[\]+?.,\\\^$|#\s]/g,"\\$&").replace(/\((.*?)\)/g,"(?:$1)?").replace(namedParam,function(match,optional){return optional?match:"([^\\/\\?]+)"}).replace(splatParam,"([^??]*?)"),route+="(\\?.*)?";var rtn=new RegExp("^"+route+"$");return splatMatch.index>=0&&(rtn.splatMatch=namedMatch>=0?splatMatch.index-namedMatch.index:-1),rtn.paramNames=_.map(paramNames,function(name){return name.replace(/\)$/,"").substring(1)}),rtn.namedParameters=this.namedParameters,rtn},_extractParameters:function(route,fragment){var params=route.exec(fragment).slice(1),namedParams={};params.length>0&&!params[params.length-1]&&params.splice(params.length-1,1);var match=params.length&&params[params.length-1]&&params[params.length-1].match(/^\?(.*)/);if(match){var queryString=match[1],data={};if(queryString){var self=this;iterateQueryString(queryString,function(name,value){self._setParamValue(name,value,data)})}params[params.length-1]=data,_.extend(namedParams,data)}var length=params.length;if(route.splatMatch&&this.encodedSplatParts){if(route.splatMatch<0)return params;length-=1}for(var i=0;i<length;i++)_.isString(params[i])&&(params[i]=parseParams(params[i]),route.paramNames&&route.paramNames.length>=i-1&&(namedParams[route.paramNames[i]]=params[i]));return Backbone.Router.namedParameters||route.namedParameters?[namedParams]:params},_setParamValue:function(key,value,data){key=key.replace("[]",""),key=key.replace("%5B%5D","");for(var parts=key.split("."),_data=data,i=0;i<parts.length;i++){var part=parts[i];i===parts.length-1?_data[part]=this._decodeParamValue(value,_data[part]):_data=_data[part]=_data[part]||{}}},_decodeParamValue:function(value,currentValue){var splitChar=Backbone.Router.arrayValueSplit;if(splitChar&&value.indexOf(splitChar)>=0){for(var values=value.split(splitChar),i=values.length-1;i>=0;i--)values[i]?values[i]=parseParams(values[i]):values.splice(i,1);return values}return value=parseParams(value),currentValue?_.isArray(currentValue)?(currentValue.push(value),currentValue):[currentValue,value]:value},toFragment:function(route,queryParameters){return queryParameters&&(_.isString(queryParameters)||(queryParameters=toQueryString(queryParameters)),queryParameters&&(route+="?"+queryParameters)),route}})})},{backbone:"backbone",underscore:"underscore"}],2:[function(require,module,exports){!function(root,factory){"use strict";var moment;if("object"==typeof exports){try{moment=require("moment")}catch(e){}module.exports=factory(moment)}else"function"==typeof define&&define.amd?define(function(req){try{moment=req("moment")}catch(e){}return factory(moment)}):root.Pikaday=factory(root.moment)}(this,function(moment){"use strict";var hasMoment="function"==typeof moment,hasEventListeners=!!window.addEventListener,document=window.document,sto=window.setTimeout,addEvent=function(el,e,callback,capture){hasEventListeners?el.addEventListener(e,callback,!!capture):el.attachEvent("on"+e,callback)},removeEvent=function(el,e,callback,capture){hasEventListeners?el.removeEventListener(e,callback,!!capture):el.detachEvent("on"+e,callback)},trim=function(str){return str.trim?str.trim():str.replace(/^\s+|\s+$/g,"")},hasClass=function(el,cn){return(" "+el.className+" ").indexOf(" "+cn+" ")!==-1},addClass=function(el,cn){hasClass(el,cn)||(el.className=""===el.className?cn:el.className+" "+cn)},removeClass=function(el,cn){el.className=trim((" "+el.className+" ").replace(" "+cn+" "," "))},isArray=function(obj){return/Array/.test(Object.prototype.toString.call(obj))},isDate=function(obj){return/Date/.test(Object.prototype.toString.call(obj))&&!isNaN(obj.getTime())},isWeekend=function(date){var day=date.getDay();return 0===day||6===day},isLeapYear=function(year){return year%4==0&&year%100!=0||year%400==0},getDaysInMonth=function(year,month){return[31,isLeapYear(year)?29:28,31,30,31,30,31,31,30,31,30,31][month]},setToStartOfDay=function(date){isDate(date)&&date.setHours(0,0,0,0)},compareDates=function(a,b){return a.getTime()===b.getTime()},extend=function(to,from,overwrite){var prop,hasProp;for(prop in from)hasProp=void 0!==to[prop],hasProp&&"object"==typeof from[prop]&&null!==from[prop]&&void 0===from[prop].nodeName?isDate(from[prop])?overwrite&&(to[prop]=new Date(from[prop].getTime())):isArray(from[prop])?overwrite&&(to[prop]=from[prop].slice(0)):to[prop]=extend({},from[prop],overwrite):!overwrite&&hasProp||(to[prop]=from[prop]);return to},fireEvent=function(el,eventName,data){var ev;document.createEvent?(ev=document.createEvent("HTMLEvents"),ev.initEvent(eventName,!0,!1),ev=extend(ev,data),el.dispatchEvent(ev)):document.createEventObject&&(ev=document.createEventObject(),ev=extend(ev,data),el.fireEvent("on"+eventName,ev))},adjustCalendar=function(calendar){return calendar.month<0&&(calendar.year-=Math.ceil(Math.abs(calendar.month)/12),calendar.month+=12),calendar.month>11&&(calendar.year+=Math.floor(Math.abs(calendar.month)/12),calendar.month-=12),calendar},defaults={field:null,bound:void 0,ariaLabel:"Use the arrow keys to pick a date",position:"bottom left",reposition:!0,format:"YYYY-MM-DD",toString:null,parse:null,defaultDate:null,setDefaultDate:!1,firstDay:0,formatStrict:!1,minDate:null,maxDate:null,yearRange:10,showWeekNumber:!1,pickWholeWeek:!1,minYear:0,maxYear:9999,minMonth:void 0,maxMonth:void 0,startRange:null,endRange:null,isRTL:!1,yearSuffix:"",showMonthAfterYear:!1,showDaysInNextAndPreviousMonths:!1,enableSelectionDaysInNextAndPreviousMonths:!1,numberOfMonths:1,mainCalendar:"left",container:void 0,blurFieldOnSelect:!0,i18n:{previousMonth:"Previous Month",nextMonth:"Next Month",months:["January","February","March","April","May","June","July","August","September","October","November","December"],weekdays:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],weekdaysShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"]},theme:null,events:[],onSelect:null,onOpen:null,onClose:null,onDraw:null,keyboardInput:!0,legend:""},renderDayName=function(opts,day,abbr){for(day+=opts.firstDay;day>=7;)day-=7;return abbr?opts.i18n.weekdaysShort[day]:opts.i18n.weekdays[day]},renderDay=function(opts){var arr=[],ariaSelected="false";if(opts.isEmpty){if(!opts.showDaysInNextAndPreviousMonths)return'<td class="is-empty"></td>';arr.push("is-outside-current-month"),opts.enableSelectionDaysInNextAndPreviousMonths||arr.push("is-selection-disabled")}return opts.isDisabled&&arr.push("is-disabled"),opts.isToday&&arr.push("is-today"),opts.isSelected&&(arr.push("is-selected"),ariaSelected="true"),opts.hasEvent&&arr.push("has-event"),opts.isInRange&&arr.push("is-inrange"),opts.isStartRange&&arr.push("is-startrange"),opts.isEndRange&&arr.push("is-endrange"),opts.isNotAvailable&&arr.push("is-not-available"),opts.isDeal&&arr.push("is-deal"),'<td data-day="'+opts.day+'" class="'+arr.join(" ")+'" aria-selected="'+ariaSelected+'"><button class="pika-button pika-day" type="button" data-pika-year="'+opts.year+'" data-pika-month="'+opts.month+'" data-pika-day="'+opts.day+'">'+opts.day+"</button></td>"},renderWeek=function(d,m,y){var onejan=new Date(y,0,1);return'<td class="pika-week">'+Math.ceil(((new Date(y,m,d)-onejan)/864e5+onejan.getDay()+1)/7)+"</td>"},renderRow=function(days,isRTL,pickWholeWeek,isRowSelected){return'<tr class="pika-row'+(pickWholeWeek?" pick-whole-week":"")+(isRowSelected?" is-selected":"")+'">'+(isRTL?days.reverse():days).join("")+"</tr>"},renderBody=function(rows){return"<tbody>"+rows.join("")+"</tbody>"},renderHead=function(opts){var i,arr=[];for(opts.showWeekNumber&&arr.push("<th></th>"),i=0;i<7;i++)arr.push('<th scope="col"><abbr title="'+renderDayName(opts,i)+'">'+renderDayName(opts,i,!0)+"</abbr></th>");return"<thead><tr>"+(opts.isRTL?arr.reverse():arr).join("")+"</tr></thead>"},renderTitle=function(instance,c,year,month,refYear,randId){var i,j,arr,monthHtml,yearHtml,opts=instance._o,isMinYear=year===opts.minYear,isMaxYear=year===opts.maxYear,html='<div id="'+randId+'" class="pika-title" role="heading" aria-live="assertive">',prev=!0,next=!0;for(arr=[],i=0;i<12;i++)arr.push('<option value="'+(year===refYear?i-c:12+i-c)+'"'+(i===month?' selected="selected"':"")+(isMinYear&&i<opts.minMonth||isMaxYear&&i>opts.maxMonth?'disabled="disabled"':"")+">"+opts.i18n.months[i]+"</option>");for(monthHtml='<div class="pika-label">'+opts.i18n.months[month]+'<select class="pika-select pika-select-month" tabindex="-1">'+arr.join("")+"</select></div>",isArray(opts.yearRange)?(i=opts.yearRange[0],j=opts.yearRange[1]+1):(i=year-opts.yearRange,j=1+year+opts.yearRange),arr=[];i<j&&i<=opts.maxYear;i++)i>=opts.minYear&&arr.push('<option value="'+i+'"'+(i===year?' selected="selected"':"")+">"+i+"</option>");return yearHtml='<div class="pika-label">'+year+opts.yearSuffix+'<select class="pika-select pika-select-year" tabindex="-1">'+arr.join("")+"</select></div>",html+=opts.showMonthAfterYear?yearHtml+monthHtml:monthHtml+yearHtml,isMinYear&&(0===month||opts.minMonth>=month)&&(prev=!1),isMaxYear&&(11===month||opts.maxMonth<=month)&&(next=!1),0===c&&(html+='<button class="pika-prev'+(prev?"":" is-disabled")+'" type="button">'+opts.i18n.previousMonth+"</button>"),c===instance._o.numberOfMonths-1&&(html+='<button class="pika-next'+(next?"":" is-disabled")+'" type="button">'+opts.i18n.nextMonth+"</button>"),html+="</div>"},renderTable=function(opts,data,randId){return'<table cellpadding="0" cellspacing="0" class="pika-table" role="grid" aria-labelledby="'+randId+'">'+renderHead(opts)+renderBody(data)+"</table>"},Pikaday=function(options){var self=this,opts=self.config(options);self._onMouseDown=function(e){if(self._v){e=e||window.event;var target=e.target||e.srcElement;if(target){if(!hasClass(target,"is-disabled"))if(!hasClass(target,"pika-button")||hasClass(target,"is-empty")||hasClass(target.parentNode,"is-disabled")){if(hasClass(target,"price-on-day"))return self.setDate(new Date(target.parentNode.getAttribute("data-pika-year"),target.parentNode.getAttribute("data-pika-month"),target.parentNode.getAttribute("data-pika-day"))),void(opts.bound&&sto(function(){self.hide(),opts.field&&opts.field.blur()},100));hasClass(target,"pika-prev")?self.prevMonth():hasClass(target,"pika-next")&&self.nextMonth()}else self.setDate(new Date(target.getAttribute("data-pika-year"),target.getAttribute("data-pika-month"),target.getAttribute("data-pika-day"))),opts.bound&&sto(function(){self.hide(),opts.blurFieldOnSelect&&opts.field&&opts.field.blur()},100);if(hasClass(target,"pika-select"))self._c=!0;else{if(!e.preventDefault)return e.returnValue=!1,!1;e.preventDefault()}}}},self._onChange=function(e){e=e||window.event;var target=e.target||e.srcElement;target&&(hasClass(target,"pika-select-month")?self.gotoMonth(target.value):hasClass(target,"pika-select-year")&&self.gotoYear(target.value))},self._onKeyChange=function(e){if(e=e||window.event,self.isVisible())switch(e.keyCode){case 13:case 27:opts.field&&opts.field.blur();break;case 37:e.preventDefault(),self.adjustDate("subtract",1);break;case 38:self.adjustDate("subtract",7);break;case 39:self.adjustDate("add",1);break;case 40:self.adjustDate("add",7)}},self._onInputChange=function(e){var date;e.firedBy!==self&&(opts.parse?date=opts.parse(opts.field.value,opts.format):hasMoment?(date=moment(opts.field.value,opts.format,opts.formatStrict),date=date&&date.isValid()?date.toDate():null):date=new Date(Date.parse(opts.field.value)),isDate(date)&&self.setDate(date),self._v||self.show())},self._onInputFocus=function(){self.show()},self._onInputClick=function(){self.show()},self._onInputBlur=function(){var pEl=document.activeElement;do{if(hasClass(pEl,"pika-single"))return}while(pEl=pEl.parentNode);self._c||(self._b=sto(function(){self.hide()},50)),self._c=!1},self._onClick=function(e){e=e||window.event;var target=e.target||e.srcElement,pEl=target;if(target){!hasEventListeners&&hasClass(target,"pika-select")&&(target.onchange||(target.setAttribute("onchange","return;"),addEvent(target,"change",self._onChange)));do{if(hasClass(pEl,"pika-single")||pEl===opts.trigger)return}while(pEl=pEl.parentNode);self._v&&target!==opts.trigger&&pEl!==opts.trigger&&self.hide()}},self.el=document.createElement("div"),self.el.className="pika-single"+(opts.isRTL?" is-rtl":"")+(opts.theme?" "+opts.theme:""),addEvent(self.el,"mousedown",self._onMouseDown,!0),addEvent(self.el,"touchend",self._onMouseDown,!0),addEvent(self.el,"change",self._onChange),opts.keyboardInput&&addEvent(document,"keydown",self._onKeyChange),opts.field&&(opts.container?opts.container.appendChild(self.el):opts.bound?document.body.appendChild(self.el):opts.field.parentNode.insertBefore(self.el,opts.field.nextSibling),addEvent(opts.field,"change",self._onInputChange),opts.defaultDate||(hasMoment&&opts.field.value?opts.defaultDate=moment(opts.field.value,opts.format).toDate():opts.defaultDate=new Date(Date.parse(opts.field.value)),opts.setDefaultDate=!0));var defDate=opts.defaultDate;isDate(defDate)?opts.setDefaultDate?self.setDate(defDate,!0):self.gotoDate(defDate):self.gotoDate(new Date),opts.bound?(this.hide(),self.el.className+=" is-bound",addEvent(opts.trigger,"click",self._onInputClick),addEvent(opts.trigger,"focus",self._onInputFocus),addEvent(opts.trigger,"blur",self._onInputBlur)):this.show()};return Pikaday.prototype={config:function(options){this._o||(this._o=extend({},defaults,!0));var opts=extend(this._o,options,!0);opts.isRTL=!!opts.isRTL,opts.field=opts.field&&opts.field.nodeName?opts.field:null,opts.theme="string"==typeof opts.theme&&opts.theme?opts.theme:null,opts.bound=!!(void 0!==opts.bound?opts.field&&opts.bound:opts.field),opts.trigger=opts.trigger&&opts.trigger.nodeName?opts.trigger:opts.field,opts.disableWeekends=!!opts.disableWeekends,opts.disableDayFn="function"==typeof opts.disableDayFn?opts.disableDayFn:null;var nom=parseInt(opts.numberOfMonths,10)||1;if(opts.numberOfMonths=nom>4?4:nom,isDate(opts.minDate)||(opts.minDate=!1),isDate(opts.maxDate)||(opts.maxDate=!1),opts.minDate&&opts.maxDate&&opts.maxDate<opts.minDate&&(opts.maxDate=opts.minDate=!1),opts.minDate&&this.setMinDate(opts.minDate),opts.maxDate&&this.setMaxDate(opts.maxDate),isArray(opts.yearRange)){var fallback=(new Date).getFullYear()-10;opts.yearRange[0]=parseInt(opts.yearRange[0],10)||fallback,opts.yearRange[1]=parseInt(opts.yearRange[1],10)||fallback}else opts.yearRange=Math.abs(parseInt(opts.yearRange,10))||defaults.yearRange,opts.yearRange>100&&(opts.yearRange=100);return opts},toString:function(format){return format=format||this._o.format,isDate(this._d)?this._o.toString?this._o.toString(this._d,format):hasMoment?moment(this._d).format(format):this._d.toDateString():""},getMoment:function(){return hasMoment?moment(this._d):null},setMoment:function(date,preventOnSelect){hasMoment&&moment.isMoment(date)&&this.setDate(date.toDate(),preventOnSelect)},getDate:function(){return isDate(this._d)?new Date(this._d.getTime()):null},setDate:function(date,preventOnSelect){if(!date)return this._d=null,this._o.field&&(this._o.field.value="",fireEvent(this._o.field,"change",{firedBy:this})),this.draw();if("string"==typeof date&&(date=new Date(Date.parse(date))),isDate(date)){var min=this._o.minDate,max=this._o.maxDate;isDate(min)&&date<min?date=min:isDate(max)&&date>max&&(date=max),this._d=new Date(date.getTime()),setToStartOfDay(this._d),this.gotoDate(this._d),this._o.field&&(this._o.field.value=this.toString(),fireEvent(this._o.field,"change",{firedBy:this})),preventOnSelect||"function"!=typeof this._o.onSelect||this._o.onSelect.call(this,this.getDate())}},gotoDate:function(date){var newCalendar=!0;if(isDate(date)){if(this.calendars){var firstVisibleDate=new Date(this.calendars[0].year,this.calendars[0].month,1),lastVisibleDate=new Date(this.calendars[this.calendars.length-1].year,this.calendars[this.calendars.length-1].month,1),visibleDate=date.getTime();lastVisibleDate.setMonth(lastVisibleDate.getMonth()+1),lastVisibleDate.setDate(lastVisibleDate.getDate()-1),newCalendar=visibleDate<firstVisibleDate.getTime()||lastVisibleDate.getTime()<visibleDate}newCalendar&&(this.calendars=[{month:date.getMonth(),year:date.getFullYear()}],"right"===this._o.mainCalendar&&(this.calendars[0].month+=1-this._o.numberOfMonths)),this.adjustCalendars()}},adjustDate:function(sign,days){var newDay,day=this.getDate()||new Date,difference=24*parseInt(days)*60*60*1e3;"add"===sign?newDay=new Date(day.valueOf()+difference):"subtract"===sign&&(newDay=new Date(day.valueOf()-difference)),this.setDate(newDay)},adjustCalendars:function(){this.calendars[0]=adjustCalendar(this.calendars[0]);for(var c=1;c<this._o.numberOfMonths;c++)this.calendars[c]=adjustCalendar({month:this.calendars[0].month+c,year:this.calendars[0].year});this.draw()},gotoToday:function(){this.gotoDate(new Date)},gotoMonth:function(month){isNaN(month)||(this.calendars[0].month=parseInt(month,10),this.adjustCalendars())},nextMonth:function(){this.calendars[0].month++,this.adjustCalendars()},prevMonth:function(){this.calendars[0].month--,this.adjustCalendars()},gotoYear:function(year){isNaN(year)||(this.calendars[0].year=parseInt(year,10),this.adjustCalendars())},setMinDate:function(value){value instanceof Date?(setToStartOfDay(value),this._o.minDate=value,this._o.minYear=value.getFullYear(),this._o.minMonth=value.getMonth()):(this._o.minDate=defaults.minDate,this._o.minYear=defaults.minYear,this._o.minMonth=defaults.minMonth,this._o.startRange=defaults.startRange),this.draw()},setMaxDate:function(value){value instanceof Date?(setToStartOfDay(value),this._o.maxDate=value,this._o.maxYear=value.getFullYear(),this._o.maxMonth=value.getMonth()):(this._o.maxDate=defaults.maxDate,this._o.maxYear=defaults.maxYear,this._o.maxMonth=defaults.maxMonth,this._o.endRange=defaults.endRange),this.draw()},setStartRange:function(value){this._o.startRange=value},setEndRange:function(value){this._o.endRange=value},draw:function(force){if(this._v||force){var randId,opts=this._o,minYear=opts.minYear,maxYear=opts.maxYear,minMonth=opts.minMonth,maxMonth=opts.maxMonth,html="",legend=void 0!==opts.legend?opts.legend:"";this._y<=minYear&&(this._y=minYear,!isNaN(minMonth)&&this._m<minMonth&&(this._m=minMonth)),this._y>=maxYear&&(this._y=maxYear,!isNaN(maxMonth)&&this._m>maxMonth&&(this._m=maxMonth)),randId="pika-title-"+Math.random().toString(36).replace(/[^a-z]+/g,"").substr(0,2);for(var c=0;c<opts.numberOfMonths;c++)html+='<div class="pika-lendar">'+renderTitle(this,c,this.calendars[c].year,this.calendars[c].month,this.calendars[0].year,randId)+this.render(this.calendars[c].year,this.calendars[c].month,randId)+legend+"</div>";this.el.innerHTML=html,opts.bound&&"hidden"!==opts.field.type&&sto(function(){opts.trigger.focus()},1),"function"==typeof this._o.onDraw&&this._o.onDraw(this),opts.bound&&opts.field.setAttribute("aria-label",opts.ariaLabel)}},adjustPosition:function(){var field,pEl,width,height,viewportWidth,viewportHeight,scrollTop,left,top,clientRect;if(!this._o.container){if(this.el.style.position="absolute",field=this._o.trigger,pEl=field,width=this.el.offsetWidth,height=this.el.offsetHeight,viewportWidth=window.innerWidth||document.documentElement.clientWidth,viewportHeight=window.innerHeight||document.documentElement.clientHeight,scrollTop=window.pageYOffset||document.body.scrollTop||document.documentElement.scrollTop,"function"==typeof field.getBoundingClientRect)clientRect=field.getBoundingClientRect(),left=clientRect.left+window.pageXOffset,top=clientRect.bottom+window.pageYOffset;else for(left=pEl.offsetLeft,top=pEl.offsetTop+pEl.offsetHeight;pEl=pEl.offsetParent;)left+=pEl.offsetLeft,top+=pEl.offsetTop;(this._o.reposition&&left+width>viewportWidth||this._o.position.indexOf("right")>-1&&left-width+field.offsetWidth>0)&&(left=left-width+field.offsetWidth),this._o.reposition&&top+height>viewportHeight+scrollTop||this._o.position.indexOf("top")>-1&&top-height-field.offsetHeight>0?top=top-height-field.offsetHeight:this._o.position.indexOf("right")>-1&&(left=left-width+field.offsetWidth),this.el.style.left=left+"px",this.el.style.top=top+"px"}},render:function(year,month,randId){var opts=this._o,now=new Date,days=getDaysInMonth(year,month),before=new Date(year,month,1).getDay(),data=[],row=[];setToStartOfDay(now),opts.firstDay>0&&(before-=opts.firstDay)<0&&(before+=7);for(var previousMonth=0===month?11:month-1,nextMonth=11===month?0:month+1,yearOfPreviousMonth=0===month?year-1:year,yearOfNextMonth=11===month?year+1:year,daysInPreviousMonth=getDaysInMonth(yearOfPreviousMonth,previousMonth),cells=days+before,after=cells;after>7;)after-=7;cells+=7-after;for(var isWeekSelected=!1,i=0,r=0;i<cells;i++){var day=new Date(year,month,i-before+1),isSelected=!!isDate(this._d)&&compareDates(day,this._d),isToday=compareDates(day,now),hasEvent=opts.events.indexOf(day.toDateString())!==-1,isEmpty=i<before||i>=days+before,dayNumber=i-before+1,monthNumber=month,yearNumber=year,isStartRange=opts.startRange&&compareDates(opts.startRange,day),isEndRange=opts.endRange&&compareDates(opts.endRange,day),isInRange=opts.startRange&&opts.endRange&&opts.startRange<day&&day<opts.endRange,isDisabled=opts.minDate&&day<opts.minDate||opts.maxDate&&day>opts.maxDate||opts.disableWeekends&&isWeekend(day)||opts.disableDayFn&&opts.disableDayFn(day),isNotAvailable="function"==typeof opts.isNotAvailable&&opts.isNotAvailable(day),isDeal="function"==typeof opts.isDeal&&opts.isDeal(day);isEmpty&&(i<before?(dayNumber=daysInPreviousMonth+dayNumber,monthNumber=previousMonth,yearNumber=yearOfPreviousMonth):(dayNumber-=days,monthNumber=nextMonth,yearNumber=yearOfNextMonth));var dayConfig={day:dayNumber,month:monthNumber,year:yearNumber,hasEvent:hasEvent,isSelected:isSelected,isToday:isToday,isDisabled:isDisabled,isEmpty:isEmpty,isStartRange:isStartRange,isEndRange:isEndRange,isInRange:isInRange,showDaysInNextAndPreviousMonths:opts.showDaysInNextAndPreviousMonths,enableSelectionDaysInNextAndPreviousMonths:opts.enableSelectionDaysInNextAndPreviousMonths,isNotAvailable:isNotAvailable,isDeal:isDeal};opts.pickWholeWeek&&isSelected&&(isWeekSelected=!0),row.push(renderDay(dayConfig)),7==++r&&(opts.showWeekNumber&&row.unshift(renderWeek(i-before,month,year)),data.push(renderRow(row,opts.isRTL,opts.pickWholeWeek,isWeekSelected)),row=[],r=0,isWeekSelected=!1)}return renderTable(opts,data,randId)},isVisible:function(){return this._v},show:function(){this.isVisible()||(this._v=!0,this.draw(),removeClass(this.el,"is-hidden"),this._o.bound&&(addEvent(document,"click",this._onClick),this.adjustPosition()),"function"==typeof this._o.onOpen&&this._o.onOpen.call(this))},hide:function(){var v=this._v;v!==!1&&(this._o.bound&&removeEvent(document,"click",this._onClick),this.el.style.position="static",this.el.style.left="auto",this.el.style.top="auto",addClass(this.el,"is-hidden"),this._v=!1,void 0!==v&&"function"==typeof this._o.onClose&&this._o.onClose.call(this))},destroy:function(){var opts=this._o;this.hide(),removeEvent(this.el,"mousedown",this._onMouseDown,!0),removeEvent(this.el,"touchend",this._onMouseDown,!0),removeEvent(this.el,"change",this._onChange),opts.keyboardInput&&removeEvent(document,"keydown",this._onKeyChange),opts.field&&(removeEvent(opts.field,"change",this._onInputChange),opts.bound&&(removeEvent(opts.trigger,"click",this._onInputClick),removeEvent(opts.trigger,"focus",this._onInputFocus),removeEvent(opts.trigger,"blur",this._onInputBlur))),this.el.parentNode&&this.el.parentNode.removeChild(this.el)}},Pikaday})},{moment:"moment"}],3:[function(require,module,exports){module.exports=function(root){var __ret={render:function(__tn,__da){"object"==typeof __tn&&(__da=__tn,__tn=void 0),"string"==typeof __tn&&(__da=__da||{});var __f={isset:function(any){return void 0!==any},empty:function(obj){var n=0;for(var i in obj)obj.hasOwnProperty(i)&&n++;return!(n>0)},date_format:function(time,format){if(time=time instanceof Date?time:new Date(+time),format){var o={"%m":time.getMonth()+1,"%d":time.getDate(),"%H":time.getHours(),"%M":time.getMinutes(),"%S":time.getSeconds(),"%s":time.getMilliseconds()};/(\%Y)/.test(format)&&(format=format.replace(RegExp.$1,time.getFullYear()+""));for(var k in o)o.hasOwnProperty(k)&&new RegExp("("+k+")").test(format)&&(format=format.replace(RegExp.$1,1===RegExp.$1.length?o[k]:("00"+o[k]).substr((""+o[k]).length)))}else format=time.toDateString();return format},count:function(obj){var n=0;for(var i in obj)obj.hasOwnProperty(i)&&n++;return n}},__func={__fn__gygtext:function(params){try{return require("meta-dictionary").global().get(params.key)}catch(error){}}},__h="",smarty={foreach:{},capture:{},ldelim:"{",rdelim:"}"},__v=function(){for(var __va=Array.prototype.slice.call(arguments),__vi=0,__vl=__va.length;__vi<__vl;__vi++){var __vd=__va[__vi];if(void 0!=__vd&&""+__vd!="NaN")return"function"==typeof __vd?__vd():__vd}};if(__h+='<article class="activity-card activity-card-flex activity-card-',__h+=__v(__v(__da.activity,{}).activityCardVersion),__h+="\t\t\t\t\t",__v(__v(__da.activity,{}).hasDeal)&&(__h+=" has-deal"),__h+="\t\t\t\t\t",__v(__v(__da.activity,{}).hasBanner)&&(__h+=" has-banner"),__h+="\t\t\t\t\t",__v(__v(__da.activity,{}).hideImage)&&(__h+=" hide-image"),__h+="\t\t\t\t\t",__f.isset(__v(__da.cardClass))&&(__h+=__v(__da.cardClass)),__h+="\t\t\t\t\t",__f.isset(__v(__v(__da.activity,{}).isPromoted))&&__v(__v(__da.activity,{}).isPromoted)&&(__h+=" is-promoted"),__h+="\t\t\t\t\t",__f.empty(__v(__v(__da.activity,{}).specialPriceWithBookingFee))||(__h+=" price-with-booking-fee"),__h+='"\t\t data-href="',__h+=__v(__v(__da.activity,{}).url),__h+='" id="t',__h+=__v(__v(__da.activity,{}).tourId),__h+='">',__h+='\t<a class="activity-card-link" href="',__h+=__v(__v(__da.activity,{}).url),__h+='">\t\t<div class="activity-card-content">\t\t\t<div class="activity-card-left-column-container ',__v(__v(__da.activity,{}).hideImage)&&(__h+="hidden"),__h+='">\t\t\t\t<div class="activity-card-image-container">\t\t\t\t\t',!__f.isset(__v(__da.isMobile))||!__v(__da.isMobile)||__f.isset(__v(__v(__da.experiments,{}).hasMobileVerticalCards))&&__v(__v(__da.experiments,{}).hasMobileVerticalCards)?"mobile"==__v(__v(__da.activity,{}).activityCardVersion)?(__h+='\t\t\t\t\t\t<img class="lazy" data-src="',__h+=__v(__v(__da.activity,{}).mobileImageUrl),__h+='" data-role="cover" alt="" width="90" height="90" src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" />\t\t\t\t\t'):"vertical"==__v(__v(__da.activity,{}).activityCardVersion)?(__h+='\t\t\t\t\t\t<img class="lazy" data-src="',__h+=__v(__v(__da.activity,{}).verticalImageUrl),__h+='" data-role="cover" alt="" src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" />\t\t\t\t\t'):(__h+='\t\t\t\t\t\t<img class="lazy" data-src="',__h+=__v(__v(__da.activity,{}).horizontalImageUrl),__h+='" data-role="cover" alt="" src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" />\t\t\t\t\t'):(__h+='\t\t\t\t\t\t<img class="lazy" data-src="',__h+=__v(__v(__da.activity,{}).mobileImageUrl),__h+='" data-role="cover" alt="" width="90" height="90" src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" />\t\t\t\t\t'),__h+="\t\t\t\t\t",__v(__v(__da.activity,{}).isCertifiedPartner)){__h+="\t\t\t\t\t\t";var __ic2375={};__ic2375.inline=!0,__ic2375.partnerBadgeType="card",__ic2375.partnerBadgeTitle=__v(__v(__v(__ic2375.activityCardList,{}).labels,{}).partnerBadgeTitle,__v(__v(__da.activityCardList,{}).labels,{}).partnerBadgeTitle),__ic2375.partnerBadgeDescription=__v(__v(__v(__ic2375.activityCardList,{}).labels,{}).partnerBadgeDescription,__v(__v(__da.activityCardList,{}).labels,{}).partnerBadgeDescription),__h+='<div class="certified-badge certified-badge-',__h+=__v(__ic2375.partnerBadgeType,__da.partnerBadgeType),__h+="\t\t",__f.isset(__v(__ic2375.hasCertifiedBadgeModal,__da.hasCertifiedBadgeModal))&&__v(__ic2375.hasCertifiedBadgeModal,__da.hasCertifiedBadgeModal)&&(__h+=' certified-badge-modal-trigger" data-modal="#certified-badge-mobile-modal'),__h+='" data-component="certified-badge">\t',__v(__ic2375.partnerBadgeTitle,__da.partnerBadgeTitle)&&(__h+='<span class="certified-badge-title">',__h+=__v(__ic2375.partnerBadgeTitle,__da.partnerBadgeTitle),__h+="</span>"),__h+="\t",__f.isset(__v(__ic2375.hasCertifiedBadgeModal,__da.hasCertifiedBadgeModal))&&__v(__ic2375.hasCertifiedBadgeModal,__da.hasCertifiedBadgeModal)||(__h+='\t\t<div class="badge-tooltip certified-badge-modal">\t\t\t<div class="arrow"></div>\t\t\t<div class="modal-body certified-badge-description">\t\t\t\t',__h+=__v(__ic2375.partnerBadgeDescription,__da.partnerBadgeDescription),__h+="\t\t\t</div>\t\t</div>\t"),__h+="</div>",
__f.isset(__v(__ic2375.hasCertifiedBadgeModal,__da.hasCertifiedBadgeModal))&&__v(__ic2375.hasCertifiedBadgeModal,__da.hasCertifiedBadgeModal)&&(__h+='\t<div id="certified-badge-mobile-modal" class="modal certified-badge-mobile-modal" role="dialog" tabindex="-1" aria-hidden="true">\t\t<div class="modal-container">\t\t\t<button type="button" class="modal-close icon-close-light"></button>\t\t\t<div class="modal-body">\t\t\t\t<div class="certified-badge-graphic"></div>\t\t\t\t<p class="modal-title">',__h+=__func.__fn__gygtext({key:"pTour_details GetYourGuide certified"}),__h+='</p>\t\t\t\t<p class="certified-badge-text">',__h+=__func.__fn__gygtext({key:"pTour_details GetYourGuide certified description"}),__h+='</p>\t\t\t\t<span class="modal-close close-badge-modal">',__h+=__func.__fn__gygtext({key:"pBooking_options close datepicker"}),__h+="</span>\t\t\t</div>\t\t</div>\t</div>"),__h+="\t\t\t\t\t"}if(__h+='\t\t\t\t</div>\t\t\t</div>\t\t\t<div class="activity-card-inner-content">\t\t\t\t<header class="activity-card-header">\t\t\t\t\t<h3 class="activity-card-title">',__f.isset(__v(__v(__da.activity,{}).optionLabel))&&__v(__v(__da.activity,{}).optionLabel)&&(__h+='<span class="highlight-red">',__h+=__v(__v(__da.activity,{}).optionLabel),__h+="</span>"),__h+=__v(__v(__da.activity,{}).title),__h+="</h3>\t\t\t\t\t",__v(__v(__da.activity,{}).displayWishlist)&&__v(__v(__da.activity,{}).tourId)){__h+="\t\t\t\t\t\t";var __ic2378={};__ic2378.inline=!0,__ic2378.id=__v(__v(__ic2378.activity,{}).tourId,__v(__da.activity,{}).tourId),__ic2378.addToWishlistText=__v(__v(__v(__ic2378.activityCardList,{}).labels,{}).addToWishlist,__v(__v(__da.activityCardList,{}).labels,{}).addToWishlist),__ic2378.removeFromWishlistText=__v(__v(__v(__ic2378.activityCardList,{}).labels,{}).removeFromWishlist,__v(__v(__da.activityCardList,{}).labels,{}).removeFromWishlist),__h+='<div class="wishlist-handler wishlist-button" data-role="wishlist-handler" data-id="',__h+=__f.isset(__v(__v(__ic2378.activity,{}).wishListId,__v(__da.activity,{}).wishListId))?__v(__v(__ic2378.activity,{}).wishListId,__v(__da.activity,{}).wishListId):__v(__ic2378.id,__da.id),__h+='">\t<div data-action="add-to-wishlist" class="add-to-wishlist action-handler">\t\t<span class="action-label">\t\t\t<span class="action-label-text">',__h+=__v(__ic2378.addToWishlistText,__da.addToWishlistText),__h+='</span>\t\t</span>\t\t<span class="icon icon-heart"></span>\t</div>\t<div data-action="remove-from-wishlist" class="remove-from-wishlist action-handler">\t\t<span class="action-label">\t\t\t<span class="action-label-text">',__h+=__v(__ic2378.removeFromWishlistText,__da.removeFromWishlistText),__h+='</span>\t\t</span>\t\t<span class="icon icon-cancel"></span>\t</div></div>',__h+="\t\t\t\t\t"}if(__h+="\t\t\t\t\t",__v(__v(__da.activity,{}).displayRemoveButton)){__h+="\t\t\t\t\t\t";var __ic2381={};__ic2381.inline=!0,__ic2381.id=__v(__v(__ic2381.activity,{}).tourId,__v(__da.activity,{}).tourId),__ic2381.removeFromWishlistText=__v(__v(__v(__ic2381.activityCardList,{}).labels,{}).removeFromWishlist,__v(__v(__da.activityCardList,{}).labels,{}).removeFromWishlist),__h+='<div class="remove-history-item-button" data-role="remove-handler" data-id="',__h+=__f.isset(__v(__v(__ic2381.activity,{}).wishListId,__v(__da.activity,{}).wishListId))?__v(__v(__ic2381.activity,{}).wishListId,__v(__da.activity,{}).wishListId):__v(__ic2381.id,__da.id),__h+='">\t<div data-action="remove-history-item" class="remove-history-item action-handler">\t\t<span class="action-label">\t\t\t<span class="action-label-text">',__h+=__v(__ic2381.removeFromWishlistText,__da.removeFromWishlistText),__h+='</span>\t\t</span>\t\t<span class="icon icon-cancel"></span>\t</div></div>',__h+="\t\t\t\t\t"}if(__h+="\t\t\t\t</header>\t\t\t\t",__h+="\t\t\t\t",__v(__v(__da.activity,{}).displayDuration)&&__v(__v(__da.activity,{}).duration)&&!__v(__v(__v(__da.activity,{}).experiments,{}).hideDuration)&&(__h+='\t\t\t\t\t<div class="activity-duration activity-duration-full-width">\t\t\t\t\t\t<span class="icon-duration"></span><em class="duration-label">',__h+="\t\t\t\t\t\t\t",__h+=__v(__v(__v(__da.activityCardList,{}).labels,{}).duration),__h+=":\t\t\t\t\t\t",__h+="</em>&nbsp;",__h+=__v(__v(__da.activity,{}).duration),__h+="\t\t\t\t\t</div>\t\t\t\t"),__h+='\t\t\t\t<div class="activity-card-details">\t\t\t\t\t<div class="activity-card-details-body">\t\t\t\t\t\t',__v(__v(__da.activity,{}).hasRating)){__h+='\t\t\t\t\t\t\t<div class="activity-rating-horizontal">\t\t\t\t\t\t\t\t<div class="activity-rating rating-big">\t\t\t\t\t\t\t\t\t';var __ic2384={};__ic2384.inline=!0,__ic2384.hasRating=__v(__v(__ic2384.activity,{}).hasRating,__v(__da.activity,{}).hasRating),__ic2384.averageRating=__v(__v(__ic2384.activity,{}).averageRating,__v(__da.activity,{}).averageRating),__ic2384.totalRating=__v(__v(__ic2384.activity,{}).totalRating,__v(__da.activity,{}).totalRating),__ic2384.ratingStyleModifier=null,__ic2384.totalRatingTitle=__v(__v(__ic2384.activity,{}).totalRatingTitle,__v(__da.activity,{}).totalRatingTitle),__ic2384.ratingLink=null,__ic2384.averageRatingClass=__v(__v(__ic2384.activity,{}).averageRatingClass,__v(__da.activity,{}).averageRatingClass),__ic2384.ratingTextShort=!1,__ic2384.ratingStarsClasses=__v(__v(__ic2384.activity,{}).ratingStarsClasses,__v(__da.activity,{}).ratingStarsClasses),__ic2384.ratingTitle=__v(__v(__ic2384.activity,{}).ratingTitle,__v(__da.activity,{}).ratingTitle),__v(__ic2384.hasRating,__da.hasRating)&&(__h+='\t<span class="rating" title="',__h+=__v(__ic2384.ratingTitle,__da.ratingTitle),__h+='">\t\t<span class="rating-stars s',__h+=__v(__ic2384.averageRatingClass,__da.averageRatingClass),__v(__ic2384.ratingStyleModifier,__da.ratingStyleModifier)&&(__h+=" rating-stars--",__h+=__v(__ic2384.ratingStyleModifier,__da.ratingStyleModifier)),__h+=__v(__ic2384.ratingStarsClasses,__da.ratingStarsClasses),__h+='"></span>\t\t',__f.isset(__v(__ic2384.totalRating,__da.totalRating))&&__v(__ic2384.totalRating,__da.totalRating)>0&&(__h+="\t\t\t",__v(__ic2384.ratingLink,__da.ratingLink)?(__h+='\t\t\t\t<a class="rating-total rating-link" href="',__h+=__v(__ic2384.ratingLink,__da.ratingLink),__h+='" id="rating-link">\t\t\t\t\t',__f.isset(__v(__ic2384.ratingTextShort,__da.ratingTextShort))&&__v(__ic2384.ratingTextShort,__da.ratingTextShort)?(__h+="\t\t\t\t\t\t",__h+=__v(__ic2384.totalRating,__da.totalRating),__h+="\t\t\t\t\t"):(__h+="\t\t\t\t\t\t",__h+=__v(__ic2384.totalRatingTitle,__da.totalRatingTitle),__h+="\t\t\t\t\t"),__h+="\t\t\t\t</a>\t\t\t"):(__h+='\t\t\t\t<span class="rating-total">',__h+=__f.isset(__v(__ic2384.ratingTextShort,__da.ratingTextShort))&&__v(__ic2384.ratingTextShort,__da.ratingTextShort)?__v(__ic2384.totalRating,__da.totalRating):__v(__ic2384.totalRatingTitle,__da.totalRatingTitle),__h+="</span>\t\t\t"),__h+="\t\t"),__h+="\t</span>"),__h+="\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t\t",__v(__da.isMobile)||(__h+='\t\t\t\t\t\t\t\t\t<div class="activity-card-badges minimal">\t\t\t\t\t\t\t\t\t\t',__v(__v(__da.activity,{}).isPromoted)?(__h+='\t\t\t\t\t\t\t\t\t\t\t<div class="activity-badge is-promoted">\t\t\t\t\t\t\t\t\t\t\t\t<span>',__h+=__v(__v(__v(__da.activityCardList,{}).labels,{}).newActivityBanner),__h+="</span>\t\t\t\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t\t\t\t"):__v(__v(__da.activity,{}).isBestseller)?(__h+='\t\t\t\t\t\t\t\t\t\t\t<div class="activity-badge is-bestseller">\t\t\t\t\t\t\t\t\t\t\t\t<span class="icon icon-crown">',__h+=__v(__v(__v(__da.activityCardList,{}).labels,{}).bestseller),__h+="</span>\t\t\t\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t\t\t\t"):__v(__v(__da.activity,{}).isLikelyToSellOut)?(__h+='\t\t\t\t\t\t\t\t\t\t\t<div class="activity-badge is-likely-to-sell-out">\t\t\t\t\t\t\t\t\t\t\t\t<span>',__h+=__v(__v(__v(__da.activityCardList,{}).labels,{}).likelyToSellOut),__h+="</span>\t\t\t\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t\t\t\t"):__v(__v(__da.activity,{}).isBoostedNewTour)&&(__h+='\t\t\t\t\t\t\t\t\t\t\t<div class="activity-badge is-featured">\t\t\t\t\t\t\t\t\t\t\t\t<span class="icon icon-crown">',__h+=__v(__v(__v(__da.activityCardList,{}).labels,{}).featuredActivities),__h+="</span>\t\t\t\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t\t\t\t"),__h+="\t\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t\t"),__h+='\t\t\t\t\t\t\t\t<div class="activity-rating rating-small">\t\t\t\t\t\t\t\t\t';var __ic2387={};__ic2387.inline=!0,__ic2387.hasRating=__v(__v(__ic2387.activity,{}).hasRating,__v(__da.activity,{}).hasRating),__ic2387.averageRating=__v(__v(__ic2387.activity,{}).averageRating,__v(__da.activity,{}).averageRating),__ic2387.totalRating=__v(__v(__ic2387.activity,{}).totalRating,__v(__da.activity,{}).totalRating),__ic2387.ratingStyleModifier="small",__ic2387.totalRatingTitle=__v(__v(__ic2387.activity,{}).totalRatingTitle,__v(__da.activity,{}).totalRatingTitle),__ic2387.ratingLink=null,__ic2387.averageRatingClass=__v(__v(__ic2387.activity,{}).averageRatingClass,__v(__da.activity,{}).averageRatingClass),__ic2387.ratingTextShort=!0,__ic2387.ratingStarsClasses=__v(__v(__ic2387.activity,{}).ratingStarsClasses,__v(__da.activity,{}).ratingStarsClasses),__ic2387.ratingTitle=__v(__v(__ic2387.activity,{}).ratingTitle,__v(__da.activity,{}).ratingTitle),__v(__ic2387.hasRating,__da.hasRating)&&(__h+='\t<span class="rating" title="',__h+=__v(__ic2387.ratingTitle,__da.ratingTitle),__h+='">\t\t<span class="rating-stars s',__h+=__v(__ic2387.averageRatingClass,__da.averageRatingClass),__v(__ic2387.ratingStyleModifier,__da.ratingStyleModifier)&&(__h+=" rating-stars--",__h+=__v(__ic2387.ratingStyleModifier,__da.ratingStyleModifier)),__h+=__v(__ic2387.ratingStarsClasses,__da.ratingStarsClasses),__h+='"></span>\t\t',__f.isset(__v(__ic2387.totalRating,__da.totalRating))&&__v(__ic2387.totalRating,__da.totalRating)>0&&(__h+="\t\t\t",__v(__ic2387.ratingLink,__da.ratingLink)?(__h+='\t\t\t\t<a class="rating-total rating-link" href="',__h+=__v(__ic2387.ratingLink,__da.ratingLink),__h+='" id="rating-link">\t\t\t\t\t',__f.isset(__v(__ic2387.ratingTextShort,__da.ratingTextShort))&&__v(__ic2387.ratingTextShort,__da.ratingTextShort)?(__h+="\t\t\t\t\t\t",__h+=__v(__ic2387.totalRating,__da.totalRating),__h+="\t\t\t\t\t"):(__h+="\t\t\t\t\t\t",__h+=__v(__ic2387.totalRatingTitle,__da.totalRatingTitle),__h+="\t\t\t\t\t"),__h+="\t\t\t\t</a>\t\t\t"):(__h+='\t\t\t\t<span class="rating-total">',__h+=__f.isset(__v(__ic2387.ratingTextShort,__da.ratingTextShort))&&__v(__ic2387.ratingTextShort,__da.ratingTextShort)?__v(__ic2387.totalRating,__da.totalRating):__v(__ic2387.totalRatingTitle,__da.totalRatingTitle),__h+="</span>\t\t\t"),__h+="\t\t"),__h+="\t</span>"),__h+="\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t</div>\t\t\t\t\t\t"}else __v(__v(__da.activity,{}).isPromoted)&&(__h+='\t\t\t\t\t\t\t<div class="activity-rating-horizontal">\t\t\t\t\t\t\t\t<div class="activity-rating rating-big">\t\t\t\t\t\t\t\t\t<span class="no-reviews-message">',__h+=__v(__v(__v(__da.activityCardList,{}).labels,{}).noReviews),__h+='</span>\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t\t<div class="activity-rating rating-small">\t\t\t\t\t\t\t\t\t<span class="no-reviews-message">',__h+=__v(__v(__v(__da.activityCardList,{}).labels,{}).noReviews),__h+="</span>\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t</div>\t\t\t\t\t\t");if(__h+="\t\t\t\t\t\t",__v(__v(__da.activity,{}).hasRating)&&"vertical"!=__v(__v(__da.activity,{}).activityCardVersion)||__v(__da.isMobile)||(__h+='\t\t\t\t\t\t\t<div class="activity-card-badges minimal">\t\t\t\t\t\t\t\t',__v(__v(__da.activity,{}).isPromoted)?(__h+='\t\t\t\t\t\t\t\t\t<div class="activity-badge is-promoted">\t\t\t\t\t\t\t\t\t\t<span>',__h+=__v(__v(__v(__da.activityCardList,{}).labels,{}).newActivityBanner),__h+="</span>\t\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t\t"):__v(__v(__da.activity,{}).isBestseller)?(__h+='\t\t\t\t\t\t\t\t\t<div class="activity-badge is-bestseller">\t\t\t\t\t\t\t\t\t\t<span class="icon icon-crown">',__h+=__v(__v(__v(__da.activityCardList,{}).labels,{}).bestseller),__h+="</span>\t\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t\t"):__v(__v(__da.activity,{}).isLikelyToSellOut)?(__h+='\t\t\t\t\t\t\t\t\t<div class="activity-badge is-likely-to-sell-out">\t\t\t\t\t\t\t\t\t\t<span>',__h+=__v(__v(__v(__da.activityCardList,{}).labels,{}).likelyToSellOut),__h+="</span>\t\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t\t"):__v(__v(__da.activity,{}).isBoostedNewTour)&&(__h+='\t\t\t\t\t\t\t\t\t<div class="activity-badge is-featured">\t\t\t\t\t\t\t\t\t\t<span class="icon icon-crown">',__h+=__v(__v(__v(__da.activityCardList,{}).labels,{}).featuredActivities),__h+="</span>\t\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t\t"),__h+="\t\t\t\t\t\t\t</div>\t\t\t\t\t\t"),__h+="\t\t\t\t\t\t",__v(__v(__da.activity,{}).smallDescription)&&__f.empty(__v(__v(__v(__da.activity,{}).experiments,{}).whatsIncluded))?(__h+='\t\t\t\t\t\t\t<p class="activity-description small-description">',__h+=__v(__v(__da.activity,{}).smallDescription),__h+="</p>\t\t\t\t\t\t"):__v(__v(__da.activity,{}).description)&&__f.empty(__v(__v(__v(__da.activity,{}).experiments,{}).whatsIncluded))&&(__h+='\t\t\t\t\t\t\t<p class="activity-description">',__h+=__v(__v(__da.activity,{}).description),__h+="</p>\t\t\t\t\t\t"),__h+='\t\t\t\t\t</div>\t\t\t\t\t<div class="activity-card-details-footer">\t\t\t\t\t\t<div class="activity-card-details-left">\t\t\t\t\t\t\t',__v(__v(__da.activity,{}).displayDate)&&!__f.empty(__v(__v(__da.activity,{}).dateAddedToWishlist))&&(__h+='\t\t\t\t\t\t\t\t<p class="activity-small-description">',__h+=__v(__v(__v(__da.activityCardList,{}).labels,{}).addedToWishlistOn),__h+=":&nbsp;",__h+=__f.date_format(__v(__v(__da.activity,{}).dateAddedToWishlist),__v(__da.dateFormat)),__h+="</p>\t\t\t\t\t\t\t"),__h+="\t\t\t\t\t\t\t",__h+="\t\t\t\t\t\t\t",__v(__v(__da.activity,{}).displayDuration)&&__v(__v(__da.activity,{}).duration)&&!__v(__v(__v(__da.activity,{}).experiments,{}).hideDuration)&&(__h+='\t\t\t\t\t\t\t\t<div class="activity-duration">\t\t\t\t\t\t\t\t\t<span class="icon-duration"></span><em class="duration-label">',__h+="\t\t\t\t\t\t\t\t\t\t",__h+=__v(__v(__v(__da.activityCardList,{}).labels,{}).duration),__h+=":\t\t\t\t\t\t\t\t\t",__h+="</em>&nbsp;",__h+=__v(__v(__da.activity,{}).duration),__h+="\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t"),__h+="\t\t\t\t\t\t\t",__v(__v(__da.activity,{}).isPromoted)?(__h+='\t\t\t\t\t\t\t\t<div class="mobile-activity-badge is-promoted">\t\t\t\t\t\t\t\t\t<span>',__h+=__v(__v(__v(__da.activityCardList,{}).labels,{}).newActivityBanner),__h+="</span>\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t"):__v(__v(__da.activity,{}).isSpecialOffer)?(__h+='\t\t\t\t\t\t\t\t<div class="mobile-activity-badge is-special-offer">\t\t\t\t\t\t\t\t\t<span>',__h+=__v(__v(__v(__da.activityCardList,{}).labels,{}).specialOffer),__h+="</span>\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t"):__v(__v(__da.activity,{}).isLikelyToSellOut)?(__h+='\t\t\t\t\t\t\t\t<div class="mobile-activity-badge is-likely-to-sell-out">\t\t\t\t\t\t\t\t\t<span>',__h+=__v(__v(__v(__da.activityCardList,{}).labels,{}).likelyToSellOut),__h+="</span>\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t"):__v(__v(__da.activity,{}).isBestseller)?(__h+='\t\t\t\t\t\t\t\t<div class="mobile-activity-badge is-bestseller">\t\t\t\t\t\t\t\t\t<span>',__h+=__v(__v(__v(__da.activityCardList,{}).labels,{}).bestseller),__h+="</span>\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t"):__v(__v(__da.activity,{}).isBoostedNewTour)&&(__h+='\t\t\t\t\t\t\t\t<div class="mobile-activity-badge is-featured">\t\t\t\t\t\t\t\t\t<span>',__h+=__v(__v(__v(__da.activityCardList,{}).labels,{}).featuredActivities),__h+="</span>\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t"),__h+='\t\t\t\t\t\t\t<div class="mobile-activity-spacer"></div>\t\t\t\t\t\t\t',__v(__v(__da.activity,{}).hasRating)){__h+='\t\t\t\t\t\t\t\t<div class="activity-rating-vertical">\t\t\t\t\t\t\t\t\t<div class="activity-rating rating-big">\t\t\t\t\t\t\t\t\t\t';var __ic2390={};if(__ic2390.inline=!0,__ic2390.hasRating=__v(__v(__ic2390.activity,{}).hasRating,__v(__da.activity,{}).hasRating),__ic2390.averageRating=__v(__v(__ic2390.activity,{}).averageRating,__v(__da.activity,{}).averageRating),__ic2390.totalRating=__v(__v(__ic2390.activity,{}).totalRating,__v(__da.activity,{}).totalRating),__ic2390.ratingStyleModifier=null,__ic2390.totalRatingTitle=__v(__v(__ic2390.activity,{}).totalRatingTitle,__v(__da.activity,{}).totalRatingTitle),__ic2390.ratingLink=null,__ic2390.averageRatingClass=__v(__v(__ic2390.activity,{}).averageRatingClass,__v(__da.activity,{}).averageRatingClass),__ic2390.ratingTextShort=!1,__ic2390.ratingStarsClasses=__v(__v(__ic2390.activity,{}).ratingStarsClasses,__v(__da.activity,{}).ratingStarsClasses),__ic2390.ratingTitle=__v(__v(__ic2390.activity,{}).ratingTitle,__v(__da.activity,{}).ratingTitle),__v(__ic2390.hasRating,__da.hasRating)&&(__h+='\t<span class="rating" title="',__h+=__v(__ic2390.ratingTitle,__da.ratingTitle),__h+='">\t\t<span class="rating-stars s',__h+=__v(__ic2390.averageRatingClass,__da.averageRatingClass),__v(__ic2390.ratingStyleModifier,__da.ratingStyleModifier)&&(__h+=" rating-stars--",__h+=__v(__ic2390.ratingStyleModifier,__da.ratingStyleModifier)),__h+=__v(__ic2390.ratingStarsClasses,__da.ratingStarsClasses),__h+='"></span>\t\t',__f.isset(__v(__ic2390.totalRating,__da.totalRating))&&__v(__ic2390.totalRating,__da.totalRating)>0&&(__h+="\t\t\t",__v(__ic2390.ratingLink,__da.ratingLink)?(__h+='\t\t\t\t<a class="rating-total rating-link" href="',__h+=__v(__ic2390.ratingLink,__da.ratingLink),__h+='" id="rating-link">\t\t\t\t\t',__f.isset(__v(__ic2390.ratingTextShort,__da.ratingTextShort))&&__v(__ic2390.ratingTextShort,__da.ratingTextShort)?(__h+="\t\t\t\t\t\t",__h+=__v(__ic2390.totalRating,__da.totalRating),__h+="\t\t\t\t\t"):(__h+="\t\t\t\t\t\t",__h+=__v(__ic2390.totalRatingTitle,__da.totalRatingTitle),__h+="\t\t\t\t\t"),__h+="\t\t\t\t</a>\t\t\t"):(__h+='\t\t\t\t<span class="rating-total">',__h+=__f.isset(__v(__ic2390.ratingTextShort,__da.ratingTextShort))&&__v(__ic2390.ratingTextShort,__da.ratingTextShort)?__v(__ic2390.totalRating,__da.totalRating):__v(__ic2390.totalRatingTitle,__da.totalRatingTitle),__h+="</span>\t\t\t"),__h+="\t\t"),__h+="\t</span>"),__h+='\t\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t\t\t<div class="activity-rating rating-small">\t\t\t\t\t\t\t\t\t\t',__v(__v(__da.activity,{}).hasRating)){__h+="\t\t\t\t\t\t\t\t\t\t\t";var __ic2393={};__ic2393.inline=!0,__ic2393.hasRating=__v(__v(__ic2393.activity,{}).hasRating,__v(__da.activity,{}).hasRating),__ic2393.averageRating=__v(__v(__ic2393.activity,{}).averageRating,__v(__da.activity,{}).averageRating),__ic2393.totalRating=__v(__v(__ic2393.activity,{}).totalRating,__v(__da.activity,{}).totalRating),__ic2393.ratingStyleModifier="small",__ic2393.totalRatingTitle=__v(__v(__ic2393.activity,{}).totalRatingTitle,__v(__da.activity,{}).totalRatingTitle),__ic2393.ratingLink=null,__ic2393.averageRatingClass=__v(__v(__ic2393.activity,{}).averageRatingClass,__v(__da.activity,{}).averageRatingClass),__ic2393.ratingTextShort=!0,__ic2393.ratingStarsClasses=__v(__v(__ic2393.activity,{}).ratingStarsClasses,__v(__da.activity,{}).ratingStarsClasses),__ic2393.ratingTitle=__v(__v(__ic2393.activity,{}).ratingTitle,__v(__da.activity,{}).ratingTitle),__v(__ic2393.hasRating,__da.hasRating)&&(__h+='\t<span class="rating" title="',__h+=__v(__ic2393.ratingTitle,__da.ratingTitle),__h+='">\t\t<span class="rating-stars s',__h+=__v(__ic2393.averageRatingClass,__da.averageRatingClass),__v(__ic2393.ratingStyleModifier,__da.ratingStyleModifier)&&(__h+=" rating-stars--",__h+=__v(__ic2393.ratingStyleModifier,__da.ratingStyleModifier)),__h+=__v(__ic2393.ratingStarsClasses,__da.ratingStarsClasses),__h+='"></span>\t\t',__f.isset(__v(__ic2393.totalRating,__da.totalRating))&&__v(__ic2393.totalRating,__da.totalRating)>0&&(__h+="\t\t\t",__v(__ic2393.ratingLink,__da.ratingLink)?(__h+='\t\t\t\t<a class="rating-total rating-link" href="',__h+=__v(__ic2393.ratingLink,__da.ratingLink),__h+='" id="rating-link">\t\t\t\t\t',__f.isset(__v(__ic2393.ratingTextShort,__da.ratingTextShort))&&__v(__ic2393.ratingTextShort,__da.ratingTextShort)?(__h+="\t\t\t\t\t\t",__h+=__v(__ic2393.totalRating,__da.totalRating),__h+="\t\t\t\t\t"):(__h+="\t\t\t\t\t\t",__h+=__v(__ic2393.totalRatingTitle,__da.totalRatingTitle),__h+="\t\t\t\t\t"),__h+="\t\t\t\t</a>\t\t\t"):(__h+='\t\t\t\t<span class="rating-total">',__h+=__f.isset(__v(__ic2393.ratingTextShort,__da.ratingTextShort))&&__v(__ic2393.ratingTextShort,__da.ratingTextShort)?__v(__ic2393.totalRating,__da.totalRating):__v(__ic2393.totalRatingTitle,__da.totalRatingTitle),__h+="</span>\t\t\t"),__h+="\t\t"),__h+="\t</span>"),__h+="\t\t\t\t\t\t\t\t\t\t"}__h+="\t\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t"}if(__h+='\t\t\t\t\t\t</div>\t\t\t\t\t\t<div class="activity-card-details-right">\t\t\t\t\t\t\t',__f.empty(__v(__v(__da.activity,{}).specialPriceWithBookingFee))?(__h+='\t\t\t\t\t\t\t\t<div class="activity-card-price-tag">\t\t\t\t\t\t\t\t\t',__v(__v(__da.activity,{}).isPromoted)&&(__h+='\t\t\t\t\t\t\t\t\t\t<span class="price-special-intro from">',__h+=__v(__v(__v(__da.activityCardList,{}).labels,{}).introSpecial),__h+="</span>\t\t\t\t\t\t\t\t\t"),__h+="\t\t\t\t\t\t\t\t\t",__h+="\t\t\t\t\t\t\t\t\t",__v(__v(__v(__da.activity,{}).experiments,{}).hasFromLabel)&&(__h+='\t\t\t\t\t\t\t\t\t\t<span class="from">',__h+=__v(__v(__v(__da.activityCardList,{}).labels,{}).priceFrom),__h+="</span>\t\t\t\t\t\t\t\t\t"),__h+='\t\t\t\t\t\t\t\t\t<span class="price ',__v(__v(__da.activity,{}).hasDeal)&&(__h+="price-reduced"),__h+='">',__h+=__v(__v(__v(__da.activity,{}).price,{}).min),__h+="</span>\t\t\t\t\t\t\t\t\t",__v(__v(__da.activity,{}).hasDeal)&&(__h+='\t\t\t\t\t\t\t\t\t\t<span class="price-original">',__h+=__v(__v(__v(__da.activity,{}).price,{}).original),__h+="</span>\t\t\t\t\t\t\t\t\t"),__h+="\t\t\t\t\t\t\t\t\t","group"==__v(__v(__v(__da.activity,{}).price,{}).type)&&(__h+='\t\t\t\t\t\t\t\t\t\t<span class="per-group"><nobr>',__h+=__v(__v(__v(__da.activityCardList,{}).labels,{}).pricePerGroup),__h+="</nobr></span>\t\t\t\t\t\t\t\t\t"),__h+="\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t"):(__h+='\t\t\t\t\t\t\t\t<div class="activity-card-price-tag">\t\t\t\t\t\t\t\t\t',__h+="\t\t\t\t\t\t\t\t\t",__v(__v(__v(__da.activity,{}).experiments,{}).hasFromLabel)&&(__h+='\t\t\t\t\t\t\t\t\t\t<span class="from">',__h+=__v(__v(__v(__da.activityCardList,{}).labels,{}).priceFrom),__h+="</span>\t\t\t\t\t\t\t\t\t"),__h+='\t\t\t\t\t\t\t\t\t<span class="price">',__h+=__v(__v(__da.activity,{}).specialPriceWithBookingFee),__h+="</span>\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t"),__h+="\t\t\t\t\t\t</div>\t\t\t\t\t</div>\t\t\t\t</div>\t\t\t</div>\t\t</div>\t\t",__v(__v(__da.activity,{}).isFirstTicket)&&__v(__da.isMobile)&&(__h+='\t\t\t<div class="see-details-button">\t\t\t\t',__h+='\t\t\t\t<object class="see-more-obj"><a class="btn btn-cta btn-small" href="',__h+=__v(__v(__da.activity,{}).urlDetailsBtn),__h+='">',__h+=__func.__fn__gygtext({key:"pActivityCard see details text"}),__h+="</a></object>\t\t\t</div>\t\t"),__h+="\t\t",__f.empty(__v(__v(__da.activity,{}).cardBannerMessage))){if(__v(__v(__da.activity,{}).hasFencedDiscountDeal)&&__f.isset(__v(__v(__da.activityCardList,{}).customer))){__h+="\t\t\t";var __ic2399={};__ic2399.inline=!0,__f.isset(__v(__v(__ic2399.activityCardList,{}).customer,__v(__da.activityCardList,{}).customer))?__h+='\t<div class="membership-message-banner-card">':(__h+='\t<a href="',__h+=__v(__v(__ic2399.activityCardList,{}).signupUrl,__v(__da.activityCardList,{}).signupUrl),__h+='" class="membership-message-banner-card is-not-logged-in">'),__h+='\t<span class="membership-message-icon icon icon-ticket-star"></span>\t<span class="membership-message-text">\t\t',__f.isset(__v(__v(__ic2399.activityCardList,{}).customer,__v(__da.activityCardList,{}).customer))?(__h+="\t\t\t",__h+=__v(__v(__v(__ic2399.activityCardList,{}).labels,{}).memberPrice,__v(__v(__da.activityCardList,{}).labels,{}).memberPrice),__h+="\t\t"):(__h+="\t\t\t",__h+=__v(__v(__v(__ic2399.activityCardList,{}).labels,{}).signUpForMemberPrice,__v(__v(__da.activityCardList,{}).labels,{}).signUpForMemberPrice),__h+="\t\t"),__h+="\t</span>",__h+=__f.isset(__v(__v(__ic2399.activityCardList,{}).customer,__v(__da.activityCardList,{}).customer))?"\t</div>":"\t</a>",__h+="\t\t"}}else{__h+="\t\t\t";var __ic2396={};__ic2396.inline=!0,__h+='<div class="activity-card-banner ',__f.empty(__v(__v(__ic2396.activity,{}).cardBannerClass,__v(__da.activity,{}).cardBannerClass))||(__h+=__v(__v(__ic2396.activity,{}).cardBannerClass,__v(__da.activity,{}).cardBannerClass)),__h+='">\t<span class="activity-card-banner-message-text">\t\t',__h+=__v(__v(__ic2396.activity,{}).cardBannerMessage,__v(__da.activity,{}).cardBannerMessage),__h+="\t</span></div>",__h+="\t\t"}if(__h+="\t</a>\t",__v(__v(__da.activity,{}).hasFencedDiscountDeal)&&!__f.isset(__v(__v(__da.activityCardList,{}).customer))){__h+="\t\t";var __ic2402={};__ic2402.inline=!0,__f.isset(__v(__v(__ic2402.activityCardList,{}).customer,__v(__da.activityCardList,{}).customer))?__h+='\t<div class="membership-message-banner-card">':(__h+='\t<a href="',__h+=__v(__v(__ic2402.activityCardList,{}).signupUrl,__v(__da.activityCardList,{}).signupUrl),__h+='" class="membership-message-banner-card is-not-logged-in">'),__h+='\t<span class="membership-message-icon icon icon-ticket-star"></span>\t<span class="membership-message-text">\t\t',__f.isset(__v(__v(__ic2402.activityCardList,{}).customer,__v(__da.activityCardList,{}).customer))?(__h+="\t\t\t",__h+=__v(__v(__v(__ic2402.activityCardList,{}).labels,{}).memberPrice,__v(__v(__da.activityCardList,{}).labels,{}).memberPrice),__h+="\t\t"):(__h+="\t\t\t",__h+=__v(__v(__v(__ic2402.activityCardList,{}).labels,{}).signUpForMemberPrice,__v(__v(__da.activityCardList,{}).labels,{}).signUpForMemberPrice),__h+="\t\t"),__h+="\t</span>",__h+=__f.isset(__v(__v(__ic2402.activityCardList,{}).customer,__v(__da.activityCardList,{}).customer))?"\t</div>":"\t</a>",__h+="\t"}if(__h+="\t",!__f.empty(__v(__v(__da.activity,{}).debug))){__h+="\t\t";var __ic2405={};__h+='<div id="t',__h+=__v(__v(__ic2405.activity,{}).tourId,__v(__da.activity,{}).tourId),__h+='" class="activity-rating-info">\t<table class="activity-rating-table">\t\t<tr>\t\t\t<td class="rating-score">\t\t\t\t<h2>',__h+=__v(__v(__ic2405.activity,{}).title,__v(__da.activity,{}).title),__h+="</h2>\t\t\t\t<h3>",__h+=__v(__v(__v(__ic2405.activity,{}).debug,{}).ratingScore,__v(__v(__da.activity,{}).debug,{}).ratingScore),__h+='</h3>\t\t\t</td>\t\t\t<td class="rating-details">\t\t\t\t<table>\t\t\t\t\t';var __fc2406__d=__v(__v(__v(__ic2405.activity,{}).debug,{}).ratingDetails,__v(__v(__da.activity,{}).debug,{}).ratingDetails),__fc2406fi=0,__fc2406={};for(var __fc2406k in __fc2406__d)__fc2406__d.hasOwnProperty(__fc2406k)&&(smarty.foreach={index:__fc2406fi,iteration:0==__fc2406fi?"":__fc2406fi,key:__fc2406k.replace("__a",""),total:__f.count(__fc2406__d),first:0==__fc2406fi?1:"",last:__fc2406fi==__f.count(__fc2406__d)-1?1:"",show:!!__fc2406__d[__fc2406k]},__fc2406.key=__fc2406k.replace(/__a/g,""),__fc2406.data=__fc2406__d[__fc2406k],__h+="\t\t\t\t\t\t<tr>\t\t\t\t\t\t\t<td>",__h+=__v(__fc2406.key,__ic2405.key,__da.key),__h+=":</td>\t\t\t\t\t\t\t<td>",__h+=__v(__v(__fc2406.data,{}).calculated,__v(__ic2405.data,{}).calculated,__v(__da.data,{}).calculated),__h+="</td>\t\t\t\t\t\t\t<td>[",__h+=__v(__v(__v(__fc2406.data,{}).values,{})[0],__v(__v(__ic2405.data,{}).values,{})[0],__v(__v(__da.data,{}).values,{})[0]),__h+="</td>\t\t\t\t\t\t\t<td>@",__h+=__v(__v(__v(__fc2406.data,{}).values,{})[1],__v(__v(__ic2405.data,{}).values,{})[1],__v(__v(__da.data,{}).values,{})[1]),__h+="]</td>\t\t\t\t\t\t</tr>\t\t\t\t\t",__fc2406fi++);__h+="\t\t\t\t</table>\t\t\t</td>\t\t</tr>\t</table></div>",__h+="\t"}return __h+="</article>",__tn?__func["__fn__"+__tn](__da):__h}};return"object"==typeof exports&&"object"==typeof module&&(exports=module.exports=__ret),"function"==typeof define&&define.amd&&define(__ret),root._smartyTpl=__ret,__ret}(this)},{"meta-dictionary":"meta-dictionary"}],4:[function(require,module,exports){var BaseView=require("base-view"),EventDispatcher=require("event-dispatcher").global(),ActivityCardView=BaseView.extend({events:{"click a.membership-message-banner":"onMembershipBannerClick"},onMembershipBannerClick:function(event){var payload={};try{payload={id:event.toElement.id||"",target:"SignupPage",action:"click"}}catch(e){payload.exception_message=e.message}EventDispatcher.trigger("ping","ui",payload)}}),ActivityCardListView=BaseView.extend({defaults:{cardSelector:".activity-card"},initialize:function(options){this.options=Object.assign({},this.defaults,options||{}),EventDispatcher.trigger("lazyImageLoader:update"),this.updateActivityCards(),this.listenTo(EventDispatcher,"activityCardList:update",this.updateActivityCards.bind(this))},updateActivityCards:function(){for(var cards=this.el.querySelectorAll(this.options.cardSelector),i=0;i<cards.length;i++)this.initActivityCardViews(cards[i])},initActivityCardViews:function(element){if(element._hasActivityCardView!==!0){element._hasActivityCardView=!0;var view=new ActivityCardView({el:element,user:this.options.user});this.addSubview(view)}}});module.exports={ActivityCardListView:ActivityCardListView,ActivityCardView:ActivityCardView}},{"base-view":"base-view","event-dispatcher":"event-dispatcher"}],5:[function(require,module,exports){var _=require("underscore"),BaseView=require("base-view"),Router=require("../../../../Search/Resources/_router"),ListCollection=require("../_ajax_list_collection"),EventDispatcher=require("event-dispatcher").global(),ActivityCardView=require("../_activity_card"),BasicFlow=BaseView.extend({activityCardViews:[],flow:"BasicFlow",initialize:function(options){this.options=_.defaults(options||{},this.defaults),this.setup(),EventDispatcher.on("router:change",this.onRouterChange.bind(this)),this.listenTo(this.collection,"sync",this.onSync.bind(this))},setup:function(){this.scope=this.options.scope,this.scope&&this.options.cardContainer&&(this.cardContainer=document.querySelector(this.options.cardContainer),this.cardContainer&&(this.limit=this.options.limit&&this.options.limit>0?this.options.limit:10,this.router=this.options.router||new Router,this.template=this.options.template||"horizontal",this.collection=this.options.listCollection||new ListCollection(null,{scope:this.scope,limit:this.limit}),this.spinner=document.querySelector(this.options.spinner)||document.querySelector("body > .spinner"),this.noResultsContainer=this.el.querySelector(this.options.noResultsContainer)))},onSync:function(){options.silent||this.renderFlow()},beforeRender:function(options){this.hideNoResultsContainer(),this.showSpinner()},initRender:function(options){var collectionLength=this.collection.length;return new Promise(function(resolve,reject){0===collectionLength?reject():resolve(0)})},renderFlow:function(options){return this.beforeRender(options),this.initRender(options).then(function(offset){return this.renderCards(offset,options)}.bind(this)).catch(function(error){return this.renderEmptyResult()}.bind(this)).then(function(offset){this.afterRender(options)}.bind(this))},renderCards:function(offset,options){var cards=this.renderActivityCards(offset);return this.hideNoResultsContainer(),EventDispatcher.trigger("activityCardList:preRender"),this.activityCardViews.length&&this.destroySubViews(),this.cardContainer.appendChild(cards.fragment),this.activityCardViews=cards.views,EventDispatcher.trigger("lazyImageLoader:update"),EventDispatcher.trigger("activityCardList:update"),EventDispatcher.trigger("activityCardList:rendered",cards.ids),Promise.resolve()},renderEmptyResult:function(){this.activityCardViews.length&&this.destroySubViews(),this.showNoResultsContainer()},afterRender:function(options){this.hideSpinner()},onRouterChange:function(query){this.collection.page=0,this.fetchData(query)},fetchData:function(query,options){options=options||{},options.reset=!_.isBoolean(options.reset)||options.reset,options.data=query,this.request=this.collection.fetch(options)},renderActivityCards:function(offset,options){
var activityCardViews=[],renderedTourIds=[],docFrag=document.createDocumentFragment();if(offset>-1)for(var index=offset;index<offset+this.collection.limit;index++){var model=this.collection.at(index);if(!model)break;var view=new ActivityCardView({model:model,template:this.template,user:this.options.user||null});renderedTourIds.push(model.get("tourId")),activityCardViews.push(view),docFrag.appendChild(view.render())}return{fragment:docFrag,views:activityCardViews,ids:renderedTourIds}},destroySubViews:function(){this.activityCardViews.forEach(function(view){view.destroy()})},showSpinner:function(){this.spinner&&(this.spinner.style.display="")},hideSpinner:function(){this.spinner&&(this.spinner.style.display="none")},hideNoResultsContainer:function(){this.noResultsContainer&&(this.noResultsContainer.style.display="none")},showNoResultsContainer:function(){this.noResultsContainer&&(this.noResultsContainer.style.display="")}});module.exports=BasicFlow},{"../../../../Search/Resources/_router":34,"../_activity_card":8,"../_ajax_list_collection":10,"base-view":"base-view","event-dispatcher":"event-dispatcher",underscore:"underscore"}],6:[function(require,module,exports){var PaginationFlow=require("../PaginationFlow/_pagination_flow"),EventDispatcher=require("event-dispatcher").global(),ScrollMonitor=require("scroll-monitor"),Config=require("meta-config").global(),Dictionary=require("meta-dictionary").global(),LoadMoreFlow=PaginationFlow.extend({flow:"LoadMoreFlow",events:{"click .load-more":"loadNext"},initialize:function(options){this.watchers=[],this.rendered=[],this.maxRenderedPage=0,this.options=options||{},this.setup(),this.scrollToTopOnRender=this.options.scrollToTopOnRender||!1,this.scrollOffset=this.options.scrollOffset||0,this.page=this.options.page||1,this.router.addToWhitelist(["p"]),this.maxPage=1,this.count=0,this.loadMoreButton=document.querySelector(".load-more .btn"),this.listenTo(this.collection,"sync",this.onSync.bind(this)),EventDispatcher.on("router:change",this.onRouterChange.bind(this)),EventDispatcher.on("router:pageChange",this.onPageChange.bind(this)),EventDispatcher.on("LoadMoreFlow:render",function(page){this.renderFlow({page:parseInt(page)+1})}.bind(this))},onRouterChange:function(params){var page=parseInt(params.p)||1,resultSetSize=this.options.searchResultFetchLimit,limit=this.collection.limit;this.resultSetPage=Math.floor((page-1)*limit/resultSetSize),this.collection.page=page-1;var query=this.router.getQuery();this.fetchData(query)},onSync:function(collection,response,options){var activityListData=this.collection.getActivityListData();activityListData&&(this.updatePagination(activityListData.pagination),this.updateControls()),this.checkForAdditionalActivitiesToLoad(),options.silent||this.renderFlow(options)},updatePagination:function(pagination){this.count=pagination.count,this.maxPage=Math.ceil(pagination.count/this.limit),this.page=parseInt(pagination.page)||1,this.page>this.maxPage?this.page=this.maxPage:this.page<1&&(this.page=1)},updateControls:function(){if(this.maxPage<=1||this.page===this.maxPage)this.loadMoreButton&&(this.loadMoreButton.style.display="none");else if(this.loadMoreButton){var sizeOfNextSet=this.collection.limit;this.page===this.maxPage-1&&(sizeOfNextSet=this.count-(this.maxPage-1)*this.collection.limit),this.loadMoreButton.textContent=Dictionary.get("loadMoreLabel","").replace("%1",sizeOfNextSet),this.loadMoreButton.style.display=""}},getRenderOffset:function(options){options=options||{};return options.page?this.collection.getOffsetForPage(options.page-1):this.collection.getOffset()},renderCards:function(offset,options){if(offset===-1)return Promise.reject("invalid page offset returned from collection");options=options||{};var page=options.page||this.page,reset=options.reset||!1;if(this.hideNoResultsContainer(),EventDispatcher.trigger("activityCardList:preRender"),reset&&(this.activityCardViews.length&&this.destroySubViews(),this.maxRenderedPage=page-1,this.setupStage()),this.rendered.indexOf(page-1)===-1){var cards=this.renderActivityCards(offset),container=this.cardContainer.querySelector('[data-page="'+(page-1)+'"]');if(container.appendChild(cards.fragment),container.style.height="auto",this.rendered.push(page-1),reset){var height=Config.get("isMobile",!1)?115*this.collection.limit:200*this.collection.limit,emptyContainers=this.cardContainer.querySelectorAll("[data-page]")||[];Array.prototype.filter.call(emptyContainers,function(element,index,array){return parseInt(element.dataset.page)<page-1}).forEach(function(element){element.innerHTML='<div class="spinner-animation"></div>',element.style.height=height+"px"}),page>1&&(window.history&&window.history.scrollRestoration&&(window.history.scrollRestoration="manual"),container.scrollIntoView())}this.activityCardViews.push.apply(this.activityCardViews,cards.views);var pageChangeWatcher=ScrollMonitor.create(container,-100);return pageChangeWatcher._this=this,pageChangeWatcher.fullyEnterViewport(function(){this._this.router.changeUrlWithParameter({p:page})}),this.watchers.push(pageChangeWatcher),EventDispatcher.trigger("lazyImageLoader:update"),EventDispatcher.trigger("activityCardList:update"),EventDispatcher.trigger("activityCardList:rendered",cards.ids),Promise.resolve()}},afterRender:function(options){this.updateControls(),this.hideSpinner(),options&&options.reset&&this.setupAutoRenderWatcher()},setupStage:function(){this.watchers.length&&this.watchers.forEach(function(watcher){watcher.destroy()}),this.watchers=[];for(var docFragment=document.createDocumentFragment(),i=0;i<this.maxPage;i++){var element=document.createElement("div");element.dataset.page=i,docFragment.appendChild(element)}this.cardContainer.innerHTML="",this.cardContainer.appendChild(docFragment),this.rendered=[]},setupAutoRenderWatcher:function(){Array.prototype.forEach.call(document.querySelectorAll("[data-page]"),function(element,index){var page=parseInt(element.dataset.page),watchFn=function(){this._this.rendered.indexOf(page)===-1?EventDispatcher.trigger("LoadMoreFlow:render",page):(this.watchItem.dataset.watcher="detached",this.destroy())};if(page<this.maxRenderedPage){var watcher=ScrollMonitor.create(element,300);watcher._this=this,watcher.isInViewport&&watcher._this.rendered.indexOf(page)===-1?EventDispatcher.trigger("LoadMoreFlow:render",page):(element.dataset.watcher="attached",watcher.enterViewport(watchFn)),this.watchers.push(watcher)}}.bind(this))},beforeRender:function(options){this.hideNoResultsContainer()}});module.exports=LoadMoreFlow},{"../PaginationFlow/_pagination_flow":7,"event-dispatcher":"event-dispatcher","meta-config":"meta-config","meta-dictionary":"meta-dictionary","scroll-monitor":"scroll-monitor"}],7:[function(require,module,exports){var _=require("underscore"),BasicFlow=require("../BasicFlow/_basic_flow"),ScrollMonitor=require("scroll-monitor"),EventDispatcher=require("event-dispatcher").global(),Scroll=(require("meta-config").global(),require("../../../../Site/Resources/_scroll_helper")),PaginationFlow=BasicFlow.extend({resultSetPage:0,flow:"PaginationFlow",events:{"click .previous-page:not(.disabled)":"loadPrevious","click .next-page:not(.disabled)":"loadNext"},initialize:function(options){this.options=options||{},this.setup(),this.scrollToTopOnRender=this.options.scrollToTopOnRender||!1,this.scrollOffset=this.options.scrollOffset||0,this.page=this.options.page||1,this.router.addToWhitelist(["p"]),this.maxPage=1,this.count=0,this.pageElements=this.el.querySelectorAll(".pagination-page"),this.maxPageElements=this.el.querySelectorAll(".pagination-max-page"),this.controlsElements=this.el.querySelectorAll(".pagination-controls"),this.prevButtons=this.el.querySelectorAll(".previous-page"),this.nextButtons=this.el.querySelectorAll(".next-page"),this.listenTo(this.collection,"sync",this.onSync.bind(this)),EventDispatcher.on("router:change",this.onRouterChange.bind(this)),EventDispatcher.on("router:pageChange",this.onPageChange.bind(this)),this.scrollToTopOnRender&&(this.watcher=ScrollMonitor.create(this.el),EventDispatcher.on("activityCardList:preRender",this.adjustScrollPosiiton.bind(this)))},onRouterChange:function(params){var page=parseInt(params.p)||1,resultSetSize=this.options.searchResultFetchLimit,limit=this.collection.limit;this.resultSetPage=Math.floor((page-1)*limit/resultSetSize),this.collection.page=page-1;var query=this.router.getQuery();this.fetchData(query),this.checkForAdditionalActivitiesToLoad()},onPageChange:function(params){this.collection.page=params.p-1||0,this.renderFlow(),this.checkForAdditionalActivitiesToLoad()},loadPrevious:function(){this.page-1>0&&this.router.navigateToNextPage({p:--this.page})},loadNext:function(){this.page+1<=this.maxPage&&this.router.navigateToNextPage({p:++this.page})},updateControls:function(){if(Array.prototype.forEach.call(this.pageElements,function(element){element.textContent=this.page}.bind(this)),this.maxPage<=1)return void Array.prototype.forEach.call(this.controlsElements,function(element){element.style.display="none"});Array.prototype.forEach.call(this.controlsElements,function(element){element.style.display="block"}),1===this.page?Array.prototype.forEach.call(this.prevButtons,function(element){element.classList.add("disabled")}):Array.prototype.forEach.call(this.prevButtons,function(element){element.classList.remove("disabled")}),this.page===this.maxPage?Array.prototype.forEach.call(this.nextButtons,function(element){element.classList.add("disabled")}):Array.prototype.forEach.call(this.nextButtons,function(element){element.classList.remove("disabled")})},updatePagination:function(pagination){this.count=pagination.count,this.maxPage=Math.ceil(pagination.count/this.limit),this.page=parseInt(pagination.page)||1,Array.prototype.forEach.call(this.maxPageElements,function(element){element.textContent=this.maxPage}.bind(this)),this.page>this.maxPage?this.page=this.maxPage:this.page<1&&(this.page=1)},checkForAdditionalActivitiesToLoad:function(){var page=this.collection.page,resultSetSize=this.options.searchResultFetchLimit,pagesPerResultPage=resultSetSize/this.collection.limit,currentResultPage=Math.floor(page*this.collection.limit/resultSetSize),maxResultPage=Math.floor(this.count/resultSetSize);if(currentResultPage>0&&!this.collection.hasResultPageBeenRequested(currentResultPage-1)){page<=currentResultPage*pagesPerResultPage+2&&this.fetchPage(currentResultPage-1)}if(currentResultPage<maxResultPage&&!this.collection.hasResultPageBeenRequested(currentResultPage+1)){page>=(currentResultPage+1)*pagesPerResultPage-2&&this.fetchPage(currentResultPage+1)}},onSync:function(collection,response,options){if(!options.silent){var activityListData=this.collection.getActivityListData();activityListData&&(this.updatePagination(activityListData.pagination),this.updateControls()),this.checkForAdditionalActivitiesToLoad(),this.renderFlow(options)}},fetchData:function(query,options){options=options||{},options.reset=!_.isBoolean(options.reset)||options.reset,query.page=query.page||this.resultSetPage,options.silent||(this.hideNoResultsContainer(),this.showSpinner()),options.reset&&(this.resultSetPage=0),options.data=query,this.request=this.collection.fetch(options)},fetchPage:function(page,options){if(options=options||{},page>=0&&!this.collection.hasResultPageBeenRequested(page)){var query=this.router.getQuery();query.page=page,options=_.extend(options,{remove:!1,reset:!1,silent:!0}),this.fetchData(query,options)}},initRender:function(options){var offset=this.getRenderOffset(options);return new Promise(function(resolve,reject){0===this.collection.length?reject():offset<0?this.waitForResultPageBeingFetched(resolve,options):resolve(offset)}.bind(this))},getRenderOffset:function(options){return this.collection.getOffset()},waitForResultPageBeingFetched:function(resolve,options){options=options||{};var page=options.page||this.collection.getPage(),resultSetPage=this.getResultSetPageForPage(page-1);if(this.collection.isResultPageLoaded(resultSetPage)){resolve(this.getRenderOffset(options))}else this.collection.isResultPageFetching(resultSetPage)?this.collection.once("sync",function(){this.waitForResultPageBeingFetched(resolve,options)}.bind(this)):this.fetchPage(resultSetPage,options)},getResultSetPageForPage:function(page){var resultSetSize=this.options.searchResultFetchLimit;return Math.floor(page*this.collection.limit/resultSetSize)},afterRender:function(options){this.updateControls(),this.hideSpinner()},adjustScrollPosiiton:function(){if(this.watcher&&this.watcher.isAboveViewport){var pos=this.watcher.top+this.scrollOffset;Scroll.setScrollPosition(pos)}}});module.exports=PaginationFlow},{"../../../../Site/Resources/_scroll_helper":35,"../BasicFlow/_basic_flow":5,"event-dispatcher":"event-dispatcher","meta-config":"meta-config","scroll-monitor":"scroll-monitor",underscore:"underscore"}],8:[function(require,module,exports){var BaseView=require("base-view"),EventDispatcher=require("event-dispatcher").global(),Config=require("meta-config").global(),WishlistButtonView=require("../../WishlistButton/_wishlist_button.js"),Wishlist=require("../../../Site/Resources/_wishlist"),unifiedHorizontalActivityCardTemplate=require("../../ActivityCard/_flex_activity_card.smarty.tpl"),ActivityCardView=BaseView.extend({events:{"click a.membership-message-banner":"onMembershipBannerClick"},initialize:function(options){this.options=options,this.template=unifiedHorizontalActivityCardTemplate},render:function(){try{this.el.innerHTML=this.template.render({id:this.model.get("tourId"),activity:this.model.toJSON(),activityCardList:this.model.collection.getActivityListData(),isMobile:Config.get("isMobile",!1)}),this.setElement(this.el.firstChild),this.initWishlistButton()}catch(e){}return this.el},onMembershipBannerClick:function(evt){var payload={};try{Object.assign(payload,{id:evt.toElement.id||"",target:"SignupPage",action:"click"})}catch(e){payload.exception_message=e.message}EventDispatcher.trigger("ping","ui",payload)},initWishlistButton:function(){var wishlistButton=this.el.querySelector(".wishlist-button"),tour_id=this.el.id.replace("t","");wishlistButton&&(this.wishlistButtonView=new WishlistButtonView({el:wishlistButton,model:new Wishlist.WishlistItem({tour_id:tour_id,user:this.options.user||null}),user:this.options.user||null}),this.wishlistButtonView.syncLists())},destroy:function(){this.off(),this.wishlistButtonView&&this.wishlistButtonView.close(),this.remove()}});module.exports=ActivityCardView},{"../../../Site/Resources/_wishlist":39,"../../ActivityCard/_flex_activity_card.smarty.tpl":3,"../../WishlistButton/_wishlist_button.js":17,"base-view":"base-view","event-dispatcher":"event-dispatcher","meta-config":"meta-config"}],9:[function(require,module,exports){var _=require("underscore"),BaseView=require("base-view"),AjaxActivityCardListView=(require("./BasicFlow/_basic_flow"),require("./PaginationFlow/_pagination_flow"),require("./LoadMoreFlow/_load_more_flow"),BaseView.extend({initialize:function(options){this.options=_.defaults(options||{},this.defaults),this.scope=this.options.scope,this.scope&&this.options.flow&&(this.flow=this.addSubview(new this.options.flow(this.options)))}}));module.exports=AjaxActivityCardListView},{"./BasicFlow/_basic_flow":5,"./LoadMoreFlow/_load_more_flow":6,"./PaginationFlow/_pagination_flow":7,"base-view":"base-view",underscore:"underscore"}],10:[function(require,module,exports){var _=require("underscore"),Backbone=require("backbone"),BaseCollection=require("base-collection"),EventDispatcher=require("event-dispatcher").global(),Config=require("meta-config").global(),wrapError=function(model,options){var error=options.error;options.error=function(resp){error&&error.call(options.context,model,resp,options),model.trigger("error",model,resp,options)}},ActivityCardModel=Backbone.Model.extend({idAttribute:"tourId",url:""}),ActivityCardListCollection=BaseCollection.extend({model:ActivityCardModel,page:0,fetching:[],loaded:[],pagination:{},queryString:"",query:"",defaults:{endpoint:"search.json"},initialize:function(models,options){this.options=_.defaults(options||{},this.defaults),this.scope=this.options.scope,this.scope&&(this.limit=this.options.limit||10,this.listenTo(this,"sync",this.onSync.bind(this)))},url:function(){return this.fullURL||(this.fullURL=[location.protocol,"//",location.host,location.pathname,this.options.endpoint].join("")),this.fullURL},onSync:function(collection,response,options){if(!options.fromStorage){var resultSetPage=response[this.scope].search.resultSetPage||0;this.markResultPageAsLoaded(resultSetPage),this.persist(response)}EventDispatcher.trigger("ListCollection:synced",response)},comparator:function(a,b){return a.get("resultSetPosition",0)<b.get("resultSetPosition",0)?-1:1},parse:function(response,options){if(!response[this.scope].search)return[];if(options.reset)this.query=response[this.scope].search.query,this.queryString=this.toQueryString(options.data||{});else if(response[this.scope].search.query!==this.query)return[];return this._originalResponse=response,response[this.scope].tours},getActivityListData:function(){return this._originalResponse[this.scope]},getPage:function(){return this.page},getOffset:function(){return this.getOffsetForPage(this.page)},getOffsetForPage:function(page){page=parseInt(page);var resultSetPosition=this.getResultSetPositionForPage(page),model=this.findWhere({resultSetPosition:resultSetPosition});return this.indexOf(model)},getResultSetPositionForPage:function(page){return page*this.limit},markResultPageAsLoaded:function(page){page=parseInt(page),this.loaded.push(page),this.fetching=_.without(this.fetching,page)},markResultPageAsFetching:function(page){page=parseInt(page),this.fetching.push(page)},hasResultPageBeenRequested:function(page){return(page=parseInt(page))<0||(this.isResultPageLoaded(page)||this.isResultPageFetching(page))},clearLoadedResultPages:function(){this.loaded=[],this.fetching=[]},isResultPageLoaded:function(page){return page=parseInt(page),this.loaded.indexOf(page)!==-1},isResultPageFetching:function(page){return page=parseInt(page),this.fetching.indexOf(page)!==-1},toQueryString:function(obj){var keyParams=Object.assign({},obj,{state:{customer:Config.get("isLoggedIn",!1),currency:Config.get("currencyCode",""),language:Config.get("localeCode",""),partner:Config.get("partnerId",""),flags:Config.get("activeAB",{})}}),data=JSON.parse(JSON.stringify(keyParams));return delete data.page,delete data.p,delete data.query,JSON.stringify(data)},persist:function(){try{if(window.sessionStorage){var key=this.queryString;if(key.length){var data={activityListData:this.getActivityListData(),loaded:this.loaded,query:this.query,models:this.models,version:"2",timestamp:(new Date).getTime()};window.sessionStorage.setItem(key,JSON.stringify(data))}}}catch(e){}},load:function(options){if(Config.get("disableSearchCache",!1))return!1;try{if(window.sessionStorage){var key=this.toQueryString(options.data||{}),storage=window.sessionStorage.getItem(key);if(storage){var content=JSON.parse(storage),timestamp=(new Date).getTime();if("2"===content.version&&content.timestamp>=timestamp-36e5){var page=parseInt(options.data.p)||1;return this.queryString=key,this.loaded=content.loaded,this.query=content.query,this.page=page-1,this._originalResponse={},this._originalResponse[this.scope]=content.activityListData,this.set(content.models),this._originalResponse[this.scope].pagination.page=page||1,!0}window.sessionStorage.removeItem(key)}}}catch(e){}return!1},fetch:function(options){options=Object.assign({parse:!0},options||{});var page=0;if(options.data&&options.data.page&&(page=options.data.page),options.reset&&(this.clearLoadedResultPages(),options.fromStorage=this.load(options)),options.fromStorage&&this.hasResultPageBeenRequested(page))return void this.trigger("sync",this,this._originalResponse,Object.assign(options));if(options.reset||!this.hasResultPageBeenRequested(page)){this.markResultPageAsFetching(page),options.silent||EventDispatcher.trigger("filtersView:prefetch");var success=options.success,collection=this;return options.success=function(resp){var reset=options.reset;options.reset=options.reset&&!options.fromStorage,options.fromStorage&&(options.remove=!1,options.fromStorage=!1),collection[options.reset?"reset":"set"](resp,options),options.reset=reset,success&&success.call(options.context,collection,resp,options),collection.trigger("sync",collection,resp,options)},wrapError(this,options),this.trigger("fetched",page),this.sync("read",this,options)}}});module.exports=ActivityCardListCollection},{backbone:"backbone","base-collection":"base-collection","event-dispatcher":"event-dispatcher","meta-config":"meta-config",underscore:"underscore"}],11:[function(require,module,exports){var _=require("underscore"),BaseView=require("base-view"),Backbone=require("backbone"),moment=require("moment"),EventDispatcher=require("event-dispatcher").global(),Pikaday=require("pikaday"),Config=require("meta-config").global(),SelectorHelper=require("../../Site/Resources/_selector_helper"),ElementHelper=require("element-helper"),Scroll=require("../../Site/Resources/_scroll_helper"),DatepickerDates=(require("scroll-monitor"),Backbone.Model.extend({defaults:{date_from:"",date_to:"",format:"YYYY-MM-DD",isDateRange:!1},initialize:function(options){this.options=_.defaults(options||{},this.defaults)},hasValidDateRange:function(){var dateFrom=this.get("date_from"),dateTo=this.get("date_to");return moment(dateFrom).isBefore(dateTo)||moment(dateFrom).isSame(dateTo)}})),DatepickerView=BaseView.extend({events:{"click .btn-datepicker":"onCtaClick"},initialize:function(options){this.options=options||{},this.router=options.router||!1,this.config=Config.get("dateConfigurations",{}),this.bindElementsOnInit=options.bindElementsOnInit||!1,this.lang=Config.get("localeCode",document.documentElement.getAttribute("lang")),this.dateConfiguration=Config.get("dateConfigurations",!1),this.dateConfiguration!==!1&&(moment.updateLocale(this.lang,Config.get("dateConfigurations").i18n),this.cacheEl(),this.setFormat(),this.listenTo(EventDispatcher,"datepicker:bindElements",this.bindElements),this.listenTo(EventDispatcher,"datepickerInput:change",this.onDateInputChange),this.bindElementsOnInit&&this.bindElements())},setFormat:function(){this.dateFormat=this.options.dateFormat||this.config.longDateFormat.LK},cacheEl:function(options){var datepickerElem=document.getElementById("datepicker")||null;if(this.options&&this.options.el||null===datepickerElem){if(!(this.options&&this.options.el&&document.querySelectorAll(this.options.el)))return;this.el=this.options.el}else this.el=datepickerElem},bindElements:function(){var isMobileModal=this.el.classList.contains("mobile-modal-datepicker");_.size(this.subViews)&&this.removeSubviews(),this.updateRoute(Config.get("searchParams",{})),this.cacheEl(),this.setFormat();for(var inputs=this.el.querySelectorAll(".datepicker-input"),DatePickerInputSubview=DatepickerInputView,format=this.dateFormat,i=0;i<inputs.length;i++)this.addSubview(new DatePickerInputSubview({el:inputs[i],model:this.model,router:this.router,config:this.dateConfiguration.DATE?this.dateConfiguration.DATE:this.dateConfiguration,dateFormat:format,mobileModal:isMobileModal}));this.el.classList.contains("has-cta")&&this.el.querySelector(".datepicker-cta").addEventListener("click",this.onCtaClick.bind(this)),this.elTxt=this.el.querySelector(".datepicker-instructions"),this.elTxt&&(this.elTxt.textContent=this.elTxt.textContent.replace(/\[x]/g,this.elTxt.dataset.amount))},onDateInputChange:function(options){var date=moment(options.date).format(this.model.get("format"));return this.model.get("isDateRange")?options.isDateFrom?this.model.set({date_from:date}):this.model.set({date_to:date}):(this.model.set({date_from:date}),this.model.set({date_to:date})),options.silent||this.model.hasValidDateRange()?options.isDateFrom&&this.model.get("isDateRange")?void EventDispatcher.trigger("datepicker:resetMinDate",options):void(this.model.get("isDateRange")&&!this.model.hasValidDateRange()||EventDispatcher.trigger("datepicker:change",_.clone(this.model.attributes))):void EventDispatcher.trigger("datepicker:reFocus",options,!0)},onCtaClick:function(event){var dateFromInputEl=this.el.querySelector(".datepicker-from-input");dateFromInputEl&&dateFromInputEl.value.length>0&&this.model.hasValidDateRange()&&EventDispatcher.trigger("datepicker:submit",_.clone(this.model.attributes),event)},updateRoute:function($searchParams){if(this.router&&this.router.query){var routeDateFrom=this.router.query.get("date_from"),routeDateTo=this.router.query.get("date_to"),paramsDateFrom=$searchParams.date_from,paramsDateTo=$searchParams.date_to,modifiedParams={};paramsDateFrom!==routeDateFrom&&(modifiedParams.date_from=paramsDateFrom,this.router.query.set("date_from",paramsDateFrom)),paramsDateTo!==routeDateTo&&(modifiedParams.date_to=paramsDateTo,this.router.query.set("date_to",paramsDateTo)),modifiedParams&&this.router.changeUrlWithParameter(modifiedParams)}}}),BaseDatepickerInputView=BaseView.extend({events:{mousedown:"onMousedown",focus:"onFocus",blur:"onBlur",keyup:"hasDate"},getPreselectedDate:function(){var preSelectedDate=this.getPreselectedDateFromLabel(this.isDateFrom?"date_from":"date_to");return"string"==typeof preSelectedDate&&(preSelectedDate=moment(preSelectedDate)),preSelectedDate.toDate()},getPreselectedDateFromLabel:function(paramLabel){var date=!1;return this.router&&this.router.query.get(paramLabel)?date=this.router.query.get(paramLabel):this.model&&void 0!==this.model.get(paramLabel)&&(date=this.model.get(paramLabel)),date},onMousedown:function(event){Config.get("isMobile",!1)&&(event.preventDefault(),ElementHelper.createAndDispatchNativeEvent(event.target,"blur")),this.hasFocused=!0},onFocus:function(){this.hasFocused=!0},onBlur:function(){this.hasDate()},hasDate:function(){var el=SelectorHelper.getClosest(this.el,".input-group");this.hasFocused&&this.moment&&this.el.value?el.classList.add("has-selected-date"):this.moment&&this.el.value?(el.classList.add("has-date"),el.classList.remove("has-selected-date"),el.classList.remove("had-selected-date")):this.hasFocused&&!this.el.value?(this.moment=!1,el.classList.add("had-selected-date"),el.classList.remove("has-date"),el.classList.remove("has-selected-date")):el.classList.remove("has-date")}}),DatepickerInputView=BaseDatepickerInputView.extend({events:{mousedown:"onMousedown",focus:"onFocus",blur:"onBlur",keyup:"hasDate"},initialize:function(options){this.options=options||{},this.router=options.router||!1,this.config=Config.get("dateConfigurations",{}),this.mobileModal=options.mobileModal||!1,this.picker=!1,this.hasFocused=!1,this.isDateFrom=this.el.classList.contains("datepicker-from-input"),this.preSelectedDate=this.getPreselectedDate(),this.el.datepickerInputView=this;var lang=Config.get("localeCode",document.documentElement.getAttribute("lang"));moment.updateLocale(lang,Config.get("dateConfigurations","").i18n),this.initPikaday(options),this.router&&(this.moment=moment(this.preSelectedDate),this.setDate(this.preSelectedDate,!0),this._onDateSelect(this.preSelectedDate,!0)),this.listenTo(EventDispatcher,"datepicker:prompt",this.prompt)},getMinDate:function(){return this.router&&!this.isDateFrom&&this.router.query.get("date_from")?moment(this.router.query.get("date_from")).toDate():moment().toDate()},initPikaday:function(options){this.mobileModal?this.initMobileModalBehaviour(options):this.pikadaySettings={field:this.el,bound:!0,position:"bottom left",reposition:options.config.DATERANGE||!0,firstDay:this.config.firstDay,format:options.dateFormat||this.config.longDateFormat.LK,i18n:this.config.i18n,onSelect:this._onDateSelect.bind(this),minDate:this.getMinDate(),theme:"gyg-datepicker"},_.extend(this.pikadaySettings,this.options);try{this.picker=new Pikaday(this.pikadaySettings),this.listenTo(EventDispatcher,"datepicker:reFocus",this.reFocus),this.listenTo(EventDispatcher,"datepicker:resetMinDate",this.setMinDate)}catch(error){}},prompt:function(){this.isDateFrom&&this.picker&&!this.picker.getDate()&&this.picker.show()},reFocus:function(options){this.isDateFrom&&options.isDateFrom||(this.isDateFrom||this.setMinDate(options),this.setDate(options.date.toDate()),this.picker.show())},setMinDate:function(options){this.isDateFrom&&options.isDateFrom||(this.picker.setMinDate(options.date.toDate(),!0),this.picker.draw(!0))},hasDate:function(){var el=SelectorHelper.getClosest(this.el,".input-group");if(!el)return!1;this.hasFocused&&this.moment&&this.el.value?el.classList.add("has-selected-date"):this.moment&&this.el.value?(el.classList.add("has-date"),el.classList.remove("has-selected-date"),el.classList.remove("had-selected-date")):this.hasFocused&&!this.el.value?(this.moment=!1,el.classList.add("had-selected-date"),el.classList.remove("has-date"),el.classList.remove("has-selected-date")):el.classList.remove("has-date")},initMobileModalBehaviour:function(options){this.el.tabIndex=-1,this.mobileModal=this.isDateFrom?document.querySelector(".datepicker-modal-from"):document.querySelector(".datepicker-modal-to"),this.mobileModalContainer=this.mobileModal.querySelector(".datepicker-modal-body"),this.mobileModalOverlay=document.querySelector(".datepicker-modal-overlay"),this.userDidOpenMobileModal=!1,this.mobileModalOverlay.addEventListener("click",this.manualCloseModal.bind(this)),this.mobileModal.querySelector(".datepicker-modal-close").addEventListener("click",this.closeModal.bind(this)),SelectorHelper.getClosest(this.el,".input-group").addEventListener("click",this.openModalOnFocus.bind(this,this)),this.pikadaySettings={container:this.mobileModalContainer,field:this.el,bound:!1,position:"bottom left",reposition:!1,firstDay:this.config.firstDay,format:options.dateFormat||this.config.longDateFormat.LK,i18n:this.config.i18n,minDate:this.getMinDate(),theme:"gyg-datepicker-modal",onSelect:this._onDateSelect.bind(this)}},openModal:function(view){view.userDidOpenMobileModal&&(view.userDidOpenMobileModal=!1,view.mobileModalOverlay.classList.add("show"),view.mobileModal.classList.add("show"),view.scrollToInput())},openModalOnFocus:function(view){view.picker.hide(),view.picker.show(),this.userDidOpenMobileModal=!0,this.openModal(view)},manualCloseModal:function(){this.closeModal()},closeModal:function(){this.scrollToInitialPosition(),this.mobileModal.classList.remove("show"),this.mobileModalOverlay.classList.remove("show"),this.el.blur()},onDateSelect:function(obj,silent){silent=!!silent&&silent,this.mobileModal&&window.event&&window.event.preventDefault&&window.event.stopImmediatePropagation&&(window.event.preventDefault(),window.event.stopImmediatePropagation()),EventDispatcher.trigger("datepickerInput:change",{isDateFrom:this.isDateFrom,date:this.moment,silent:silent}),Config.get("hasReducedMobileDatepicker",!1)&&document.querySelector(".datepicker-cta button").click()},scrollToInput:function(){this._scrollPosition=Scroll.getScrollPosition(),Scroll.scrollToElement(this.el,-15,300).catch(function(){})},scrollToInitialPosition:function(){Scroll.smoothScrollTo(this._scrollPosition,300).catch(function(){})},setDate:function(date,silent){silent=!!silent&&silent,this.picker.setDate(date,silent),this._onDateSelect(date,silent)},_onDateSelect:function(obj,silent){if(window.event)try{window.event.preventDefault(),window.event.stopImmediatePropagation()}catch(e){}this.mobileModal&&this.closeModal(),moment.isDate(obj)?this.moment=this.picker.getMoment():obj.target&&(this.moment=moment(obj.target.value)),this.hasDate(),this.onDateSelect(obj,silent)}});module.exports={DatepickerDates:DatepickerDates,DatepickerView:DatepickerView}},{"../../Site/Resources/_scroll_helper":35,"../../Site/Resources/_selector_helper":37,backbone:"backbone","base-view":"base-view","element-helper":"element-helper","event-dispatcher":"event-dispatcher","meta-config":"meta-config",moment:"moment",pikaday:2,"scroll-monitor":"scroll-monitor",underscore:"underscore"}],
12:[function(require,module,exports){var BaseView=require("base-view"),FlashNotification=BaseView.extend({updateFlashNotificationText:function(text){this.el.querySelector(".text").textContent=text||"",this.showFlashNotification()},showFlashNotification:function(){this.el.classList.add("is-active"),clearTimeout(this.timer),this.timer=setTimeout(this.hideFlashNotification.bind(this),4e3)},hideFlashNotification:function(){this.el.classList.remove("is-active")}});module.exports=FlashNotification},{"base-view":"base-view"}],13:[function(require,module,exports){var BaseView=require("base-view"),EventDispatcher=require("event-dispatcher").global(),MobileSheetOverlay=BaseView.extend({events:{"click .close-button":"triggerClose"},defaults:{name:"Overlay"},eventPrefix:"MobileSheetOverlay:",initialize:function(options){this.options=Object.assign({},this.defaults,options),this.eventPrefix=this.eventPrefix+this.options.name+":",this.sheetBackground=document.querySelector('.sheet-background-overlay[data-sheet="'+this.options.identifier+'"]'),this.sheetBackground&&this.sheetBackground.addEventListener("click",this.triggerClose.bind(this)),this.listenTo(EventDispatcher,this.eventPrefix+"open",this.triggerOpen),this.listenTo(EventDispatcher,this.eventPrefix+"close",this.triggerClose),this.setup()},setup:function(){},triggerOpen:function(fromHistory){this.beforeOpen(fromHistory),this.open(fromHistory),this.afterOpen(fromHistory)},triggerClose:function(event){event&&(event.preventDefault(),event.stopImmediatePropagation()),this.beforeClose(),this.close(),this.afterClose()},beforeOpen:function(){},beforeClose:function(){},afterOpen:function(){},afterClose:function(){},open:function(){this.sheetBackground.style.display="block",document.documentElement.classList.add("sheet-overlay-open"),this.el.classList.add("open"),EventDispatcher.trigger(this.eventPrefix+"opened")},close:function(){this.el.classList.remove("open"),document.documentElement.classList.remove("sheet-overlay-open"),EventDispatcher.trigger(this.eventPrefix+"closed"),this.sheetBackground.style.display="none"}});module.exports=MobileSheetOverlay},{"base-view":"base-view","event-dispatcher":"event-dispatcher"}],14:[function(require,module,exports){var _=require("underscore"),BaseView=require("base-view"),EventDispatcher=require("event-dispatcher").global(),SearchSuggestionsView=require("../SearchSuggestions/_search_suggestions"),SearchFormView=BaseView.extend({el:".search-form",events:{submit:"onSubmit","keyup .search-form-input":"toggleResetButton","click .icon-reset":"onReset"},initialize:function(){this.el&&(this.searchTermInput=this.el.querySelector(".search-form-input"),this.searchTermInput&&(this.searchTermInput.addEventListener("animationend",this.onAnimationEnd.bind(this)),this.addSubview({suggest:new SearchSuggestionsView({el:".search-form-input",limit:5})}),this.listenTo(EventDispatcher,"headerNavigation:searchToggle",this.onToggle.bind(this)),this.toggleResetButton()))},onSubmit:function(event){var query=this.searchTermInput.value||"",query_set=!!query.length,blocked=this.el.classList.contains("search-form-submitting"),cancel=function(){event.preventDefault(),event.stopImmediatePropagation()};return blocked?void cancel():query_set?(this.el.classList.add("search-form-submitting"),_.delay(this.onSubmittingEnd,800,this),EventDispatcher.trigger("search_form:submit",{q:query},event),void this.trackSearchSubmit(event,query)):(cancel(),void this.searchTermInput.classList.add("error-animation"))},onAnimationEnd:function(){this.searchTermInput.classList.remove("error-animation")},onSubmittingEnd:function(_this){_this.el.classList.remove("search-form-submitting")},onReset:function(event){event.preventDefault(),this.searchTermInput.value="",this.toggleResetButton();var inputContainer=this.el.querySelector(".keyword-input-container");inputContainer&&inputContainer.classList.add("is-empty")},onToggle:function(){this.searchTermInput.focus()},toggleResetButton:function(){var inputField=document.getElementById("search-form-input"),resetButton=document.querySelector(".icon-reset");inputField&&resetButton&&(inputField.value?resetButton.style.display="block":resetButton.style.display="none");var inputContainer=this.el.querySelector(".keyword-input-container");inputContainer&&inputContainer.classList.add("is-empty")},trackSearchSubmit:function(event,query){var payload={target:"headerSearchSubmitButton"};try{Object.assign(payload,{id:event.target.id||"",action:event.type||"",metadata:{search_keyword:query}})}catch(e){payload.exception_message=e.message}EventDispatcher.trigger("ping","ui",payload)}});module.exports=SearchFormView},{"../SearchSuggestions/_search_suggestions":16,"base-view":"base-view","event-dispatcher":"event-dispatcher",underscore:"underscore"}],15:[function(require,module,exports){var EventDispatcher=require("event-dispatcher").global(),BaseView=require("base-view"),SearchSuggestionsView=require("../SearchSuggestions/_search_suggestions"),SelectorHelper=require("../../Site/Resources/_selector_helper"),SearchOverlayView=BaseView.extend({el:"#search-overlay",events:{"submit .overlay-search-form":"onSubmit","mousedown .reset":"resetQuery","touchstart .reset":"resetQuery","mousedown .cancel-label":"onCancel","touchstart .cancel-label":"onCancel","blur .search-term-input":"onBlur",input:"updateResetState"},initialize:function(options){options=options||{},this.router=!!options.router&&options.router,this.searchTermInput=this.el.querySelector(".search-term-input"),this.resetBtn=this.el.querySelector(".keyword-input-controls .reset"),this.searchOverlay=document.querySelector(".search-overlay");var container=this.el.querySelector(".overlay-tt-container");this.addSubview({suggest:new SearchSuggestionsView({el:".search-term-input",limit:10,containerElement:container})}),EventDispatcher.on("SearchSuggestion:selected",function(value,event){this.currentKeyword=value,this.onBlur(),this.trackAutoComplete(event,value)}.bind(this)),this.updateResetState(),EventDispatcher.on("searchView:update",this.updateQuery.bind(this)),EventDispatcher.on("searchOverlay:open",this.onOpen.bind(this)),EventDispatcher.on("searchOverlay:close",this.onCancel.bind(this));var searchOverlayTrigger=document.querySelector(".search-overlay-trigger");searchOverlayTrigger&&searchOverlayTrigger.addEventListener("click",this.onOpen.bind(this))},updateQuery:function(data){var query=data.search.query||"";query.length&&(this.currentKeyword=query)},updateResetState:function(){this.searchTermInput.value?this.resetBtn.style.display="":this.resetBtn.style.display="none"},resetQuery:function(){this.preventBlur=!0,this.searchTermInput.value="",this.searchTermInput.focus(),this.updateResetState()},onBlur:function(){if(this.preventBlur)return this.preventFocus||(this.searchTermInput.focus(),this.preventFocus=!1),void(this.preventBlur=!1);var query=this.currentKeyword||this.searchTermInput.value;query&&(this.router?this.router.navigateWithNewSearchKeyword({q:query}):window.location.href="/s/?q="+query),this.closeModal()},onSubmit:function(event){var inputVal=this.searchTermInput.value;return event.preventDefault(),inputVal?inputVal===this.currentKeyword?(this.searchTermInput.blur(),this.submitSearch("userSubmitted"),!1):(this.currentKeyword=inputVal,inputVal.length&&(this.searchTermInput.value=this.currentKeyword),this.searchTermInput.blur(),this.searchTermInput.classList.remove("empty"),this.trackSearchSubmit(event),this.submitSearch(),!1):(this.searchTermInput.classList.add("empty"),!1)},onOpen:function(){document.body.classList.add("modal-open"),this.searchOverlay.classList.add("animated"),this.searchTermInput.focus(),this.searchTermInput.value=this.searchTermInput.value},onCancel:function(){this.preventBlur=!0,this.preventFocus=!0,this.closeModal()},closeModal:function(){document.body.classList.remove("modal-open"),this.searchOverlay.classList.remove("animated")},submitSearch:function(){return this.onBlur(),!1},trackSearchSubmit:function(event){var payload={action:event.type||"",target:"search"};try{Object.assign(payload,{id:event.target.id||"",metadata:{search_keyword:this.currentKeyword}})}catch(e){payload.exception_message=e.message}EventDispatcher.trigger("ping","ui",payload)},trackAutoComplete:function(event,suggestion){var payload={action:event.type||"",target:"search"};try{var parent=SelectorHelper.getParents(event.target,".full-page-modal");Object.assign(payload,{id:parent.id||"",metadata:{suggested_keyword:suggestion}})}catch(e){payload.exception_message=e.message}EventDispatcher.trigger("ping","ui",payload)}});module.exports=SearchOverlayView},{"../../Site/Resources/_selector_helper":37,"../SearchSuggestions/_search_suggestions":16,"base-view":"base-view","event-dispatcher":"event-dispatcher"}],16:[function(require,module,exports){var _=require("underscore"),BaseView=require("base-view"),EventDispatcher=require("event-dispatcher").global(),Config=require("meta-config").global(),ElementHelper=require("element-helper"),SelectorHelper=require("../../Site/Resources/_selector_helper.js"),Request=require("page-token-request"),SearchSuggestionsView=(require("meta-dictionary").global(),BaseView.extend({defaults:{minimumCharacters:1,limit:Number.POSITIVE_INFINITY},selectedSuggestionIndex:-1,maxSelectedSuggestionIndex:-1,lastQuery:"",events:{focus:"onFocus",blur:"hideSuggestions",keyup:"checkKeyPress"},initialize:function(options){this.options=Object.assign({},this.defaults,options),this.options.url=this.options.url||Config.get("searchSuggestionsUrl","/"),this.ignoreMouseUp=!1,this.customContainer=!1,this.options.containerElement?(this.customContainer=!0,this.suggestionsContainer=this.options.containerElement):this.createContainer(),this.debouncedFetchSuggestions=_.debounce(this.fetchSuggestions.bind(this),150),this.suggestionsContainer.addEventListener("mousedown",this.onSuggestionSelection.bind(this)),this.suggestionsContainer.addEventListener("mouseup",this.onMouseUp.bind(this)),this.suggestionsContainer.addEventListener("touchstart",this.onSuggestionSelection.bind(this)),Config.get("isMobile",!1)||document.body.addEventListener("click",this.closeOnClick.bind(this)),this.customContainer||window.addEventListener("resize",_.throttle(function(event){this.suggestionsContainer.style.minWidth=this.el.offsetWidth+"px"}.bind(this),250))},fetchSuggestions:function(){var value=this.el.value;value.length>=this.options.minimumCharacters&&this.suggestionsContainer?this.fetchWithQuery(value):this.hideSuggestions()},onFocus:function(){var value=this.el.value;value.length>=this.options.minimumCharacters&&this.suggestionsContainer&&this.fetchWithQuery(value)},fetchWithQuery:function(query){var trimmedQuery=query.trim();trimmedQuery!==this.lastQuery?(this.lastQuery=trimmedQuery,this._xhr&&this._xhr.abort&&this._xhr.abort(),this._xhr=new XMLHttpRequest,Request.getJSON(this.options.url,{params:{q:trimmedQuery},xhr:this._xhr}).then(this.renderSuggestions.bind(this)).catch(function(){})):this.showSuggestions()},createContainer:function(){var docFrag=document.createDocumentFragment(),div=document.createElement("DIV");div.classList.add("suggestions-container"),docFrag.appendChild(div),this.el.parentNode.insertBefore(docFrag,this.el.nextSibling),this.suggestionsContainer=this.el.nextSibling,this.suggestionsContainer.style.minWidth=this.el.offsetWidth+"px",this.hideSuggestions()},renderSuggestions:function(results){if(results.length){for(var docFrag=document.createDocumentFragment(),div=document.createElement("DIV"),i=0;i<results.length&&i<this.options.limit;i++){var element=document.createElement("DIV");element.classList.add("suggestion-item"),element.dataset.value=results[i],element.dataset.index=i,element.textContent=results[i],div.appendChild(element)}docFrag.appendChild(div),this.suggestionsContainer.innerHTML="",this.selectedSuggestionIndex=-1,this.maxSelectedSuggestionIndex=i-1,this.suggestionsContainer.appendChild(docFrag),this.showSuggestions()}},onSuggestionSelection:function(event){event.preventDefault(),event.stopImmediatePropagation();var element=event.target||event.srcElement;element.dataset.value&&(this.el.value=element.dataset.value,ElementHelper.createAndDispatchNativeEvent(this.el,"change"),this.el.blur(),ElementHelper.createAndDispatchNativeEvent(this.el,"blur"),this.ignoreMouseUp=!0,EventDispatcher.trigger("SearchSuggestion:selected",element.dataset.value,event))},onMouseUp:function(event){this.ignoreMouseUp&&(event.preventDefault(),event.stopImmediatePropagation(),this.ignoreMouseUp=!1)},closeOnClick:function(event){if("none"!==this.suggestionsContainer.style.display){var target=event.target||event.srcElement;if(target){SelectorHelper.getClosest(target,".suggestion-group")||this.hideSuggestions()}}},checkKeyPress:function(event){40===event.keyCode||38===event.keyCode?setTimeout(this.suggestionSelectionOnKeyInput.bind(this,event),0):this.debouncedFetchSuggestions()},suggestionSelectionOnKeyInput:function(event){switch(event.keyCode){case 38:this.selectedSuggestionIndex=this.selectedSuggestionIndex-1<0?this.selectedSuggestionIndex:this.selectedSuggestionIndex-1;break;case 40:this.selectedSuggestionIndex=this.selectedSuggestionIndex+1>this.maxSelectedSuggestionIndex?this.maxSelectedSuggestionIndex:this.selectedSuggestionIndex+1;break;default:return}if(this.selectedSuggestionIndex>=0){var item=this.suggestionsContainer.querySelector('.suggestion-item[data-index="'+this.selectedSuggestionIndex+'"]');if(item){for(var items=this.suggestionsContainer.querySelectorAll(".suggestion-item"),i=0;i<items.length;i++)items[i].classList.remove("highlighted");item.classList.add("highlighted"),this.el.value=item.dataset.value}}},showSuggestions:function(){this.suggestionsContainer&&(this.suggestionsContainer.style.display="")},hideSuggestions:function(){this.selectedSuggestionIndex=-1,this.maxSelectedSuggestionIndex=-1,this.suggestionsContainer&&(this.suggestionsContainer.style.display="none")}}));module.exports=SearchSuggestionsView},{"../../Site/Resources/_selector_helper.js":37,"base-view":"base-view","element-helper":"element-helper","event-dispatcher":"event-dispatcher","meta-config":"meta-config","meta-dictionary":"meta-dictionary","page-token-request":"page-token-request",underscore:"underscore"}],17:[function(require,module,exports){var _=require("underscore"),BaseView=require("base-view"),EventDispatcher=require("event-dispatcher").global(),Dictionary=require("meta-dictionary").global(),WishlistButtonView=BaseView.extend({defaults:{target:"button",labelAdd:"",labelRemove:""},events:{click:"onClick"},initialize:function(options){this.defaults.labelAdd=Dictionary.get("addToWishlist"),this.defaults.labelRemove=Dictionary.get("removeFromWishlist"),this.options=_.defaults(options||{},this.defaults),this.listenTo(this.model,"change",this.toggleClass),this.listenTo(EventDispatcher,"wishlistItem:addedToWishlist",this.addedToWishlist),this.listenTo(EventDispatcher,"user:sync",this.syncLists)},syncLists:function(){this.isActivityInDefaultList()&&this.model.set({action:"remove_tour"})},isActivityInDefaultList:function(){var index,id=this.model.get("tour_id"),lists=this.options.user.get("lists"),wishlist=lists.wishlist||null;if(null!==wishlist&&void 0!==wishlist.items&&wishlist.items.length>0)for(index=0;index<wishlist.items.length;index++)if(parseInt(id)===wishlist.items[index].referenceTechId)return!0;return!1},addedToWishlist:function(model){parseInt(this.model.get("tour_id"))===parseInt(model.get("tour_id"))&&this.model.set({action:"remove_tour"})},onClick:function(event){event.preventDefault(),this.model.update(),this.model.set("action",this.getAction())},getAction:function(){return"remove_tour"===this.model.get("action")?"add_tour":"remove_tour"},toggleClass:function(){var labels;if("remove_tour"===this.model.get("action")){labels=this.el.querySelectorAll(".btn-label,.action-label"),this.el.classList.remove("is-inactive"),this.el.classList.add("is-active"),this.el.classList.add("pulse");for(var i=0;i<labels.length;i++)labels[i].textContent=this.options.labelRemove}else if("add_tour"===this.model.get("action")){labels=this.el.querySelectorAll(".btn-label,.action-label"),this.el.classList.remove("is-active"),this.el.classList.add("is-inactive"),this.el.classList.remove("pulse");for(var j=0;j<labels.length;j++)labels[j].textContent=this.options.labelAdd}}});module.exports=WishlistButtonView},{"base-view":"base-view","event-dispatcher":"event-dispatcher","meta-dictionary":"meta-dictionary",underscore:"underscore"}],18:[function(require,module,exports){var _=require("underscore"),Backbone=require("backbone"),BaseView=require("base-view"),Pikaday=require("pikaday"),moment=require("moment"),EventDispatcher=require("event-dispatcher").global(),Config=require("meta-config").global(),SelectorHelper=require("../../../Site/Resources/_selector_helper"),ElementHelper=require("element-helper"),Scroll=require("../../../Site/Resources/_scroll_helper"),dateConfigurations=Config.get("dateConfigurations"),DatePickerInputsModel=Backbone.Model.extend({defaults:{isDateRange:!0,dateTo:"",dateFrom:"",format:"YYYY-MM-DD",longFormat:Config.get("alignTimesWithDate",!1)?dateConfigurations.longDateFormat.L:dateConfigurations.longDateFormat.LL},initialize:function(options){this.options=_.defaults(options||{},this.defaults)},hasValidDateRange:function(){var dateFrom=this.get("dateFrom"),dateTo=this.get("dateTo");return moment(dateFrom).isBefore(dateTo)||moment(dateFrom).isSame(dateTo)}}),DatepickerInputsView=BaseView.extend({el:".search-date-inputs",events:{"mousedown [readonly]":function(event){event.preventDefault(),ElementHelper.createAndDispatchNativeEvent(event.target,"blur")},"focus [readonly]":function(event){ElementHelper.createAndDispatchNativeEvent(event.target,"blur")}},initialize:function(options){var inputs=document.querySelectorAll(".search-date-input input");inputs.length>1&&(this.isDateRange=!0),this.options=options||{},this.router=options.router||!1,this.model.set("isDateRange",this.isDateRange),this.router&&this.router.addToWhitelist(["date_from"]),this.lang=Config.get("localeCode",document.documentElement.getAttribute("lang")),Array.prototype.forEach.call(inputs,function(element){this.createSubViews(element)}.bind(this)),this.listenTo(EventDispatcher,"searchView:update",this.updateModelOnLoad),this.listenTo(EventDispatcher,"datepickerInput:change",this.onDateInputChange),this.listenTo(EventDispatcher,"datepickerInput:submit",this.submitSearch)},createSubViews:function(input){this.addSubview(new DatepickerInputView({el:input,model:this.model,parentView:this,isDateFrom:input.classList.contains("search-date-from"),isDateRange:this.model.get("isDateRange")}))},updateModelOnLoad:function(data){var dates=data.search.dates;_.lengthy(dates.date_from)&&_.lengthy(dates.date_to)&&this.model.set({dateFrom:moment(dates.date_from).format(this.model.get("format")),dateTo:moment(dates.date_to).format(this.model.get("format"))})},onDateInputChange:function(options){var date=moment(options.date).format(this.model.get("format"));this.model.get("isDateRange")?options.isDateFrom?this.model.set({dateFrom:date}):this.model.set({dateTo:date}):(this.model.set({dateFrom:date}),this.model.set({dateTo:date}))},submitSearch:function(){this.router.navigateWithParameters({date_from:this.model.get("dateFrom"),date_to:this.model.get("dateTo"),p:""})}}),DatepickerInputView=BaseView.extend({events:{click:"onInputInteraction"},initialize:function(options){this.options=options||{},this.parentView=options.parentView,this.model=options.model,this.isDateFrom=this.options.isDateFrom,this.isDateRange=this.options.isDateRange,this.dateConfigurations=Config.get("dateConfigurations",""),this.pikadayLoaded=!1,this.labelPositionUpdated=!1,this.isDateRange&&this.listenTo(this.parentView.model,"change",this.setMinAndMaxDates),this.lang=Config.get("localeCode",document.documentElement.getAttribute("lang")),moment.updateLocale(this.lang,Config.get("dateConfigurations","").i18n)},onInputInteraction:function(){this.pikadayLoaded?this.openModal():(this.setupPikadayEl(),this.pikadayLoaded=!0)},setupSiblings:function(){try{_.truthy(this.isDateFrom)?(this.siblingEl=SelectorHelper.getParent(this.el,".search-date-input").nextSibling,this.siblingModal=this.mobileModal.nextSibling):(this.siblingEl=SelectorHelper.getParent(this.el,".search-date-input").previousSibling,this.siblingModal=this.mobileModal.previousSibling)}catch(e){}},setupPikadayEl:function(){var format=Config.get("alignTimesWithDate",!1)?this.dateConfigurations.longDateFormat.L:this.dateConfigurations.longDateFormat.LL;this.el.readonly=!0,this.el.tabIndex=-1,this.mobileModal=this.isDateFrom?document.querySelector(".datepicker-modal-from"):document.querySelector(".datepicker-modal-to"),this.mobileModalContainer=this.mobileModal.querySelector(".datepicker-modal-body"),this.mobileModalOverlay=document.querySelector(".datepicker-modal-overlay"),this.pikadaySettings={container:this.mobileModalContainer,field:this.el,bound:!1,position:"bottom left",reposition:!1,firstDay:this.dateConfigurations.firstDay,format:format,i18n:this.dateConfigurations.i18n,theme:"gyg-datepicker-modal",onSelect:this.onDateSelect.bind(this),minDate:this.getMinDate(),maxDate:this.getMaxDate()},this.setEvents(),this.isDateRange&&this.setupSiblings(),this.initializePikaday()},setEvents:function(){this.mobileModalOverlay.addEventListener("click",this.manualCloseModal.bind(this)),this.mobileModal.querySelector(".modal-close").addEventListener("click",this.manualCloseModal.bind(this)),this.isDateRange&&this.mobileModal.querySelector(".back-to-from").addEventListener("click",this.backToFrom.bind(this))},getMinDate:function(){var dateFrom=this.parentView.model.get("dateFrom");return this.isDateRange&&!this.isDateFrom&&_.lengthy(dateFrom)?moment(dateFrom).toDate():moment().toDate()},getMaxDate:function(){var dateTo=moment(this.parentView.model.get("dateTo"));return this.isDateRange&&this.isDateFrom&&dateTo.isValid()?moment(dateTo).toDate():""},setMinAndMaxDates:function(){if(!_.existy(this.picker))return!1;this.isDateFrom?(this.maxDate=moment(this.parentView.model.get("dateTo")).toDate(),this.picker.setMaxDate(this.maxDate)):(this.minDate=moment(this.parentView.model.get("dateFrom")).toDate(),this.picker.setMinDate(this.minDate)),this.picker.hide(),this.picker.show()},initializePikaday:function(){_.extend(this.pikadaySettings,this.options);try{this.picker=new Pikaday(this.pikadaySettings),this.el.readonly=Modernizr.touchevents,this.isDateRange&&!this.isDateFrom&&this.updateLabelPosition(),this.openModal()}catch(error){}},manualCloseModal:function(){this.closeModal(!0)},automaticallyCloseModal:function(){this.closeModal(!0)},closeModal:function(scrollTop){scrollTop&&this.scrollToInitialPosition(),this.mobileModal.classList.remove("show"),this.mobileModalOverlay.classList.remove("show"),this.isDateRange&&this.siblingModal.removeClass("side-transition"),this.el.blur()},openModal:function(){this.mobileModal.classList.add("show"),this.mobileModal.classList.remove("side-transition"),this.mobileModalOverlay.classList.add("show"),this.isDateRange&&this.siblingModal.addClass("side-transition")},backToFrom:function(){this.automaticallyCloseModal(!1),this.siblingEl.find("input").click()},scrollToInitialPosition:function(){Scroll.smoothScrollTo(0,300).catch(function(){})},onDateSelect:function(obj,silent){moment.isDate(obj)?this.moment=this.picker.getMoment():obj.target&&(this.moment=moment(obj.target.value)),EventDispatcher.trigger("datepickerInput:change",{isDateFrom:this.isDateFrom,date:this.moment}),this.labelPositionUpdated||this.updateLabelPosition(),this.afterDateSelect()},afterDateSelect:function(){var scrollTop=!0,dateFromVal=this.parentView.model.get("dateFrom"),dateToVal=this.parentView.model.get("dateTo");!this.isDateRange||this.isDateFrom||_.lengthy(dateFromVal)?this.isDateRange&&this.isDateFrom&&!_.lengthy(dateToVal)?(scrollTop=!1,this.automaticallyCloseModal(scrollTop),this.siblingEl.find("input").click(),this.siblingModal.addClass("right-side-transition")):(EventDispatcher.trigger("datepickerInput:submit"),this.automaticallyCloseModal(scrollTop)):(scrollTop=!1,this.automaticallyCloseModal(scrollTop),this.siblingEl.find("input").click(),this.siblingModal.addClass("left-side-transition"))},updateLabelPosition:function(){_.lengthy(this.el.value)&&(SelectorHelper.getParent(this.el,".search-date-input").classList.add("active-input"),this.labelPositionUpdated=!0)}});module.exports={DatepickerInputsView:DatepickerInputsView,DatepickerInputsModel:DatePickerInputsModel}},{"../../../Site/Resources/_scroll_helper":35,"../../../Site/Resources/_selector_helper":37,backbone:"backbone","base-view":"base-view","element-helper":"element-helper","event-dispatcher":"event-dispatcher","meta-config":"meta-config",moment:"moment",pikaday:2,underscore:"underscore"}],19:[function(require,module,exports){var BaseView=require("base-view"),EventDispatcher=require("event-dispatcher").global(),Config=require("meta-config").global(),CheckboxGroupView=BaseView.extend({events:{'change input[type="checkbox"]':"onChange"},initialize:function(){this.isIOS=Config.get("isIOS",!1),this.setInitialState(),EventDispatcher.on("checkboxGroupView:update",this.setInitialState.bind(this))},setInitialState:function(){for(var checkedInputs=this.el.querySelectorAll(":checked"),i=0;i<checkedInputs.length;i++)this.updateCheckbox(checkedInputs[i])},onChange:function(event){var input=event.target||event.srcElement;this.updateCheckbox(input),EventDispatcher.trigger("checkboxGroupView:change")},updateCheckbox:function(input){this.checkInputSubtree(input);var parent=!(!input||!input.dataset)&&input.dataset.parent;parent&&(parent=document.getElementById(parent),this.checkInputState(parent))},checkInputSubtree:function(element){if(element&&element.dataset&&!element.dataset.isLeaf){var isChecked=element.checked,container=document.getElementById("filter-"+element.id),checkboxes=container.querySelectorAll('input[type="checkbox"]');this.setStateOfCheckboxes(checkboxes,!1,isChecked)}},checkInputState:function(element){if(element){for(var children=this.el.querySelectorAll('[data-parent="'+element.id+'"]'),allChildrenChecked=!0,anyChildChecked=!1,i=0;i<children.length;i++)allChildrenChecked&=children[i].checked,anyChildChecked|=children[i].checked||children[i].indeterminate;allChildrenChecked?this.setStateOfCheckbox(element,!1,!0):this.setStateOfCheckbox(element,anyChildChecked,!1);var parent=element.dataset.parent;parent&&(parent=document.getElementById(parent),this.checkInputState(parent))}},setStateOfCheckboxes:function(checkboxes,indeterminate,checked){for(var i=0;i<checkboxes.length;i++)checkboxes[i].indeterminate=indeterminate,checkboxes[i].checked=!(!this.isIOS||!indeterminate)||checked},setStateOfCheckbox:function(checkbox,indeterminate,checked){checkbox.indeterminate=indeterminate,checkbox.checked=!(!this.isIOS||!indeterminate)||checked}});module.exports=CheckboxGroupView},{"base-view":"base-view","event-dispatcher":"event-dispatcher","meta-config":"meta-config"}],20:[function(require,module,exports){var BaseView=require("base-view"),FilterTreeTemplate=require("./_filter_tree.smarty.tpl"),SelectorHelper=require("../../../../Site/Resources/_selector_helper"),FilterView=BaseView.extend({data:{},initialize:function(options){this.options=Object.assign(Object.create(this.defaults||null),options),this.type=this.options.type,this.parameter=this.options.parameter,this.delimiter=this.options.delimiter,delete this.options.type,delete this.options.parameter,delete this.options.delimiter,this.type&&this.parameter&&(this.options.data&&this.update(this.options.data),this.valueAttribute=this.options.valueAttribute||"id",this.template=FilterTreeTemplate)},update:function(data){data[this.type]&&(this.data=data[this.type])},getSelectedFilter:function(){var values=this.getSelectedFilterForLevel(this.el.querySelector(".filter-"+this.parameter),0),selectedFilters={};return selectedFilters[this.parameter]=values.join(this.delimiter),selectedFilters},getSelectedFilterForLevel:function(parent,level){var selectedFilters=[];if(parent){var inputs=parent.querySelectorAll(".level-"+level+' > .filter-label  input[name="'+this.parameter+'[]"]');Array.prototype.forEach.call(inputs,function(element){element.checked&&!element.indeterminate?selectedFilters.push(element.value):element.indeterminate&&level<2&&selectedFilters.push.apply(selectedFilters,this.getSelectedFilterForLevel(SelectorHelper.getClosest(element,".filter-item"),level+1))}.bind(this))}return selectedFilters},render:function(experiments){var html="<div></div>";return("flat"===this.options.template?this.data.count:this.data.tree.length)?(html=this.template.render(Object.assign(this.data,{filter:this.parameter,value:this.valueAttribute,isExpanded:this.options.isExpanded||this.data.hasActiveIds||!1,showFilterNodeCount:!1})),this.el.innerHTML=html,this.setElement(this.el.firstChild),this.el.style.display=""):(this.el.innerHTML="",this.setElement(this.el),this.el.style.display="none"),this.el},destroy:function(){this.remove()}});module.exports=FilterView},{"../../../../Site/Resources/_selector_helper":37,"./_filter_tree.smarty.tpl":21,"base-view":"base-view"}],21:[function(require,module,exports){module.exports=function(root){var __ret={render:function(__tn,__da){"object"==typeof __tn&&(__da=__tn,__tn=void 0),"string"==typeof __tn&&(__da=__da||{});var __f={count:function(obj){var n=0;for(var i in obj)obj.hasOwnProperty(i)&&n++;return n}},__h="",__for={},smarty={foreach:{},capture:{},ldelim:"{",rdelim:"}"},__v=function(){for(var __va=Array.prototype.slice.call(arguments),__vi=0,__vl=__va.length;__vi<__vl;__vi++){var __vd=__va[__vi];if(void 0!=__vd&&""+__vd!="NaN")return"function"==typeof __vd?__vd():__vd}};__h+='<div class="filter-tree-root filter-tree">\t<div class="filter-section ',__v(__da.isExpanded)&&(__h+=" opened"),__h+='" id="',__h+=__v(__da.filter),__h+='">',__h+=__v(__da.title),__h+='</div>\t<ul class="filter-list filter-',__h+=__v(__da.filter),__h+='">\t\t';var __fc2343__d=__v(__da.tree),__fc2343fi=0,__fc2343={};for(var __fc2343k in __fc2343__d)if(__fc2343__d.hasOwnProperty(__fc2343k)){if(__for[__fc2343]=smarty.foreach={index:__fc2343fi,iteration:0==__fc2343fi?"":__fc2343fi,key:__fc2343k.replace("__a",""),total:__f.count(__fc2343__d),first:0==__fc2343fi?1:"",last:__fc2343fi==__f.count(__fc2343__d)-1?1:"",show:!!__fc2343__d[__fc2343k]},__fc2343.node=__fc2343__d[__fc2343k],__h+="\t\t\t",__v(__v(__fc2343.node,{}).hasChildren,__v(__da.node,{}).hasChildren)&&(__v(__v(__fc2343.node,{}).isActive,__v(__da.node,{}).isActive)||__v(__v(__fc2343.node,{}).count,__v(__da.node,{}).count)>0)){__h+='\t\t\t\t<li id="filter-',__h+=__v(__fc2343.filter,__da.filter),__h+="-",__h+=__v(__v(__fc2343.node,{}).id,__v(__da.node,{}).id),__h+='" class="filter-item filter-sublist level-0 ',__v(__v(__fc2343.node,{}).isExpanded,__v(__da.node,{}).isExpanded)&&(__h+="opened"),__h+='">\t\t\t\t\t<div class="filter-label">\t\t\t\t\t\t<input name="',__h+=__v(__fc2343.filter,__da.filter),__h+='[]" type="checkbox" value="',__h+=__v(__v(__fc2343.node,{}).id,__v(__da.node,{}).id),__h+='" id="',__h+=__v(__fc2343.filter,__da.filter),__h+="-",__h+=__v(__v(__fc2343.node,{}).id,__v(__da.node,{}).id),__h+='" ',__v(__v(__fc2343.node,{}).isActive,__v(__da.node,{}).isActive)&&(__h+='checked="checked"'),__h+=' />\t\t\t\t\t\t<label class="filter-node-label" for="',__h+=__v(__fc2343.filter,__da.filter),__h+="-",__h+=__v(__v(__fc2343.node,{}).id,__v(__da.node,{}).id),__h+='">\t\t\t\t\t\t\t<span class="filter-node">',__h+=__v(__v(__fc2343.node,{}).name,__v(__da.node,{}).name),__v(__fc2343.showFilterNodeCount,__da.showFilterNodeCount)&&(__h+=' <span class="filter-node-count">(',__h+=__v(__v(__fc2343.node,{}).count,__v(__da.node,{}).count),__h+=")</span>"),__h+='</span>\t\t\t\t\t\t</label>\t\t\t\t\t\t<span class="icon filter-open-close" data-list-id="filter-',__h+=__v(__fc2343.filter,__da.filter),__h+="-",
__h+=__v(__v(__fc2343.node,{}).id,__v(__da.node,{}).id),__h+='"></span>\t\t\t\t\t</div>\t\t\t\t\t',__da.levelOneParent=__v(__v(__fc2343.node,{}).id,__v(__da.node,{}).id),__h+='\t\t\t\t\t<ul class="filter-list">\t\t\t\t\t\t';var __fc2344__d=__v(__v(__fc2343.node,{}).children,__v(__da.node,{}).children),__fc2344fi=0,__fc2344={};for(var __fc2344k in __fc2344__d)if(__fc2344__d.hasOwnProperty(__fc2344k)){if(__for[__fc2344]=smarty.foreach={index:__fc2344fi,iteration:0==__fc2344fi?"":__fc2344fi,key:__fc2344k.replace("__a",""),total:__f.count(__fc2344__d),first:0==__fc2344fi?1:"",last:__fc2344fi==__f.count(__fc2344__d)-1?1:"",show:!!__fc2344__d[__fc2344k]},__fc2344.node=__fc2344__d[__fc2344k],__h+="\t\t\t\t\t\t\t",__v(__v(__fc2344.node,{}).hasChildren,__v(__fc2343.node,{}).hasChildren,__v(__da.node,{}).hasChildren)&&(__v(__v(__fc2344.node,{}).isActive,__v(__fc2343.node,{}).isActive,__v(__da.node,{}).isActive)||__v(__v(__fc2344.node,{}).count,__v(__fc2343.node,{}).count,__v(__da.node,{}).count)>0)){__h+='\t\t\t\t\t\t\t\t<li id="filter-',__h+=__v(__fc2344.filter,__fc2343.filter,__da.filter),__h+="-",__h+=__v(__v(__fc2344.node,{}).id,__v(__fc2343.node,{}).id,__v(__da.node,{}).id),__h+='" class="filter-item filter-sublist level-1 ',__v(__v(__fc2344.node,{}).isExpanded,__v(__fc2343.node,{}).isExpanded,__v(__da.node,{}).isExpanded)&&(__h+="opened"),__h+='">\t\t\t\t\t\t\t\t\t<div class="filter-label">\t\t\t\t\t\t\t\t\t\t<input name="',__h+=__v(__fc2344.filter,__fc2343.filter,__da.filter),__h+='[]" type="checkbox" value="',__h+=__v(__v(__fc2344.node,{}).id,__v(__fc2343.node,{}).id,__v(__da.node,{}).id),__h+='" id="',__h+=__v(__fc2344.filter,__fc2343.filter,__da.filter),__h+="-",__h+=__v(__v(__fc2344.node,{}).id,__v(__fc2343.node,{}).id,__v(__da.node,{}).id),__h+='" data-parent="',__h+=__v(__fc2344.filter,__fc2343.filter,__da.filter),__h+="-",__h+=__v(__fc2344.levelOneParent,__fc2343.levelOneParent,__da.levelOneParent),__h+='" ',__v(__v(__fc2344.node,{}).isActive,__v(__fc2343.node,{}).isActive,__v(__da.node,{}).isActive)&&(__h+='checked="checked"'),__h+=' />\t\t\t\t\t\t\t\t\t\t<label class="filter-node-label" for="',__h+=__v(__fc2344.filter,__fc2343.filter,__da.filter),__h+="-",__h+=__v(__v(__fc2344.node,{}).id,__v(__fc2343.node,{}).id,__v(__da.node,{}).id),__h+='">\t\t\t\t\t\t\t\t\t\t\t<span class="filter-node">',__h+=__v(__v(__fc2344.node,{}).name,__v(__fc2343.node,{}).name,__v(__da.node,{}).name),__v(__fc2344.showFilterNodeCount,__fc2343.showFilterNodeCount,__da.showFilterNodeCount)&&(__h+=' <span class="filter-node-count">(',__h+=__v(__v(__fc2344.node,{}).count,__v(__fc2343.node,{}).count,__v(__da.node,{}).count),__h+=")</span>"),__h+='</span>\t\t\t\t\t\t\t\t\t\t</label>\t\t\t\t\t\t\t\t\t\t<span class="icon filter-open-close" data-list-id="filter-',__h+=__v(__fc2344.filter,__fc2343.filter,__da.filter),__h+="-",__h+=__v(__v(__fc2344.node,{}).id,__v(__fc2343.node,{}).id,__v(__da.node,{}).id),__h+='"></span>\t\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t\t\t',__da.levelTwoParent=__v(__v(__fc2344.node,{}).id,__v(__fc2343.node,{}).id,__v(__da.node,{}).id),__h+='\t\t\t\t\t\t\t\t\t<ul class="filter-list">\t\t\t\t\t\t\t\t\t\t';var __fc2345__d=__v(__v(__fc2344.node,{}).children,__v(__fc2343.node,{}).children,__v(__da.node,{}).children),__fc2345fi=0,__fc2345={};for(var __fc2345k in __fc2345__d)__fc2345__d.hasOwnProperty(__fc2345k)&&(__for[__fc2345]=smarty.foreach={index:__fc2345fi,iteration:0==__fc2345fi?"":__fc2345fi,key:__fc2345k.replace("__a",""),total:__f.count(__fc2345__d),first:0==__fc2345fi?1:"",last:__fc2345fi==__f.count(__fc2345__d)-1?1:"",show:!!__fc2345__d[__fc2345k]},__fc2345.node=__fc2345__d[__fc2345k],__h+="\t\t\t\t\t\t\t\t\t\t\t",(__v(__v(__fc2345.node,{}).isActive,__v(__fc2344.node,{}).isActive,__v(__fc2343.node,{}).isActive,__v(__da.node,{}).isActive)||__v(__v(__fc2345.node,{}).count,__v(__fc2344.node,{}).count,__v(__fc2343.node,{}).count,__v(__da.node,{}).count)>0)&&(__h+='\t\t\t\t\t\t\t\t\t\t\t\t<li id="filter-',__h+=__v(__fc2345.filter,__fc2344.filter,__fc2343.filter,__da.filter),__h+="-",__h+=__v(__v(__fc2345.node,{}).id,__v(__fc2344.node,{}).id,__v(__fc2343.node,{}).id,__v(__da.node,{}).id),__h+='" class="filter-item filter-leaf level-2">\t\t\t\t\t\t\t\t\t\t\t\t\t<div class="filter-label">\t\t\t\t\t\t\t\t\t\t\t\t\t\t<input name="',__h+=__v(__fc2345.filter,__fc2344.filter,__fc2343.filter,__da.filter),__h+='[]" type="checkbox" value="',__h+=__v(__v(__fc2345.node,{}).id,__v(__fc2344.node,{}).id,__v(__fc2343.node,{}).id,__v(__da.node,{}).id),__h+='" id="',__h+=__v(__fc2345.filter,__fc2344.filter,__fc2343.filter,__da.filter),__h+="-",__h+=__v(__v(__fc2345.node,{}).id,__v(__fc2344.node,{}).id,__v(__fc2343.node,{}).id,__v(__da.node,{}).id),__h+='" data-parent="',__h+=__v(__fc2345.filter,__fc2344.filter,__fc2343.filter,__da.filter),__h+="-",__h+=__v(__fc2345.levelTwoParent,__fc2344.levelTwoParent,__fc2343.levelTwoParent,__da.levelTwoParent),__h+='" data-leaf="1" ',__v(__v(__fc2345.node,{}).isActive,__v(__fc2344.node,{}).isActive,__v(__fc2343.node,{}).isActive,__v(__da.node,{}).isActive)&&(__h+='checked="checked"'),__h+=' />\t\t\t\t\t\t\t\t\t\t\t\t\t\t<label class="filter-node-label" for="',__h+=__v(__fc2345.filter,__fc2344.filter,__fc2343.filter,__da.filter),__h+="-",__h+=__v(__v(__fc2345.node,{}).id,__v(__fc2344.node,{}).id,__v(__fc2343.node,{}).id,__v(__da.node,{}).id),__h+='">\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class="filter-node">',__h+=__v(__v(__fc2345.node,{}).name,__v(__fc2344.node,{}).name,__v(__fc2343.node,{}).name,__v(__da.node,{}).name),__v(__fc2345.showFilterNodeCount,__fc2344.showFilterNodeCount,__fc2343.showFilterNodeCount,__da.showFilterNodeCount)&&(__h+=' <span class="filter-node-count">(',__h+=__v(__v(__fc2345.node,{}).count,__v(__fc2344.node,{}).count,__v(__fc2343.node,{}).count,__v(__da.node,{}).count),__h+=")</span>"),__h+="</span>\t\t\t\t\t\t\t\t\t\t\t\t\t\t</label>\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t\t\t\t\t\t</li>\t\t\t\t\t\t\t\t\t\t\t"),__h+="\t\t\t\t\t\t\t\t\t\t",__fc2345fi++);__h+="\t\t\t\t\t\t\t\t\t</ul>\t\t\t\t\t\t\t\t</li>\t\t\t\t\t\t\t"}else(__v(__v(__fc2344.node,{}).isActive,__v(__fc2343.node,{}).isActive,__v(__da.node,{}).isActive)||__v(__v(__fc2344.node,{}).count,__v(__fc2343.node,{}).count,__v(__da.node,{}).count)>0)&&(__h+='\t\t\t\t\t\t\t\t<li id="filter-',__h+=__v(__fc2344.filter,__fc2343.filter,__da.filter),__h+="-",__h+=__v(__v(__fc2344.node,{}).id,__v(__fc2343.node,{}).id,__v(__da.node,{}).id),__h+='" class="filter-item filter-leaf level-1">\t\t\t\t\t\t\t\t\t<div class="filter-label">\t\t\t\t\t\t\t\t\t\t<input name="',__h+=__v(__fc2344.filter,__fc2343.filter,__da.filter),__h+='[]" type="checkbox" value="',__h+=__v(__v(__fc2344.node,{}).id,__v(__fc2343.node,{}).id,__v(__da.node,{}).id),__h+='" id="',__h+=__v(__fc2344.filter,__fc2343.filter,__da.filter),__h+="-",__h+=__v(__v(__fc2344.node,{}).id,__v(__fc2343.node,{}).id,__v(__da.node,{}).id),__h+='" data-parent="',__h+=__v(__fc2344.filter,__fc2343.filter,__da.filter),__h+="-",__h+=__v(__fc2344.levelOneParent,__fc2343.levelOneParent,__da.levelOneParent),__h+='" data-leaf="1" ',__v(__v(__fc2344.node,{}).isActive,__v(__fc2343.node,{}).isActive,__v(__da.node,{}).isActive)&&(__h+='checked="checked"'),__h+=' />\t\t\t\t\t\t\t\t\t\t<label class="filter-node-label" for="',__h+=__v(__fc2344.filter,__fc2343.filter,__da.filter),__h+="-",__h+=__v(__v(__fc2344.node,{}).id,__v(__fc2343.node,{}).id,__v(__da.node,{}).id),__h+='">\t\t\t\t\t\t\t\t\t\t\t<span class="filter-node">',__h+=__v(__v(__fc2344.node,{}).name,__v(__fc2343.node,{}).name,__v(__da.node,{}).name),__v(__fc2344.showFilterNodeCount,__fc2343.showFilterNodeCount,__da.showFilterNodeCount)&&(__h+=' <span class="filter-node-count">(',__h+=__v(__v(__fc2344.node,{}).count,__v(__fc2343.node,{}).count,__v(__da.node,{}).count),__h+=")</span>"),__h+="</span>\t\t\t\t\t\t\t\t\t\t</label>\t\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t\t</li>\t\t\t\t\t\t\t");__h+="\t\t\t\t\t\t",__fc2344fi++}__h+="\t\t\t\t\t</ul>\t\t\t\t</li>\t\t\t"}else(__v(__v(__fc2343.node,{}).isActive,__v(__da.node,{}).isActive)||__v(__v(__fc2343.node,{}).count,__v(__da.node,{}).count)>0)&&(__h+='\t\t\t\t<li id="filter-',__h+=__v(__fc2343.filter,__da.filter),__h+="-",__h+=__v(__v(__fc2343.node,{}).id,__v(__da.node,{}).id),__h+='" class="filter-item level-0 filter-leaf">\t\t\t\t\t<div class="filter-label">\t\t\t\t\t\t<input name="',__h+=__v(__fc2343.filter,__da.filter),__h+='[]" type="checkbox" value="',__h+=__v(__v(__fc2343.node,{}).id,__v(__da.node,{}).id),__h+='" id="',__h+=__v(__fc2343.filter,__da.filter),__h+="-",__h+=__v(__v(__fc2343.node,{}).id,__v(__da.node,{}).id),__h+='" data-leaf="1" ',__v(__v(__fc2343.node,{}).isActive,__v(__da.node,{}).isActive)&&(__h+='checked="checked"'),__h+=' />\t\t\t\t\t\t<label class="filter-node-label" for="',__h+=__v(__fc2343.filter,__da.filter),__h+="-",__h+=__v(__v(__fc2343.node,{}).id,__v(__da.node,{}).id),__h+='">\t\t\t\t\t\t\t<span class="filter-node">',__h+=__v(__v(__fc2343.node,{}).name,__v(__da.node,{}).name),__v(__fc2343.showFilterNodeCount,__da.showFilterNodeCount)&&(__h+=' <span class="filter-node-count">(',__h+=__v(__v(__fc2343.node,{}).count,__v(__da.node,{}).count),__h+=")</span>"),__h+="</span>\t\t\t\t\t\t</label>\t\t\t\t\t</div>\t\t\t\t</li>\t\t\t");__h+="\t\t",__fc2343fi++}return __h+="\t</ul></div>",__tn?__func["__fn__"+__tn](__da):__h}};return"object"==typeof exports&&"object"==typeof module&&(exports=module.exports=__ret),"function"==typeof define&&define.amd&&define(__ret),root._smartyTpl=__ret,__ret}(this)},{}],22:[function(require,module,exports){var _=require("underscore"),BaseView=require("base-view"),EventDispatcher=require("event-dispatcher").global(),FilterView=(require("meta-config").global(),require("./Filter/_filter.js")),CheckboxGroupView=require("./Filter/_checkbox_group.js"),Request=require("page-token-request"),SelectorHelper=require("../../../Site/Resources/_selector_helper"),filtersReference=require("./_filters_reference"),getFiltersForPayload=require("./_filters_for_payload"),FiltersView=BaseView.extend({dataRequested:!1,dataFetched:!1,events:{"click .modal-apply-btn":"applyFilter","click .filter-open-close":"toggleFilterGroup","click .modal-back":"closeModal",'change [type="checkbox"]':"applyFilterInstantly","click .filter-section":"toggleFilterSection","click .filter-sidebar-header":"toggleFilterSidebar"},initialize:function(options){if(this.options=Object.assign(options||{},this.defaults),this.checkboxGroupView=null,this.dataFetched=!1,this.spinner=this.el.querySelector(".spinner"),this.errorContainer=this.el.querySelector(".filter-error"),this.filterButton=document.querySelector(".trigger-filters"),this.experiments=this.options.experiments||[],this.searchTerm=this.options.initialSearchTerm||"",this.router=this.options.router,this.router){var filtersParameters=[];for(var filter in filtersReference)filtersReference.hasOwnProperty(filter)&&filtersParameters.push(filtersReference[filter].parameter);this.router.addToWhitelist(filtersParameters),this.filterViews=Object.keys(filtersReference).map(function(filterType){var filter=Object.assign({data:this.options.initialFilterData,router:this.router,type:filterType},filtersReference[filterType]);return this.addSubview(new FilterView(filter))}.bind(this)),this.filterButton&&this.filterButton.addEventListener("click",this.onShowFilter.bind(this)),EventDispatcher.on("filtersView:sync",this.render.bind(this)),EventDispatcher.on("filtersView:prefetch",this.prefetch.bind(this)),EventDispatcher.on("searchView:update",this.updateFilterButton.bind(this))}},onShowFilter:function(){this.errorContainer.style.display="none",this.showSpinner(),this.openModal(),this.dataFetched?this.render():this.fetch()},onFetchError:function(){this.dataRequested=!1,this.errorContainer.style.display=""},getChildrenHeightSum:function(parent,offset){for(var children=parent.children,offset=offset||0,i=0;i<children.length;i++)offset+=children[i].offsetHeight;return offset},setMaxHeight:function(element,height){height="number"==typeof height?height+"px":height,requestAnimationFrame(function(){element.style.maxHeight=height})},setListHeight:function(filterList,expand){if(expand){var filterListHeight=0;do{filterListHeight+=this.getChildrenHeightSum(filterList),this.setMaxHeight(filterList,filterListHeight)}while(filterList=SelectorHelper.getParent(filterList,".filter-list"))}else for(this.setMaxHeight(filterList,0);filterList=SelectorHelper.getParent(filterList,".filter-list");)this.setMaxHeight(filterList,filterList.offsetHeight)},updateFilterListHeights:function(){for(var filterList,filterLists=this.el.getElementsByClassName("filter-list"),i=0;i<filterLists.length;i++)filterList=filterLists[i],this.setMaxHeight(filterList,filterList.offsetHeight)},toggleFilterList:function(groupElement,filterList,filterApplied){var view,isExpanded=groupElement.classList.contains("opened"),expand=!0;if(isExpanded){if(filterApplied!==!1&&void 0!==filterApplied)return;expand=!1}else if(filterApplied===!1)return;var action=expand?"add":"remove";if(groupElement.classList[action]("opened"),filterList){if("boolean"==typeof filterApplied){var filterLists=filterList.querySelectorAll(".filter-list");action=filterApplied?"add":"remove",Array.prototype.forEach.call(filterLists,function(listEl){listEl.classList[action]("opened")})}this.setListHeight(filterList,expand)}for(var i=0;i<this.filterViews.length;i++)if(this.filterViews[i].parameter===groupElement.id){view=this.filterViews[i];break}view&&(view.options.isExpanded=expand),void 0===filterApplied&&this.trackFilterDisplayed(groupElement.id,expand)},toggleFilterGroup:function(event){var target=event.delegateTarget;if(target){var groupElement=SelectorHelper.getParent(target,".filter-item");if(groupElement){var filterList=groupElement.querySelector(".filter-list");filterList&&this.toggleFilterList(groupElement,filterList,target.checked)}}},toggleFilterSection:function(event){var sectionElement=event.delegateTarget;if(sectionElement){var filterList=SelectorHelper.getSibling(sectionElement,".filter-list");filterList&&this.toggleFilterList(sectionElement,filterList)}},toggleFilterSidebar:function(event){var sidebarElement=event.delegateTarget;sidebarElement&&this.toggleFilterList(sidebarElement)},openModal:function(){this.showSpinner(),document.body.classList.add("modal-open"),this.el.classList.add("animated")},closeModal:function(automaticallyClosed){if(document.body.classList.remove("modal-open"),this.el.classList.remove("animated"),automaticallyClosed)return!1},getFilterParameters:function(){return this.filterViews.reduce(function(filterParams,view){return Object.assign(filterParams,view.getSelectedFilter())},{p:""})},applyFilter:function(event){var filterParams=this.getFilterParameters();this.router.navigateWithParameters(filterParams),this.closeModal(!0),this.trackApplyFilter(filterParams,event)},applyFilterInstantly:_.debounce(function(event){this.options.applyFilterInstantly&&(this.applyFilter(event),this.toggleFilterGroup(event))},300),getNow:function(){return window.performance&&window.performance.now?window.performance.now():Date.now()},prefetch:function(){var query=this.router.getQuery();query.q!==this.searchTerm&&this.fetch(query)},fetch:function(query){if(this.filterFetchTimingStart=this.getNow(),query=query||this.router.getQuery(),_.isEqual(this.lastQuery,query))return void this.hideSpinner();this.dataRequested||(this.lastQuery=query,this.searchTerm=query.q,Request.get("/s/filters.json",{params:query}).then(function(response){return this.trackFilterTiming("ReceivedData",response.length),JSON.parse(response)}.bind(this)).then(function(response){this.parse(response)}.bind(this)).catch(this.onFetchError.bind(this)),this.dataRequested=!0)},parse:function(response){this.experiments=response.experiments||[],response.filter?(this.filterViews.forEach(function(view){view.update(response.filter)}.bind(this)),this.dataFetched=!0,this.rendered=!1,EventDispatcher.trigger("filtersView:sync",response)):this.hideSpinner(),this.hasFilter(response)&&this.enableFilterButton(),this.dataRequested=!1},hasFilter:function(data){if(this.filterButton&&this.filterButton.classList.contains("has-filter"))return!0;if(data.filter)for(var property in data.filter)if(data.filter.hasOwnProperty(property)){if(data.filter[property].count&&data.filter[property].count>0)return!0;if(data.filter[property].tree&&data.filter[property].tree.length>0)return!0}return!1},render:function(){if(this.rendered)return void this.hideSpinner();this.checkboxGroupView&&this.checkboxGroupView.remove();var docFrag=document.createDocumentFragment(),wrapper=document.createElement("div");docFrag.appendChild(wrapper);var experiments=this.experiments;this.filterViews.forEach(function(view){wrapper.appendChild(view.render(experiments))}),this.el.querySelector(".filter-body").appendChild(docFrag),this.checkboxGroupView=this.addSubview(new CheckboxGroupView({el:wrapper})),this.rendered=!0,this.hideSpinner(),this.trackFilterTiming("Rendered"),this.updateFilterListHeights()},enableFilterButton:function(){this.filterButton&&this.filterButton.classList.remove("hide")},updateFilterButton:function(data){if(this.filterButton){var numberOfFilters=parseInt(data.search.numOfFiltersApplied)||0;if(0===parseInt(numberOfFilters))this.filterButton.classList.remove("has-filter");else{var filterApplied=this.filterButton.querySelector(".filter-applied");filterApplied&&(filterApplied.textContent="("+numberOfFilters+")"),this.filterButton.classList.add("has-filter")}this.enableFilterButton()}},showSpinner:function(){this.spinner&&(this.spinner.style.display="")},hideSpinner:function(){this.spinner&&(this.spinner.style.display="none")},trackFilterDisplayed:function(filterId,expanded){filterId=filterId.split("-");var subFilter,filter=filterId[0];"filter"===filter&&(filter=filterId[1],subFilter=filterId[2]);var payload={action:"click",target:"filter_displayed",metadata:{expanded:expanded,filter:filter,subFilter:subFilter}};EventDispatcher.trigger("ping","ui",payload)},trackApplyFilter:function(filterParams,event){var payload={action:event.type,target:"filter_applied"};try{var modal=SelectorHelper.getClosest(event.target,".full-page-modal");Object.assign(payload,{id:modal?modal.id:event.target.id,filter:getFiltersForPayload(filterParams)})}catch(e){Object.assign(payload,{exception_message:e.message})}EventDispatcher.trigger("ping","ui",payload)},trackFilterTiming:function(type,size){var payload={action:"fetch",target:"search"};try{Object.assign(payload,{id:"filterSection"+type,metadata:{timing:this.getNow()-this.filterFetchTimingStart}}),void 0!==size&&(payload.metadata.response_body_size=size)}catch(e){Object.assign(payload,{exception_message:e.message})}EventDispatcher.trigger("ping","ui",payload)}});module.exports=FiltersView},{"../../../Site/Resources/_selector_helper":37,"./Filter/_checkbox_group.js":19,"./Filter/_filter.js":20,"./_filters_for_payload":23,"./_filters_reference":24,"base-view":"base-view","event-dispatcher":"event-dispatcher","meta-config":"meta-config","page-token-request":"page-token-request",underscore:"underscore"}],23:[function(require,module,exports){function getFiltersForPayload(searchParams){function countryFromLocation(prefixes,locationIds,locationId){var prefix=locationId[0];return locationId=parseInt(locationId.slice(1),10),prefix===prefixes.location?locationIds.push(locationId):prefix===prefixes.country&&this.country.push(locationId),locationIds}function splitFilter(filtersForPayload,filterType){var filterRef=filters[filterType],filterIds=searchParams[filterRef.parameter];return filterIds=filterIds?filterIds.split(filterRef.delimiter):[],filterIds.length>0&&"location"===filterType&&(filterIds=filterIds.reduce(countryFromLocation.bind(filtersForPayload,filterRef.prefix),[])),filtersForPayload[filterType]=filterIds,filtersForPayload}return Object.keys(filters).reduce(splitFilter,{country:[]})}var filters=require("./_filters_reference");module.exports=getFiltersForPayload},{"./_filters_reference":24}],24:[function(require,module,exports){var filters={category:{parameter:"ct",delimiter:"-",isExpanded:!0},location:{parameter:"lc",delimiter:"-",prefix:{location:"l",country:"c"},isExpanded:!0},language:{parameter:"lng",delimiter:"|"},duration:{parameter:"dur",delimiter:"|"},service:{parameter:"srv",delimiter:"|"}};module.exports=filters},{}],25:[function(require,module,exports){var SearchForm=require("../../../Components/SearchForm/_search_form"),EventDispatcher=require("event-dispatcher").global(),SearchFormView=SearchForm.extend({onSubmit:function(event){event&&(event.preventDefault(),event.stopImmediatePropagation());var query=this.searchTermInput.value;EventDispatcher.trigger("searchForm:submit",query),this.trackSearchSubmit(event,query)}});module.exports=SearchFormView},{"../../../Components/SearchForm/_search_form":14,"event-dispatcher":"event-dispatcher"}],26:[function(require,module,exports){var _=require("underscore"),BaseView=require("base-view"),EventDispatcher=require("event-dispatcher").global(),SearchOverlayView=require("../../../Components/SearchOverlay/_search_overlay"),SearchKeywordView=BaseView.extend({el:".search-term-overlay-container",events:{click:"onClick"},initialize:function(options){this.options=_.defaults(options||{},this.defaults),this.router=options.router,this.searchTerm=this.el.querySelector(".overlay-search-term"),this.addSubview(new SearchOverlayView({router:this.router})),EventDispatcher.on("router:change",this.onRouteChange.bind(this))},onClick:function(event){event.preventDefault(),EventDispatcher.trigger("searchOverlay:open")},onRouteChange:function(){if(this.searchTerm){var query=this.router.getQuery()||{};this.searchTerm.textContent=query.q||""}}});module.exports=SearchKeywordView},{"../../../Components/SearchOverlay/_search_overlay":15,"base-view":"base-view","event-dispatcher":"event-dispatcher",underscore:"underscore"}],27:[function(require,module,exports){var BaseView=require("base-view"),EventDispatcher=require("event-dispatcher").global(),SearchFormView=BaseView.extend({initialize:function(options){this.options=options,this.resultsCount=this.el.querySelector(".results-count"),this.queryHeader=this.el.querySelector(".search-query"),EventDispatcher.on("searchView:update",this.updateResultsCount.bind(this))},updateResultsCount:function(data){this.queryHeader&&(this.queryHeader.textContent=data.search.query||""),this.resultsCount&&(this.resultsCount.textContent=data.search.numOfResultsFormatted||"",this.resultsCount.style.opacity=1)}});module.exports=SearchFormView},{"base-view":"base-view","event-dispatcher":"event-dispatcher"}],28:[function(require,module,exports){var BaseView=require("base-view"),TimeRangeSheet=require("./_time_range_filter_sheet"),TimeRangeFilterView=BaseView.extend({el:".time-range-container",events:{click:"onClick"},initialize:function(options){this.options=Object.assign(options||{},this.defaults),this.addSubview({sheet:new TimeRangeSheet({el:"#sheet-overlay-time-range-filter",name:"TimeRangeFilter",identifier:"time-range-filter",router:this.options.router})}),this.options.router.addToWhitelist(["time_range"])},onClick:function(event){this.subViews.sheet.triggerOpen()}});module.exports=TimeRangeFilterView},{"./_time_range_filter_sheet":29,"base-view":"base-view"}],29:[function(require,module,exports){var Sheet=require("../../../Components/MobileSheetOverlay/_mobile_sheet_overlay"),EventDispatcher=require("event-dispatcher").global(),TimeRangeSheet=Sheet.extend({events:{"click .time-range-item":"onRangeFilterClick","click .reset-button":"onResetClick","click .close-button":"triggerClose"},onResetClick:function(){var anytime=this.el.querySelector(".anytime-filter");anytime&&(anytime.querySelector('[type="radio"]').checked=!0,anytime.click())},onRangeFilterClick:function(event){event.preventDefault(),event.stopImmediatePropagation();var item=event.delegateTarget,radio=item.querySelector('[type="radio"]');if(radio){radio.checked=!0,this.rangeValue=radio.value;var text=item.querySelector(".time-range-value").textContent||"";document.querySelector(".time-range-input-value").textContent=text}return this.triggerClose(),!1},beforeOpen:function(){var query=this.options.router.getQuery(),selected=this.el.querySelector('[value="'+query.time_range+'"]');if(selected)selected.checked=!0;else{var anytime=this.el.querySelector('.anytime-filter [type="radio"]');anytime&&(anytime.checked=!0)}},beforeClose:function(){this.options.router.navigateWithParameters({time_range:this.rangeValue})},afterOpen:function(){var payload={};try{Object.assign(payload,{id:this.el.id||"",target:"TimeRangeFilterSheetOpened",action:"click"})}catch(e){payload.exception_message=e.message}EventDispatcher.trigger("ping","ui",payload)},afterClose:function(){var payload={};try{Object.assign(payload,{id:this.el.id||"",target:"TimeRangeFilterSheetClosed",action:"click",metadata:{time_range:this.rangeValue}})}catch(e){Object.assign(payload,{exception_message:e.message})}EventDispatcher.trigger("ping","ui",payload)}});module.exports=TimeRangeSheet},{"../../../Components/MobileSheetOverlay/_mobile_sheet_overlay":13,"event-dispatcher":"event-dispatcher"}],30:[function(require,module,exports){var BaseView=require("base-view"),SortByView=BaseView.extend({el:".sort-control-list",events:{"click .sort-control":"onSortSelect"},initialize:function(options){this.options=Object.assign(options||{},this.defaults),this.options.router.addToWhitelist(["sort"])},onSortSelect:function(event){var selectedSort=event.delegateTarget,sortId=selectedSort.id.replace("sort-control-",""),lastSelectedSort=this.el.querySelector(".sort-control.active");if(lastSelectedSort){if(lastSelectedSort===selectedSort)return;lastSelectedSort.classList.remove("active")}selectedSort.classList.add("active"),this.options.router.navigateWithNewSortOrder({sort:sortId})}});module.exports=SortByView},{"base-view":"base-view"}],31:[function(require,module,exports){var BaseView=require("base-view"),EventDispatcher=require("event-dispatcher").global(),SuggestedQueryTemplate=require("./_suggested_query.smarty.tpl"),Smarty=require("../../../Site/Resources/_smarty_helper"),Router=require("./../../Resources/_router"),Config=require("meta-config").global(),moment=require("moment"),SuggestedQuery=BaseView.extend({el:".suggested-query-container",events:{"click .suggested-query-button":"onBtnClick"},initialize:function(options){this.router=options.router||new Router,this.listenTo(EventDispatcher,"suggestedQuery:update",this.updateSuggestedQuery.bind(this))},updateSuggestedQuery:function(suggestedQuery){void 0!==suggestedQuery?(this.el.innerHTML=Smarty.render(SuggestedQueryTemplate,{suggestedQuery:suggestedQuery}),this.el.classList.remove("hide")):this.el.classList.add("hide")},onBtnClick:function(event){event.preventDefault();var queryFormInputEl,dateFromInputEl,dateToInputEl,query=event.delegateTarget.value;if(Config.get("isMobile",!1)?(queryFormInputEl=document.getElementById("search-term-input"),dateFromInputEl=document.getElementById("search-date-from")):(queryFormInputEl=document.getElementById("search-form-input"),dateFromInputEl=document.getElementById("datepicker-from-input"),dateToInputEl=document.getElementById("datepicker-to-input")),!query||!queryFormInputEl||!dateFromInputEl)return!1;var dateFrom=dateFromInputEl.value?moment(new Date(dateFromInputEl.value)).format("YYYY-MM-DD"):"",dateTo=dateToInputEl&&dateToInputEl.value?moment(new Date(dateToInputEl.value)).format("YYYY-MM-DD"):"",isSameQuery=queryFormInputEl.value===query;this.router.addToWhitelist(["suggested_query"]);var parameters={q:query,date_from:"",date_to:"",suggested_query:"true"};dateFrom&&(parameters.date_from=dateFrom),dateTo&&(parameters.date_to=dateTo),isSameQuery||(queryFormInputEl.value=query,this.router.navigateWithNewSearchKeyword(parameters)),Config.get("isMobile",!1)&&EventDispatcher.trigger("searchOverlay:close")}});module.exports=SuggestedQuery},{"../../../Site/Resources/_smarty_helper":38,"./../../Resources/_router":34,"./_suggested_query.smarty.tpl":32,"base-view":"base-view","event-dispatcher":"event-dispatcher","meta-config":"meta-config",moment:"moment"}],32:[function(require,module,exports){module.exports=function(root){var __ret={render:function(__tn,__da){"object"==typeof __tn&&(__da=__tn,__tn=void 0),"string"==typeof __tn&&(__da=__da||{});var __func={__fn__gygtext:function(params){try{return require("meta-dictionary").global().get(params.key)}catch(error){}}},__h="",__v=function(){for(var __va=Array.prototype.slice.call(arguments),__vi=0,__vl=__va.length;__vi<__vl;__vi++){var __vd=__va[__vi];if(void 0!=__vd&&""+__vd!="NaN")return"function"==typeof __vd?__vd():__vd}};return __h+="<label>",__h+=__func.__fn__gygtext({key:"mSearch suggested query"}),__h+=': </label><button type="button" class="suggested-query-button btn btn-cta" value="',__h+=__v(__da.suggestedQuery),__h+='">\t',__h+=__v(__da.suggestedQuery),__h+="</button>",__tn?__func["__fn__"+__tn](__da):__h}};return"object"==typeof exports&&"object"==typeof module&&(exports=module.exports=__ret),"function"==typeof define&&define.amd&&define(__ret),root._smartyTpl=__ret,__ret}(this)},{"meta-dictionary":"meta-dictionary"}],33:[function(require,module,exports){var _=require("underscore"),Backbone=require("backbone"),MobileSearchHistory=_.extend(Backbone.history,{navigate:function(fragment,options){if(!Backbone.History.started)return!1;options&&options!==!0||(options={trigger:!!options}),fragment=this.getFragment(fragment||"");var url=this.root+fragment;if(fragment=this.decodeFragment(fragment.replace(/#.*$/,"")),this.fragment!==fragment){if(this.fragment=fragment,this._usePushState)this.history[options.replace?"replaceState":"pushState"]({},document.title,url);else{if(!this._wantsHashChange)return this.location.assign(url);if(this._updateHash(this.location,fragment,options.replace),this.iframe&&fragment!==this.getHash(this.iframe.contentWindow)){var iWindow=this.iframe.contentWindow;options.replace||(iWindow.document.open(),iWindow.document.close()),this._updateHash(iWindow.location,fragment,options.replace)}}return options.trigger?this.loadUrl(fragment):void 0}}});module.exports=MobileSearchHistory},{backbone:"backbone",underscore:"underscore"}],34:[function(require,module,exports){var _=require("underscore"),Backbone=require("backbone"),EventDispatcher=require("event-dispatcher").global();require("backbone-query-parameters");var PageQuery=Backbone.Model.extend({}),MobileSearchRouter=Backbone.Router.extend({routes:{"":"defaultRoute"},query:null,eventName:"change",defaultEventName:"change",parameterWhitelist:[],initialize:function(){Backbone.Router.namedParameters=!0},defaultRoute:function(params){params=this.whitelistParameters(params),params=this.cleanParameters(params),this.query=new PageQuery(params),this.triggerChangeEvent(params)},navigateWithURL:function(url){var fragment=url.split(Backbone.history.root)[1];this.navigate(fragment,{trigger:!0,replace:!0})},navigateWithParameters:function(params){params=_.extend(this.getQuery(),params),params=this.whitelistParameters(params),params=this.cleanParameters(params),this.isNewQuery(params)&&this.navigateWithNewQuery(params)},isNewQuery:function(params){return!_.isEqual(this.getQuery(),params)},navigateWithNewQuery:function(params){params=this.whitelistParameters(params),params=this.cleanParameters(params),this.query=new PageQuery,this.query.set(params),this.navigateFromCurrentQuery()},navigateFromCurrentQuery:function(){var params=this.query.attributes;params=this.whitelistParameters(params);var fragment=this.toFragment("",params);this.navigate(fragment,{replace:!0}),this.triggerChangeEvent(params,fragment)},navigateWithNewSearchKeyword:function(params){var query=this.getQuery();params.q!==query.q&&(query.date_from&&(params.date_from=query.date_from),query.date_to&&(params.date_to=query.date_to),params.customerSearch=!0,this.navigateWithNewQuery(params))},navigateToNextPage:function(params){
this.eventName="pageChange",this.navigateWithParameters(params)},navigateWithNewSortOrder:function(params){this.navigateWithParameters(params)},changeUrlWithParameter:function(params){params=_.extend(this.getQuery(),params),params=this.whitelistParameters(params),params=this.cleanParameters(params),this.navigate(this.toFragment("",params),{trigger:!1,replace:!0})},setEventName:function(name){this.eventName=name},getQuery:function(){return this.query&&"function"==typeof this.query.toJSON?this.query.toJSON():{}},cleanParameters:function(params){var cleanParams={};for(var key in params)params.hasOwnProperty(key)&&void 0!==params[key]&&null!==params[key]&&""!==params[key]&&(cleanParams[key]=params[key]);return cleanParams},whitelistParameters:function(params){return Object.keys(params).reduce(function(validatedParams,paramKey){return this.parameterWhitelist.indexOf(paramKey)!==-1&&(validatedParams[paramKey]=params[paramKey]),validatedParams}.bind(this),{})},addToWhitelist:function(whitelist){this.parameterWhitelist.push.apply(this.parameterWhitelist,whitelist)},getQueryParams:function(fragment,forcePushState){return Backbone.History.prototype.getQueryParameters(fragment,forcePushState)},triggerChangeEvent:function(params,fragment){EventDispatcher.trigger("router:"+this.eventName,params,fragment),this.eventName=this.defaultEventName}});module.exports=MobileSearchRouter},{backbone:"backbone","backbone-query-parameters":1,"event-dispatcher":"event-dispatcher",underscore:"underscore"}],35:[function(require,module,exports){var Scroll={getScrollPosition:function(){return document.documentElement.scrollTop||document.body.scrollTop||0},setScrollPosition:function(position){window.requestAnimationFrame(function(){window.scrollTo(0,position)})},getScrollTargetForElement:function(element){if(element)return element.getBoundingClientRect().top+Scroll.getScrollPosition()},scrollToElement:function(element,offset,duration){if(offset=parseInt(parseInt(offset)||0),duration=duration||0,!element)return Promise.reject("Element expected");var targetPosition=Scroll.getScrollTargetForElement(element)+offset;return Scroll.smoothScrollTo(targetPosition,duration)},smoothScrollTo:function(targetY,duration){if(duration=duration||0,targetY=Math.round(targetY),(duration=Math.round(duration))<0)return Promise.reject("bad duration");if(Scroll.getScrollPosition()===targetY)return Promise.resolve();if(0===duration)return Scroll.setScrollPosition(targetY),Promise.resolve();var startTime=Date.now(),endTime=startTime+duration,startTop=Scroll.getScrollPosition(),distance=targetY-startTop,smoothStep=function(start,end,point){if(point<=start)return 0;if(point>=end)return 1;var x=(point-start)/(end-start);return x*x*(3-2*x)};return new Promise(function(resolve,reject){var previousTop=Scroll.getScrollPosition(),scrollFrame=function(){var now=Date.now(),point=smoothStep(startTime,endTime,now),frameTop=Math.round(startTop+distance*point);if(window.scrollTo(0,frameTop),now>=endTime)return void resolve();var currentScrollPos=Scroll.getScrollPosition();if(currentScrollPos===previousTop&&currentScrollPos!==frameTop)return void resolve();previousTop=currentScrollPos,window.requestAnimationFrame(scrollFrame)};window.requestAnimationFrame(scrollFrame)})}};module.exports=Scroll},{}],36:[function(require,module,exports){var ScrollMonitor=function(){function calculateViewport(){if(exports.viewportTop=scrollTop(),exports.viewportBottom=exports.viewportTop+exports.viewportHeight,exports.documentHeight=getDocumentHeight(),exports.documentHeight!==previousDocumentHeight){for(calculateViewportI=watchers.length;calculateViewportI--;)watchers[calculateViewportI].recalculateLocation();previousDocumentHeight=exports.documentHeight}}function updateAndTriggerWatchers(){for(updateAndTriggerWatchersI=watchers.length;updateAndTriggerWatchersI--;)watchers[updateAndTriggerWatchersI].update();for(updateAndTriggerWatchersI=watchers.length;updateAndTriggerWatchersI--;)watchers[updateAndTriggerWatchersI].triggerCallbacks()}function recalculateWatchLocationsAndTrigger(){exports.viewportHeight=getViewportHeight(),calculateViewport(),updateAndTriggerWatchers()}function debouncedRecalculateAndTrigger(){clearTimeout(recalculateAndTriggerTimer),recalculateAndTriggerTimer=setTimeout(recalculateWatchLocationsAndTrigger,100)}function ElementWatcher(watchItem,offsets){function triggerCallbackArray(listeners){if(0!==listeners.length)for(listenerToTriggerListI=listeners.length;listenerToTriggerListI--;)listener=listeners[listenerToTriggerListI],listener.callback.call(self,latestEvent),listener.isOne&&listeners.splice(listenerToTriggerListI,1)}var self=this;this.watchItem=watchItem,this.offsets=offsets?offsets===+offsets?{top:offsets,bottom:offsets}:{top:offsets.top||defaultOffsets.top,bottom:offsets.bottom||defaultOffsets.bottom}:defaultOffsets,this.callbacks={};for(var i=0,j=eventTypes.length;i<j;i++)self.callbacks[eventTypes[i]]=[];this.locked=!1;var wasInViewport,wasFullyInViewport,wasAboveViewport,wasBelowViewport,listenerToTriggerListI,listener;this.triggerCallbacks=function(){switch(this.isInViewport&&!wasInViewport&&triggerCallbackArray(this.callbacks[ENTERVIEWPORT]),this.isFullyInViewport&&!wasFullyInViewport&&triggerCallbackArray(this.callbacks[FULLYENTERVIEWPORT]),this.isAboveViewport!==wasAboveViewport&&this.isBelowViewport!==wasBelowViewport&&(triggerCallbackArray(this.callbacks[VISIBILITYCHANGE]),wasFullyInViewport||this.isFullyInViewport||(triggerCallbackArray(this.callbacks[FULLYENTERVIEWPORT]),triggerCallbackArray(this.callbacks[PARTIALLYEXITVIEWPORT])),wasInViewport||this.isInViewport||(triggerCallbackArray(this.callbacks[ENTERVIEWPORT]),triggerCallbackArray(this.callbacks[EXITVIEWPORT]))),!this.isFullyInViewport&&wasFullyInViewport&&triggerCallbackArray(this.callbacks[PARTIALLYEXITVIEWPORT]),!this.isInViewport&&wasInViewport&&triggerCallbackArray(this.callbacks[EXITVIEWPORT]),this.isInViewport!==wasInViewport&&triggerCallbackArray(this.callbacks[VISIBILITYCHANGE]),!0){case wasInViewport!==this.isInViewport:case wasFullyInViewport!==this.isFullyInViewport:case wasAboveViewport!==this.isAboveViewport:case wasBelowViewport!==this.isBelowViewport:triggerCallbackArray(this.callbacks[STATECHANGE])}wasInViewport=this.isInViewport,wasFullyInViewport=this.isFullyInViewport,wasAboveViewport=this.isAboveViewport,wasBelowViewport=this.isBelowViewport},this.recalculateLocation=function(){if(!this.locked){var previousTop=this.top,previousBottom=this.bottom;if(this.watchItem.nodeName){var cachedDisplay=this.watchItem.style.display;"none"===cachedDisplay&&(this.watchItem.style.display="");var boundingRect=this.watchItem.getBoundingClientRect();this.top=boundingRect.top+exports.viewportTop,this.bottom=boundingRect.bottom+exports.viewportTop,"none"===cachedDisplay&&(this.watchItem.style.display=cachedDisplay)}else this.watchItem===+this.watchItem?this.watchItem>0?this.top=this.bottom=this.watchItem:this.top=this.bottom=exports.documentHeight-this.watchItem:(this.top=this.watchItem.top,this.bottom=this.watchItem.bottom);this.top-=this.offsets.top,this.bottom+=this.offsets.bottom,this.height=this.bottom-this.top,void 0===previousTop&&void 0===previousBottom||this.top===previousTop&&this.bottom===previousBottom||triggerCallbackArray(this.callbacks[LOCATIONCHANGE])}},this.recalculateLocation(),this.update(),wasInViewport=this.isInViewport,wasFullyInViewport=this.isFullyInViewport,wasAboveViewport=this.isAboveViewport,wasBelowViewport=this.isBelowViewport}function scrollMonitorListener(event){latestEvent=event,calculateViewport(),updateAndTriggerWatchers()}var scrollTop=function(){return window.pageYOffset||document.documentElement&&document.documentElement.scrollTop||document.body&&document.body.scrollTop},exports={},watchers=[],VISIBILITYCHANGE="visibilityChange",ENTERVIEWPORT="enterViewport",FULLYENTERVIEWPORT="fullyEnterViewport",EXITVIEWPORT="exitViewport",PARTIALLYEXITVIEWPORT="partiallyExitViewport",LOCATIONCHANGE="locationChange",STATECHANGE="stateChange",eventTypes=[VISIBILITYCHANGE,ENTERVIEWPORT,FULLYENTERVIEWPORT,EXITVIEWPORT,PARTIALLYEXITVIEWPORT,LOCATIONCHANGE,STATECHANGE],defaultOffsets={top:0,bottom:0},getViewportHeight=function(){return window.innerHeight||document.documentElement.clientHeight},getDocumentHeight=function(){return Math.max(document.body.scrollHeight,document.documentElement.scrollHeight,document.body.offsetHeight,document.documentElement.offsetHeight,document.documentElement.clientHeight)};exports.viewportTop=null,exports.viewportBottom=null,exports.documentHeight=null,exports.viewportHeight=getViewportHeight();var previousDocumentHeight,latestEvent,calculateViewportI,updateAndTriggerWatchersI,recalculateAndTriggerTimer;ElementWatcher.prototype={on:function(event,callback,isOne){switch(!0){case event===VISIBILITYCHANGE&&!this.isInViewport&&this.isAboveViewport:case event===ENTERVIEWPORT&&this.isInViewport:case event===FULLYENTERVIEWPORT&&this.isFullyInViewport:case event===EXITVIEWPORT&&this.isAboveViewport&&!this.isInViewport:case event===PARTIALLYEXITVIEWPORT&&this.isAboveViewport:if(callback.call(this,latestEvent),isOne)return}if(!this.callbacks[event])throw new Error("Tried to add a scroll monitor listener of type "+event+". Your options are: "+eventTypes.join(", "));this.callbacks[event].push({callback:callback,isOne:isOne||!1})},off:function(event,callback){if(!this.callbacks[event])throw new Error("Tried to remove a scroll monitor listener of type "+event+". Your options are: "+eventTypes.join(", "));for(var item,i=0;item=this.callbacks[event][i];i++)if(item.callback===callback){this.callbacks[event].splice(i,1);break}},one:function(event,callback){this.on(event,callback,!0)},recalculateSize:function(){this.height=this.watchItem.offsetHeight+this.offsets.top+this.offsets.bottom,this.bottom=this.top+this.height},update:function(){this.isAboveViewport=this.top<exports.viewportTop,this.isBelowViewport=this.bottom>exports.viewportBottom,this.isInViewport=this.top<=exports.viewportBottom&&this.bottom>=exports.viewportTop,this.isFullyInViewport=this.top>=exports.viewportTop&&this.bottom<=exports.viewportBottom||this.isAboveViewport&&this.isBelowViewport},destroy:function(){var index=watchers.indexOf(this),self=this;watchers.splice(index,1);for(var i=0,j=eventTypes.length;i<j;i++)self.callbacks[eventTypes[i]].length=0},lock:function(){this.locked=!0},unlock:function(){this.locked=!1}};for(var i=0,j=eventTypes.length;i<j;i++){var type=eventTypes[i];ElementWatcher.prototype[type]=function(type){return function(callback,isOne){this.on.call(this,type,callback,isOne)}}(type)}try{calculateViewport()}catch(e){window.addEventListener("DOMContentLoaded",recalculateWatchLocationsAndTrigger,{once:!0,passive:!0})}return window.addEventListener("scroll",scrollMonitorListener),window.addEventListener("resize",debouncedRecalculateAndTrigger),exports.beget=exports.create=function(element,offsets){"string"==typeof element?element=document.querySelector(element):element&&element.length>0&&(element=element[0]);var watcher=new ElementWatcher(element,offsets);return watchers.push(watcher),watcher.update(),watcher},exports.update=function(){latestEvent=null,calculateViewport(),updateAndTriggerWatchers()},exports.recalculateLocations=function(){exports.documentHeight=0,exports.update()},exports}();module.exports=ScrollMonitor},{}],37:[function(require,module,exports){var SelectorHelpers={getClosest:function(elem,selector){var attribute,value,firstChar=selector.charAt(0),supports="classList"in document.documentElement;for("["===firstChar&&(selector=selector.substr(1,selector.length-2),attribute=selector.split("="),attribute.length>1&&(value=!0,attribute[1]=attribute[1].replace(/"/g,"").replace(/'/g,"")));elem&&elem!==document&&1===elem.nodeType;elem=elem.parentNode){if("."===firstChar)if(supports){if(elem.classList.contains(selector.substr(1)))return elem}else if(new RegExp("(^|\\s)"+selector.substr(1)+"(\\s|$)").test(elem.className))return elem;if("#"===firstChar&&elem.id===selector.substr(1))return elem;if("["===firstChar&&elem.hasAttribute(attribute[0])){if(!value)return elem;if(elem.getAttribute(attribute[0])===attribute[1])return elem}if(elem.tagName.toLowerCase()===selector)return elem}return null},getParent:function(elem,selector){return this.getClosest(elem.parentNode,selector)},getParents:function(elem,selector){var firstChar,parents=[];for(selector&&(firstChar=selector.charAt(0));elem&&elem!==document;elem=elem.parentNode)selector?("."===firstChar&&elem.classList.contains(selector.substr(1))&&parents.push(elem),"#"===firstChar&&elem.id===selector.substr(1)&&parents.push(elem),"["===firstChar&&elem.hasAttribute(selector.substr(1,selector.length-1))&&parents.push(elem),elem.tagName.toLowerCase()===selector&&parents.push(elem)):parents.push(elem);return 0===parents.length?null:parents},getSiblings:function(elem){var siblings,parentNode=elem&&1===elem.nodeType?elem.parentNode:null;return parentNode&&(siblings=function(list){for(var children=parentNode.children,childrenMapped=[],i=0;i<children.length;i++)childrenMapped.push(children[i]);return childrenMapped}(parentNode),siblings.length>0)?siblings:null},getSibling:function(elem,selector){function getClosest(sibiling){return this.getClosest(sibiling,selector)}var siblings=this.getSiblings(elem);return siblings?function(list,check){for(var item,i=0;i<list.length;i++)if(item=list[i],check(item))return item;return null}(siblings,getClosest.bind(this)):null}};module.exports=SelectorHelpers},{}],38:[function(require,module,exports){var Config=require("meta-config").global(),Smarty={render:function(tpl,data){var d=Object.assign({},Config.toJSON(),data);return tpl.render(d)}};module.exports=Smarty},{"meta-config":"meta-config"}],39:[function(require,module,exports){var _=require("underscore"),BaseModel=require("base-model"),EventDispatcher=require("event-dispatcher").global(),Config=require("meta-config").global(),WishlistFeedback=require("../../Components/FlashNotification/_flash_notification"),Dictionary=require("meta-dictionary").global(),WishlistItem=BaseModel.extend({idAttribute:"tour_id",urlRoot:"",defaults:{action:"add_tour",tour_id:"",timestamp:null},initialize:function(options){this.options=_.defaults(options||{},this.defaults),"remove_tour"===this.get("action")&&EventDispatcher.trigger("wishlistItem:addedToWishlist",this)},onUpdateSuccess:function(model,response){var payload={},actionPerformed=void 0!==response.add&&response.add?"add":"remove";payload.action_type="add"===actionPerformed?"add_to_wishlist":"remove_from_wishlist";try{_.extend(payload,{tour_id:parseInt(this.options.tour_id)})}catch(e){_.extend(payload,{exception_message:e.message})}if(EventDispatcher.trigger("ping","action",payload),EventDispatcher.trigger("wishlistItem:update",response),Config.get("isMobile",!1)&&(this.feedbackEl=document.getElementById("wishlist-item-added-feedback"),this.feedbackEl)){this.feedbackView=new WishlistFeedback({el:this.feedbackEl});var text="add"===actionPerformed?Dictionary.get("wishlistItemAdded"):Dictionary.get("wishlistItemRemoved");this.feedbackView.updateFlashNotificationText(text)}},onUpdateError:function(model,xhr,options){if(403===xhr.status)return void this.redirectToLogin()},redirectToLogin:function(){window.location.href=Config.get("localeHost","/")+"login?next="+window.location.href},update:function(){return this.set("timestamp",Math.round(Date.now()/1e3)),"add_tour"===this.attributes.action?this.urlRoot="/customer/wishlist/ajax-add/"+this.attributes.tour_id:"remove_tour"===this.attributes.action&&(this.urlRoot="/customer/wishlist/ajax-remove/"+this.attributes.tour_id),BaseModel.prototype.fetch.call(this,{type:"POST",data:{action:this.get("action"),timestamp:this.get("timestamp"),tour_id:this.get("tour_id")},url:this.urlRoot,success:_.bind(this.onUpdateSuccess,this),error:_.bind(this.onUpdateError,this)})}});module.exports={WishlistItem:WishlistItem}},{"../../Components/FlashNotification/_flash_notification":12,"base-model":"base-model","event-dispatcher":"event-dispatcher","meta-config":"meta-config","meta-dictionary":"meta-dictionary",underscore:"underscore"}],page:[function(require,module,exports){var Backbone=(require("underscore"),require("backbone")),BaseView=require("base-view"),EventDispatcher=require("event-dispatcher").global(),Config=require("meta-config").global(),Router=require("./_router"),History=require("./_history"),SearchForm=require("../Components/SearchForm/_search_form"),SearchResultCounterView=require("../Components/SearchResultCounter/_search_result_counter"),FiltersView=require("../Components/Filters/_filters"),ListView=require("../../Components/AjaxActivityCardList/Resources/_ajax_list"),ListCollection=require("../../Components/AjaxActivityCardList/Resources/_ajax_list_collection"),DatepickerInputs=require("../Components/DatePicker/_datepicker"),Datepicker=require("../../Components/DatePicker/_datepicker"),SortView=require("../Experiments/Sort/_sort_by"),TimeRangeFilter=require("../Components/TimeRangeFilter/_time_range_filter"),SearchKeywordView=require("../Components/SearchForm/_search_keyword"),ActivityCards=require("./../../Components/ActivityCardList/Resources/_activity_card_list"),ScrollMonitor=require("./../../Site/Resources/_scroll_monitor"),getFiltersForPayload=require("../Components/Filters/_filters_for_payload"),PaginationFlow=require("../../Components/AjaxActivityCardList/Resources/PaginationFlow/_pagination_flow"),LoadMoreFlow=require("../../Components/AjaxActivityCardList/Resources/LoadMoreFlow/_load_more_flow"),SearchModel=Backbone.Model.extend({}),SuggestedQuery=require("../Experiments/SuggestedQuery/_suggested_query"),Page=BaseView.extend({el:"main",initialize:function(options){this.options=Object.assign(Object.create(this.defaults||null),options),this.model=new SearchModel({query:"",resultText:"",synced:!1}),this.scope="searchResults",this.router=new Router,this.router.addToWhitelist(["q","iata","date_from","date_to","lat","lon","radius","deal","price_range","threshold","customerSearch"]);var resultPageSize=Config.get("resultPageSize",10);if(this.filterButton=document.querySelector(".trigger-filters"),this.listCollection=new ListCollection(null,{scope:this.scope,limit:resultPageSize,endpoint:"results.json"}),this.visibleActivityWatchers={},Config.get("isMobile",!1))this.addSubview({searchKeywordView:new SearchKeywordView({router:this.router}),datePickerInputView:new DatepickerInputs.DatepickerInputsView({model:new DatepickerInputs.DatepickerInputsModel({isDateRange:!0}),router:this.router})});else{var dateConfigurations=Config.get("dateConfigurations",!1);if(dateConfigurations===!1)return;this.addSubview({searchForm:new SearchForm({el:".header-search .search-form"}),searchResultCounter:new SearchResultCounterView({el:".search-header",router:this.router}),datepicker:new Datepicker.DatepickerView({model:new Datepicker.DatepickerDates({isDateRange:!0}),router:this.router,dateFormat:dateConfigurations.longDateFormat.L})})}this.addSubview({listView:new ListView({el:".result-activities",scope:this.scope,router:this.router,limit:resultPageSize,searchResultFetchLimit:Config.get("searchResultFetchLimit",20),spinner:".ajax-container .spinner",noResultsContainer:".empty-results-container",cardContainer:'[data-activity-list="searchResults"]',listCollection:this.listCollection,scrollToTopOnRender:!0,scrollOffset:-150,template:"mobile",flow:Config.get("isMobile",!1)?PaginationFlow:LoadMoreFlow,user:this.options.user||null}),filtersView:new FiltersView({el:Config.get("isMobile",!1)?".filter-container":".filter-sidebar",router:this.router,applyFilterInstantly:!Config.get("isMobile",!1)})}),Config.get("isMobile",!1)&&this.addSubview(new TimeRangeFilter({router:this.router})),this.addSubview({searchSort:new SortView({router:this.router})}),this.addSubview({suggestedQuery:new SuggestedQuery({router:this.router})}),this.listenTo(this.listCollection,"sync",this.onListSync.bind(this)),this.listenTo(EventDispatcher,"searchForm:submit",this.onSearchFormSubmit.bind(this)),this.listenTo(EventDispatcher,"searchForm:autocomplete:onSelect",this.triggerSearch.bind(this)),this.listenTo(EventDispatcher,"activityCardList:rendered",this.onListRender.bind(this)),this.listenTo(EventDispatcher,"datepicker:submit",this.onDateSubmit.bind(this)),this.listenTo(EventDispatcher,"searchView:update",this.updateResultsCount.bind(this)),Config.get("isMobile",!1)||this.listenTo(EventDispatcher,"router:change",function(){this.subViews.filtersView.prefetch()}.bind(this)),History.start({pushState:!0,hashChange:!1,root:location.pathname}),Config.get("isMobile",!1)||this.subViews.datepicker.bindElements(),window.optimizely&&(window.whitelistParameter=this.router.addToWhitelist.bind(this.router),window.searchParameters=this.router.navigateWithParameters.bind(this.router)),this.pingView()},updateResultsCount:function(data){for(var resultsCount=this.el.querySelectorAll(".results-count"),i=0;i<resultsCount.length;i++)resultsCount[i].textContent=data.search.numOfResultsFormatted,resultsCount[i].style.opacity=1;this.filterButton&&!this.filterButton.classList.contains("has-filter")&&data.search.numOfResults<=0&&this.filterButton.classList.add("hide")},onListRender:function(resultIds){resultIds=Array.isArray(resultIds)?resultIds:[],this.model.get("synced")&&(this.pingSearchResultView(this.model,resultIds),this.assignVisibleActivityWatchers(resultIds)),this.addSubview(new ActivityCards.ActivityCardListView({el:document.getElementsByTagName("main"),user:this.options.user}))},onListSync:function(collection,response,options){for(var visibleWatcher in this.visibleActivityWatchers)this.visibleActivityWatchers[visibleWatcher].destroy();this.visibleActivityWatchers={},response[this.scope].search&&(this.model.set(response[this.scope].search,options),this.model.set("synced",!0)),options.silent||(EventDispatcher.trigger("searchView:update",response[this.scope]),EventDispatcher.trigger("suggestedQuery:update",response.suggestedQuery))},pingView:function(){var payload={},searchParams=Config.get("searchParams",{});try{Object.assign(payload,{search_id:Config.get("searchId",""),query:searchParams.query||"",date_from:searchParams.date_from,date_to:searchParams.date_to,filter:getFiltersForPayload(this.router.query.attributes)})}catch(e){Object.assign(payload,{exception_message:e.message})}EventDispatcher.trigger("ping","view",payload)},pingSearchResultView:function(model,resultIds){var sortField,sortDirection,query=this.router.getQuery(),dates=model.get("dates",{}),result_count_visible=resultIds.length,page=isNaN(query.p)?1:parseInt(query.p,10),offset=(page-1)*result_count_visible,payload={};switch(query.sort){case"pa":sortField="price",sortDirection="ascending";break;case"rd":sortField="rating",sortDirection="descending";break;default:sortField="default",sortDirection="default"}try{Object.assign(payload,{search_id:this.model.get("id"),result_count:this.model.get("numOfResults",0),result_count_visible:result_count_visible,offset:offset,query:this.model.get("query"),page:page,date_from:dates.date_from||"",date_to:dates.date_to||"",results:resultIds,filter:getFiltersForPayload(query),sort:{field:sortField,direction:sortDirection}})}catch(e){Object.assign(payload,{exception_message:e.message})}EventDispatcher.trigger("ping","SearchResultsView",payload)},getSearchResultsList:function(){var resultsList=[],results=this.listCollection.models;for(var result in results)results.hasOwnProperty(result)&&resultsList.push(this.listCollection.models[result].get("tourId"));return resultsList},assignVisibleActivityWatchers:function(resultIds){function Activity(id){this.id=id,this.key="t"+this.id,this.el=document.getElementById(this.key),this.position=function(){for(var i=0;i<models.length;i++)if(models[i].id===id)return i+1;return null}()}for(var activity,models=this.listCollection.models,i=0;i<resultIds.length;i++)activity=new Activity(resultIds[i]),activity.el&&(this.visibleActivityWatchers[activity.key]=ScrollMonitor.create(activity.el),this.visibleActivityWatchers[activity.key].one("enterViewport",this.pingVisibleActivity.bind(this,activity)))},pingVisibleActivity:function(activity){var payload={};try{Object.assign(payload,{target:"searchPageActivity",action:"activityEnteredViewport",search_id:this.model.get("id"),metadata:{position:activity.position},excludeFromMixpanel:!0})}catch(e){Object.assign(payload,{exception_message:e.message})}EventDispatcher.trigger("ping","ui",payload)},onDateSubmit:function(data){this.router.navigateWithParameters({date_from:data.date_from,date_to:data.date_to,p:""})},onSearchFormSubmit:function(query){var activeSort=document.querySelector(".sort-control.active"),defaultSort=document.getElementById("sort-control-default");activeSort&&activeSort.classList.remove("active"),defaultSort&&defaultSort.classList.add("active"),this.router.navigateWithNewSearchKeyword({q:query})},triggerSearch:function(){this.subViews.searchForm.el.querySelector(".search-form-submit").click()}});module.exports=Page},{"../../Components/AjaxActivityCardList/Resources/LoadMoreFlow/_load_more_flow":6,"../../Components/AjaxActivityCardList/Resources/PaginationFlow/_pagination_flow":7,"../../Components/AjaxActivityCardList/Resources/_ajax_list":9,"../../Components/AjaxActivityCardList/Resources/_ajax_list_collection":10,"../../Components/DatePicker/_datepicker":11,"../Components/DatePicker/_datepicker":18,"../Components/Filters/_filters":22,"../Components/Filters/_filters_for_payload":23,"../Components/SearchForm/_search_form":25,"../Components/SearchForm/_search_keyword":26,"../Components/SearchResultCounter/_search_result_counter":27,"../Components/TimeRangeFilter/_time_range_filter":28,"../Experiments/Sort/_sort_by":30,"../Experiments/SuggestedQuery/_suggested_query":31,"./../../Components/ActivityCardList/Resources/_activity_card_list":4,"./../../Site/Resources/_scroll_monitor":36,"./_history":33,"./_router":34,backbone:"backbone","base-view":"base-view","event-dispatcher":"event-dispatcher","meta-config":"meta-config",underscore:"underscore"}]},{},["page"]);